<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Reshaping data tables in the tidyverse, and other things | TRES Tidyverse Tutorial</title>
  <meta name="description" content="Section 2 Reshaping data tables in the tidyverse, and other things | TRES Tidyverse Tutorial" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Reshaping data tables in the tidyverse, and other things | TRES Tidyverse Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Section 2 Reshaping data tables in the tidyverse, and other things | TRES Tidyverse Tutorial" />
  <meta name="github-repo" content="pratikunterwegs/tres-tidy-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Reshaping data tables in the tidyverse, and other things | TRES Tidyverse Tutorial" />
  
  <meta name="twitter:description" content="Section 2 Reshaping data tables in the tidyverse, and other things | TRES Tidyverse Tutorial" />
  

<meta name="author" content="Raphael, Pratik, Theo and Richèl" />


<meta name="date" content="2020-07-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reading-files-and-string-manipulation.html"/>
<link rel="next" href="data-manipulation-with-dplyr.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Outline</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#possible-extras"><i class="fa fa-check"></i>Possible extras</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#join"><i class="fa fa-check"></i>Join</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html"><i class="fa fa-check"></i><b>1</b> Reading files and string manipulation</a><ul>
<li class="chapter" data-level="1.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#data-import-and-export-with-readr"><i class="fa fa-check"></i><b>1.1</b> Data import and export with <code>readr</code></a><ul>
<li class="chapter" data-level="1.1.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#reading-data"><i class="fa fa-check"></i><b>1.1.1</b> Reading data</a></li>
<li class="chapter" data-level="1.1.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#writing-data"><i class="fa fa-check"></i><b>1.1.2</b> Writing data</a></li>
<li class="chapter" data-level="1.1.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#reading-and-writing-lines"><i class="fa fa-check"></i><b>1.1.3</b> Reading and writing lines</a></li>
<li class="chapter" data-level="" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#excel-files"><i class="fa fa-check"></i>Excel files</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#string-manipulation-with-stringr"><i class="fa fa-check"></i><b>1.2</b> String manipulation with <code>stringr</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#putting-strings-together"><i class="fa fa-check"></i><b>1.2.1</b> Putting strings together</a></li>
<li class="chapter" data-level="1.2.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#detecting-strings"><i class="fa fa-check"></i><b>1.2.2</b> Detecting strings</a></li>
<li class="chapter" data-level="1.2.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#matching-strings"><i class="fa fa-check"></i><b>1.2.3</b> Matching strings</a></li>
<li class="chapter" data-level="1.2.4" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#simpler-pattern-extraction"><i class="fa fa-check"></i><b>1.2.4</b> Simpler pattern extraction</a></li>
<li class="chapter" data-level="1.2.5" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#breaking-strings-apart"><i class="fa fa-check"></i><b>1.2.5</b> Breaking strings apart</a></li>
<li class="chapter" data-level="1.2.6" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#replacing-string-elements"><i class="fa fa-check"></i><b>1.2.6</b> Replacing string elements</a></li>
<li class="chapter" data-level="1.2.7" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#subsetting-within-strings"><i class="fa fa-check"></i><b>1.2.7</b> Subsetting within strings</a></li>
<li class="chapter" data-level="1.2.8" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#padding-and-truncating-strings"><i class="fa fa-check"></i><b>1.2.8</b> Padding and truncating strings</a></li>
<li class="chapter" data-level="1.2.9" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#stringr-aspects-not-covered-here"><i class="fa fa-check"></i><b>1.2.9</b> Stringr aspects not covered here</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#string-interpolation-with-glue"><i class="fa fa-check"></i><b>1.3</b> String interpolation with <code>glue</code></a></li>
<li class="chapter" data-level="1.4" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#strings-in-ggplot"><i class="fa fa-check"></i><b>1.4</b> Strings in <code>ggplot</code></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><i class="fa fa-check"></i><b>2</b> Reshaping data tables in the tidyverse, and other things</a><ul>
<li class="chapter" data-level="2.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#the-new-data-frame-tibble"><i class="fa fa-check"></i><b>2.1</b> The new data frame: tibble</a></li>
<li class="chapter" data-level="2.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#the-concept-of-tidy-data"><i class="fa fa-check"></i><b>2.2</b> The concept of tidy data</a></li>
<li class="chapter" data-level="2.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#reshaping-with-tidyr"><i class="fa fa-check"></i><b>2.3</b> Reshaping with <code>tidyr</code></a><ul>
<li class="chapter" data-level="2.3.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#pivoting"><i class="fa fa-check"></i><b>2.3.1</b> Pivoting</a></li>
<li class="chapter" data-level="2.3.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#handling-missing-values"><i class="fa fa-check"></i><b>2.3.2</b> Handling missing values</a></li>
<li class="chapter" data-level="2.3.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#splitting-and-combining-cells"><i class="fa fa-check"></i><b>2.3.3</b> Splitting and combining cells</a></li>
<li class="chapter" data-level="2.3.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#expanding-tables-using-combinations"><i class="fa fa-check"></i><b>2.3.4</b> Expanding tables using combinations</a></li>
<li class="chapter" data-level="2.3.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#nesting"><i class="fa fa-check"></i><b>2.3.5</b> Nesting</a></li>
<li class="chapter" data-level="2.3.6" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#what-else-can-be-tidied-up"><i class="fa fa-check"></i><b>2.3.6</b> What else can be tidied up?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#extra-factors-and-the-forcats-package"><i class="fa fa-check"></i><b>2.4</b> Extra: factors and the <code>forcats</code> package</a><ul>
<li class="chapter" data-level="2.4.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#change-the-order-of-the-levels"><i class="fa fa-check"></i><b>2.4.1</b> Change the order of the levels</a></li>
<li class="chapter" data-level="2.4.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#change-the-levels-themselves"><i class="fa fa-check"></i><b>2.4.2</b> Change the levels themselves</a></li>
<li class="chapter" data-level="2.4.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#dropping-levels"><i class="fa fa-check"></i><b>2.4.3</b> Dropping levels</a></li>
<li class="chapter" data-level="2.4.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#other-things"><i class="fa fa-check"></i><b>2.4.4</b> Other things</a></li>
<li class="chapter" data-level="2.4.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#take-home-message-for-forcats"><i class="fa fa-check"></i><b>2.4.5</b> Take home message for forcats</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#external-resources"><i class="fa fa-check"></i><b>2.5</b> External resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html"><i class="fa fa-check"></i><b>3</b> Data manipulation with <code>dplyr</code></a><ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#foreword-on-dplyr"><i class="fa fa-check"></i><b>3.1.1</b> Foreword on <code>dplyr</code></a></li>
<li class="chapter" data-level="3.1.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#example-data"><i class="fa fa-check"></i><b>3.1.2</b> Example data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-existing-variables"><i class="fa fa-check"></i><b>3.2</b> Working with existing variables</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#renaming-variables-with-rename"><i class="fa fa-check"></i><b>3.2.1</b> Renaming variables with <code>rename()</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.2.2</b> The pipe operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#select-variables-with-select"><i class="fa fa-check"></i><b>3.2.3</b> Select variables with <code>select()</code></a></li>
<li class="chapter" data-level="3.2.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#select-variables-with-helpers"><i class="fa fa-check"></i><b>3.2.4</b> Select variables with helpers</a></li>
<li class="chapter" data-level="3.2.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#rearranging-variable-order-with-relocate"><i class="fa fa-check"></i><b>3.2.5</b> Rearranging variable order with <code>relocate()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-observations"><i class="fa fa-check"></i><b>3.3</b> Working with observations</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#ordering-rows-by-value---arrange"><i class="fa fa-check"></i><b>3.3.1</b> Ordering rows by value - <code>arrange()</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#subset-rows-by-position---slice"><i class="fa fa-check"></i><b>3.3.2</b> Subset rows by position - <code>slice()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#subsetting-rows-by-value-with-filter"><i class="fa fa-check"></i><b>3.3.3</b> Subsetting rows by value with <code>filter()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#making-new-variables"><i class="fa fa-check"></i><b>3.4</b> Making new variables</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#create-new-variables-with-mutate"><i class="fa fa-check"></i><b>3.4.1</b> Create new variables with <code>mutate()</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#summarise-observations-with-summarise"><i class="fa fa-check"></i><b>3.4.2</b> Summarise observations with <code>summarise()</code></a></li>
<li class="chapter" data-level="3.4.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#grouping-observations-by-variables"><i class="fa fa-check"></i><b>3.4.3</b> Grouping observations by variables</a></li>
<li class="chapter" data-level="3.4.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#grouped-data-and-other-dplyr-verbs"><i class="fa fa-check"></i><b>3.4.4</b> Grouped data and other <code>dplyr</code> verbs</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-multiple-tables"><i class="fa fa-check"></i><b>3.5</b> Working with multiple tables</a><ul>
<li class="chapter" data-level="3.5.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#binding-tables"><i class="fa fa-check"></i><b>3.5.1</b> Binding tables</a></li>
<li class="chapter" data-level="3.5.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#combining-variables-of-two-tables-with-mutating-joins"><i class="fa fa-check"></i><b>3.5.2</b> Combining variables of two tables with mutating joins</a></li>
<li class="chapter" data-level="3.5.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#filtering-matching-observations-between-two-tables-wiht-filtering-joins"><i class="fa fa-check"></i><b>3.5.3</b> Filtering matching observations between two tables wiht filtering joins</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html"><i class="fa fa-check"></i><b>4</b> Working with lists and iteration</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#list-columns-with-tidyr"><i class="fa fa-check"></i><b>4.1</b> List columns with <code>tidyr</code></a><ul>
<li class="chapter" data-level="4.1.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#nesting-data"><i class="fa fa-check"></i><b>4.1.1</b> Nesting data</a></li>
<li class="chapter" data-level="4.1.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#unnesting-data"><i class="fa fa-check"></i><b>4.1.2</b> Unnesting data</a></li>
<li class="chapter" data-level="4.1.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#working-with-list-columns"><i class="fa fa-check"></i><b>4.1.3</b> Working with list columns</a></li>
<li class="chapter" data-level="" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#functionals"><i class="fa fa-check"></i>Functionals</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#iteration-with-map"><i class="fa fa-check"></i><b>4.2</b> Iteration with <code>map</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#basic-use-of-map"><i class="fa fa-check"></i><b>4.2.1</b> Basic use of <code>map</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#map-variants-returning-vectors"><i class="fa fa-check"></i><b>4.2.2</b> <code>map</code> variants returning vectors</a></li>
<li class="chapter" data-level="4.2.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#map-variants-returning-data-frames"><i class="fa fa-check"></i><b>4.2.3</b> <code>map</code> variants returning data frames</a></li>
<li class="chapter" data-level="4.2.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#working-with-list-columns-using-map"><i class="fa fa-check"></i><b>4.2.4</b> Working with list columns using <code>map</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#selective-mapping-using-map-variants"><i class="fa fa-check"></i><b>4.2.5</b> Selective mapping using <code>map</code> variants</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#more-map-variants"><i class="fa fa-check"></i><b>4.3</b> More <code>map</code> variants</a><ul>
<li class="chapter" data-level="4.3.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#mapping-over-two-inputs-with-map2"><i class="fa fa-check"></i><b>4.3.1</b> Mapping over two inputs with map2</a></li>
<li class="chapter" data-level="4.3.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#mapping-over-multiple-inputs-with-pmap"><i class="fa fa-check"></i><b>4.3.2</b> Mapping over multiple inputs with pmap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#combining-map-variants-and-tidyverse-functions"><i class="fa fa-check"></i><b>4.4</b> Combining map variants and tidyverse functions</a></li>
<li class="chapter" data-level="4.5" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#a-return-to-map-variants"><i class="fa fa-check"></i><b>4.5</b> A return to map variants</a><ul>
<li class="chapter" data-level="4.5.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#iteration-without-a-return"><i class="fa fa-check"></i><b>4.5.1</b> Iteration without a return</a></li>
<li class="chapter" data-level="4.5.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#modify-rather-than-map"><i class="fa fa-check"></i><b>4.5.2</b> Modify rather than map</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#other-functions-for-working-with-lists"><i class="fa fa-check"></i><b>4.6</b> Other functions for working with lists</a><ul>
<li class="chapter" data-level="4.6.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#filtering-lists"><i class="fa fa-check"></i><b>4.6.1</b> Filtering lists</a></li>
<li class="chapter" data-level="4.6.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#summarising-lists"><i class="fa fa-check"></i><b>4.6.2</b> Summarising lists</a></li>
<li class="chapter" data-level="4.6.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#reduction-and-accumulation"><i class="fa fa-check"></i><b>4.6.3</b> Reduction and accumulation</a></li>
<li class="chapter" data-level="4.6.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#miscellaneous-operation"><i class="fa fa-check"></i><b>4.6.4</b> Miscellaneous operation</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#lists-of-ggplots-with-patchwork"><i class="fa fa-check"></i><b>4.7</b> Lists of <code>ggplots</code> with <code>patchwork</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html"><i class="fa fa-check"></i><b>5</b> <code>ggplot2</code> and the grammar of graphics</a><ul>
<li class="chapter" data-level="5.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="5.1.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#what-is-ggplot2-and-why-use-it"><i class="fa fa-check"></i><b>5.1.1</b> What is <code>ggplot2</code> and why use it?</a></li>
<li class="chapter" data-level="5.1.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#what-is-the-grammar-of-graphics"><i class="fa fa-check"></i><b>5.1.2</b> What is the grammar of graphics?</a></li>
<li class="chapter" data-level="5.1.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#quick-plot"><i class="fa fa-check"></i><b>5.1.3</b> Quick plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#but-first-the-data"><i class="fa fa-check"></i><b>5.2</b> But first, the data</a></li>
<li class="chapter" data-level="5.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#geom-layers"><i class="fa fa-check"></i><b>5.3</b> Geom layers</a><ul>
<li class="chapter" data-level="5.3.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#mapping-variables-to-aesthetics"><i class="fa fa-check"></i><b>5.3.1</b> Mapping variables to aesthetics</a></li>
<li class="chapter" data-level="5.3.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#fixed-aesthetics"><i class="fa fa-check"></i><b>5.3.2</b> Fixed aesthetics</a></li>
<li class="chapter" data-level="5.3.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#statistical-transformation"><i class="fa fa-check"></i><b>5.3.3</b> Statistical transformation</a></li>
<li class="chapter" data-level="5.3.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#position"><i class="fa fa-check"></i><b>5.3.4</b> Position</a></li>
<li class="chapter" data-level="5.3.5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#other-geoms"><i class="fa fa-check"></i><b>5.3.5</b> Other geoms</a></li>
<li class="chapter" data-level="5.3.6" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#extra-on-aesthetics"><i class="fa fa-check"></i><b>5.3.6</b> Extra on aesthetics</a></li>
<li class="chapter" data-level="5.3.7" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#plot-wide-aesthetics-and-multiple-geoms"><i class="fa fa-check"></i><b>5.3.7</b> Plot-wide aesthetics and multiple geoms</a></li>
<li class="chapter" data-level="5.3.8" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#multiple-geoms-with-different-datasets"><i class="fa fa-check"></i><b>5.3.8</b> Multiple geoms with different datasets</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#coordinate-system"><i class="fa fa-check"></i><b>5.4</b> Coordinate-system</a></li>
<li class="chapter" data-level="5.5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#facetting"><i class="fa fa-check"></i><b>5.5</b> Facetting</a></li>
<li class="chapter" data-level="5.6" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#the-right-format-for-the-dataset"><i class="fa fa-check"></i><b>5.6</b> The right format for the dataset</a></li>
<li class="chapter" data-level="5.7" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#plotting-as-part-of-a-pipeline"><i class="fa fa-check"></i><b>5.7</b> Plotting as part of a pipeline</a></li>
<li class="chapter" data-level="5.8" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#customization"><i class="fa fa-check"></i><b>5.8</b> Customization</a><ul>
<li class="chapter" data-level="5.8.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#scales"><i class="fa fa-check"></i><b>5.8.1</b> Scales</a></li>
<li class="chapter" data-level="5.8.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#labels"><i class="fa fa-check"></i><b>5.8.2</b> Labels</a></li>
<li class="chapter" data-level="5.8.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#themes"><i class="fa fa-check"></i><b>5.8.3</b> Themes</a></li>
<li class="chapter" data-level="5.8.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#legend"><i class="fa fa-check"></i><b>5.8.4</b> Legend</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#combining-plots"><i class="fa fa-check"></i><b>5.9</b> Combining plots</a></li>
<li class="chapter" data-level="5.10" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#saving-a-plot"><i class="fa fa-check"></i><b>5.10</b> Saving a plot</a></li>
<li class="chapter" data-level="5.11" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#high-throughput-plotting-workflow"><i class="fa fa-check"></i><b>5.11</b> High throughput plotting workflow</a></li>
<li class="chapter" data-level="5.12" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#want-more"><i class="fa fa-check"></i><b>5.12</b> Want more?</a></li>
<li class="chapter" data-level="5.13" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#references"><i class="fa fa-check"></i><b>5.13</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html"><i class="fa fa-check"></i><b>6</b> Regular expressions and <code>testthat</code></a><ul>
<li class="chapter" data-level="6.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="6.1.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#goal"><i class="fa fa-check"></i><b>6.1.1</b> Goal</a></li>
<li class="chapter" data-level="6.1.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#why-is-this-important"><i class="fa fa-check"></i><b>6.1.2</b> Why is this important?</a></li>
<li class="chapter" data-level="6.1.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#what-are-regular-expressions"><i class="fa fa-check"></i><b>6.1.3</b> What are regular expressions?</a></li>
<li class="chapter" data-level="6.1.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#applications"><i class="fa fa-check"></i><b>6.1.4</b> Applications</a></li>
<li class="chapter" data-level="6.1.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#using-regexes-in-r"><i class="fa fa-check"></i><b>6.1.5</b> Using regexes in R</a></li>
<li class="chapter" data-level="6.1.6" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#dangers-of-regexes"><i class="fa fa-check"></i><b>6.1.6</b> Dangers of regexes</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#testing"><i class="fa fa-check"></i><b>6.2</b> Testing</a><ul>
<li class="chapter" data-level="6.2.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#why-test"><i class="fa fa-check"></i><b>6.2.1</b> Why test?</a></li>
<li class="chapter" data-level="6.2.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#our-first-test"><i class="fa fa-check"></i><b>6.2.2</b> Our first test</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#detect-a-full-match"><i class="fa fa-check"></i><b>6.3</b> Detect a full match</a><ul>
<li class="chapter" data-level="6.3.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#str_which-demo"><i class="fa fa-check"></i><b>6.3.1</b> <code>str_which</code> demo</a></li>
<li class="chapter" data-level="6.3.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#example-exercise-has_a_one"><i class="fa fa-check"></i><b>6.3.2</b> Example exercise: <code>has_a_one</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-has_a_digit"><i class="fa fa-check"></i><b>6.3.3</b> Exercise: <code>has_a_digit</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-has_a_word"><i class="fa fa-check"></i><b>6.3.4</b> Exercise: <code>has_a_word</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-has_dna_seq-alternates"><i class="fa fa-check"></i><b>6.3.5</b> Exercise: <code>has_dna_seq</code> (alternates)</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#extract-a-pattern-for-one-submatch"><i class="fa fa-check"></i><b>6.4</b> Extract a pattern for one submatch</a><ul>
<li class="chapter" data-level="6.4.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#str_match"><i class="fa fa-check"></i><b>6.4.1</b> <code>str_match</code></a></li>
<li class="chapter" data-level="6.4.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#context"><i class="fa fa-check"></i><b>6.4.2</b> Context</a></li>
<li class="chapter" data-level="6.4.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#extract-a-character-vector-from-a-submatch"><i class="fa fa-check"></i><b>6.4.3</b> Extract a character vector from a submatch</a></li>
<li class="chapter" data-level="6.4.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#example-exercise-extract_dna_seq_numbers-1-submatch"><i class="fa fa-check"></i><b>6.4.4</b> Example exercise: <code>extract_dna_seq_numbers</code> (1 submatch)</a></li>
<li class="chapter" data-level="6.4.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#answer-extract_dna_seq_numbers"><i class="fa fa-check"></i><b>6.4.5</b> Answer: <code>extract_dna_seq_numbers</code></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#extract-a-pattern-for-multiple-submatches"><i class="fa fa-check"></i><b>6.5</b> Extract a pattern for multiple submatches</a><ul>
<li class="chapter" data-level="6.5.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#context-1"><i class="fa fa-check"></i><b>6.5.1</b> Context</a></li>
<li class="chapter" data-level="6.5.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-extract_prot_and_seq_ids"><i class="fa fa-check"></i><b>6.5.2</b> Exercise: <code>extract_prot_and_seq_ids</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#answer-extract_prot_and_seq_ids"><i class="fa fa-check"></i><b>6.5.3</b> Answer: <code>extract_prot_and_seq_ids</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#mutate"><i class="fa fa-check"></i><b>6.6</b> Mutate</a></li>
<li class="chapter" data-level="6.7" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#test-for-match"><i class="fa fa-check"></i><b>6.7</b> Test for match</a></li>
<li class="chapter" data-level="6.8" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#bigger-picture"><i class="fa fa-check"></i><b>6.8</b> Bigger picture</a><ul>
<li class="chapter" data-level="6.8.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#develop-in-packages"><i class="fa fa-check"></i><b>6.8.1</b> Develop in packages</a></li>
<li class="chapter" data-level="6.8.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#regex-usage-outside-r"><i class="fa fa-check"></i><b>6.8.2</b> Regex usage outside R</a></li>
<li class="chapter" data-level="6.8.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#warning"><i class="fa fa-check"></i><b>6.8.3</b> Warning</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#resources"><i class="fa fa-check"></i><b>6.9</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html"><i class="fa fa-check"></i><b>7</b> Programming in the <em>tidyverse</em></a><ul>
<li class="chapter" data-level="7.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#an-exlanation-of-the-problem"><i class="fa fa-check"></i><b>7.1</b> An exlanation of the problem</a><ul>
<li class="chapter" data-level="7.1.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#what-the-issue-is"><i class="fa fa-check"></i><b>7.1.1</b> What the issue is</a></li>
<li class="chapter" data-level="7.1.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#why-the-issue-is-a-problem"><i class="fa fa-check"></i><b>7.1.2</b> Why the issue is a problem</a></li>
<li class="chapter" data-level="7.1.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#passing-variables-as-strings-is-also-an-issue"><i class="fa fa-check"></i><b>7.1.3</b> Passing variables as strings is (also) an issue</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-selection-is-easy"><i class="fa fa-check"></i><b>7.2</b> Flexible selection is easy</a></li>
<li class="chapter" data-level="7.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#a-first-attempt-at-a-flexible-function"><i class="fa fa-check"></i><b>7.3</b> A first attempt at a flexible function</a><ul>
<li class="chapter" data-level="7.3.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#failure-of-the-first-attempt"><i class="fa fa-check"></i><b>7.3.1</b> Failure of the first attempt</a></li>
<li class="chapter" data-level="7.3.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#passing-arguments-as-strings-doesnt-help"><i class="fa fa-check"></i><b>7.3.2</b> Passing arguments as strings doesn’t help</a></li>
<li class="chapter" data-level="7.3.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#none-of-the-other-arguments-will-be-successful"><i class="fa fa-check"></i><b>7.3.3</b> None of the other arguments will be successful</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-filtering-in-a-function"><i class="fa fa-check"></i><b>7.4</b> Flexible filtering in a function</a><ul>
<li class="chapter" data-level="7.4.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-filtering-using-expressions"><i class="fa fa-check"></i><b>7.4.1</b> Flexible filtering using expressions</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-grouping-in-a-function"><i class="fa fa-check"></i><b>7.5</b> Flexible grouping in a function</a><ul>
<li class="chapter" data-level="7.5.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-...-and-forwarding"><i class="fa fa-check"></i><b>7.5.1</b> Using <code>...</code> and ‘forwarding’</a></li>
<li class="chapter" data-level="7.5.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#passing-grouping-variables-as-strings"><i class="fa fa-check"></i><b>7.5.2</b> Passing grouping variables as strings</a></li>
<li class="chapter" data-level="7.5.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-rlangsyms"><i class="fa fa-check"></i><b>7.5.3</b> Using <code>rlang::syms</code></a></li>
<li class="chapter" data-level="7.5.4" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-rlangparse_exprs"><i class="fa fa-check"></i><b>7.5.4</b> Using <code>rlang::parse_exprs</code></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-summarising-in-a-function"><i class="fa fa-check"></i><b>7.6</b> Flexible summarising in a function</a><ul>
<li class="chapter" data-level="7.6.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-dplyrsummarise_at"><i class="fa fa-check"></i><b>7.6.1</b> Using <code>dplyr::summarise_at</code></a></li>
<li class="chapter" data-level="7.6.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-the-across-argument-for-summary-variables"><i class="fa fa-check"></i><b>7.6.2</b> Using the <code>across</code> argument for summary variables</a></li>
<li class="chapter" data-level="7.6.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#summarise-multiple-variables-using-..."><i class="fa fa-check"></i><b>7.6.3</b> Summarise multiple variables using <code>...</code></a></li>
<li class="chapter" data-level="7.6.4" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#summarise-with-multiple-functions"><i class="fa fa-check"></i><b>7.6.4</b> Summarise with multiple functions</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#further-resources"><i class="fa fa-check"></i><b>7.7</b> Further resources</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="developing-r-packages.html"><a href="developing-r-packages.html"><i class="fa fa-check"></i><b>8</b> Developing R packages</a><ul>
<li class="chapter" data-level="8.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html#why-writing-packages"><i class="fa fa-check"></i><b>8.1</b> Why writing packages?</a></li>
<li class="chapter" data-level="8.2" data-path="developing-r-packages.html"><a href="developing-r-packages.html#hands-on-workflow"><i class="fa fa-check"></i><b>8.2</b> Hands-on workflow</a><ul>
<li class="chapter" data-level="8.2.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html#primer-what-is-an-rstudio-project"><i class="fa fa-check"></i><b>8.2.1</b> Primer: what is an RStudio project?</a></li>
<li class="chapter" data-level="8.2.2" data-path="developing-r-packages.html"><a href="developing-r-packages.html#create-a-project-for-your-package"><i class="fa fa-check"></i><b>8.2.2</b> Create a project for your package</a></li>
<li class="chapter" data-level="8.2.3" data-path="developing-r-packages.html"><a href="developing-r-packages.html#link-to-github"><i class="fa fa-check"></i><b>8.2.3</b> Link to GitHub?</a></li>
<li class="chapter" data-level="8.2.4" data-path="developing-r-packages.html"><a href="developing-r-packages.html#write-your-functions"><i class="fa fa-check"></i><b>8.2.4</b> Write your functions</a></li>
<li class="chapter" data-level="8.2.5" data-path="developing-r-packages.html"><a href="developing-r-packages.html#tests"><i class="fa fa-check"></i><b>8.2.5</b> Tests</a></li>
<li class="chapter" data-level="8.2.6" data-path="developing-r-packages.html"><a href="developing-r-packages.html#document-your-functions"><i class="fa fa-check"></i><b>8.2.6</b> Document your functions</a></li>
<li class="chapter" data-level="8.2.7" data-path="developing-r-packages.html"><a href="developing-r-packages.html#build-the-package"><i class="fa fa-check"></i><b>8.2.7</b> Build the package</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="developing-r-packages.html"><a href="developing-r-packages.html#write-a-vignette"><i class="fa fa-check"></i><b>8.3</b> Write a vignette</a></li>
<li class="chapter" data-level="8.4" data-path="developing-r-packages.html"><a href="developing-r-packages.html#update-the-description"><i class="fa fa-check"></i><b>8.4</b> Update the description</a></li>
<li class="chapter" data-level="8.5" data-path="developing-r-packages.html"><a href="developing-r-packages.html#check-the-package"><i class="fa fa-check"></i><b>8.5</b> Check the package</a><ul>
<li class="chapter" data-level="8.5.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html#good-practices"><i class="fa fa-check"></i><b>8.5.1</b> Good practices</a></li>
<li class="chapter" data-level="8.5.2" data-path="developing-r-packages.html"><a href="developing-r-packages.html#better-practices"><i class="fa fa-check"></i><b>8.5.2</b> Better practices</a></li>
<li class="chapter" data-level="8.5.3" data-path="developing-r-packages.html"><a href="developing-r-packages.html#even-better-practices"><i class="fa fa-check"></i><b>8.5.3</b> Even better practices</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="developing-r-packages.html"><a href="developing-r-packages.html#references-1"><i class="fa fa-check"></i><b>8.6</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">TRES Tidyverse Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reshaping-data-tables-in-the-tidyverse-and-other-things" class="section level1">
<h1><span class="header-section-number">Section 2</span> Reshaping data tables in the tidyverse, and other things</h1>
<p>Raphael Scherrer</p>
<p><img src="opening-image.png" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb31-2" title="2"><span class="kw">library</span>(tidyr)</a></code></pre></div>
<p>In this chapter we will learn what <em>tidy</em> means in the context of the tidyverse, and how to reshape our data into a tidy format using the <code>tidyr</code> package. But first, let us take a detour and introduce the <code>tibble</code>.</p>
<div id="the-new-data-frame-tibble" class="section level2">
<h2><span class="header-section-number">2.1</span> The new data frame: tibble</h2>
<p>The <code>tibble</code> is the recommended class to use to store tabular data in the tidyverse. Consider it as the operational unit of any data science pipeline. For most practical purposes, a <code>tibble</code> is basically a <code>data.frame</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="co"># Make a data frame</span></a>
<a class="sourceLine" id="cb32-2" title="2"><span class="kw">data.frame</span>(<span class="dt">who =</span> <span class="kw">c</span>(<span class="st">&quot;Pratik&quot;</span>, <span class="st">&quot;Theo&quot;</span>, <span class="st">&quot;Raph&quot;</span>), <span class="dt">chapt =</span> <span class="kw">c</span>(<span class="st">&quot;1, 4&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;2, 5&quot;</span>))</a>
<a class="sourceLine" id="cb32-3" title="3"><span class="co">#&gt;      who chapt</span></a>
<a class="sourceLine" id="cb32-4" title="4"><span class="co">#&gt; 1 Pratik  1, 4</span></a>
<a class="sourceLine" id="cb32-5" title="5"><span class="co">#&gt; 2   Theo     3</span></a>
<a class="sourceLine" id="cb32-6" title="6"><span class="co">#&gt; 3   Raph  2, 5</span></a>
<a class="sourceLine" id="cb32-7" title="7"></a>
<a class="sourceLine" id="cb32-8" title="8"><span class="co"># Or an equivalent tibble</span></a>
<a class="sourceLine" id="cb32-9" title="9"><span class="kw">tibble</span>(<span class="dt">who =</span> <span class="kw">c</span>(<span class="st">&quot;Pratik&quot;</span>, <span class="st">&quot;Theo&quot;</span>, <span class="st">&quot;Raph&quot;</span>), <span class="dt">chapt =</span> <span class="kw">c</span>(<span class="st">&quot;1, 4&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;2, 5&quot;</span>))</a>
<a class="sourceLine" id="cb32-10" title="10"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb32-11" title="11"><span class="co">#&gt;   who    chapt</span></a>
<a class="sourceLine" id="cb32-12" title="12"><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb32-13" title="13"><span class="co">#&gt; 1 Pratik 1, 4 </span></a>
<a class="sourceLine" id="cb32-14" title="14"><span class="co">#&gt; 2 Theo   3    </span></a>
<a class="sourceLine" id="cb32-15" title="15"><span class="co">#&gt; 3 Raph   2, 5</span></a></code></pre></div>
<p>The difference between <code>tibble</code> and <code>data.frame</code> is in its display and in the way it is subsetted, among others. Most functions working with <code>data.frame</code> will work with <code>tibble</code> and vice versa. Use the <code>as*</code> family of functions to switch back and forth between the two if needed, using e.g. <code>as.data.frame</code> or <code>as_tibble</code>.</p>
<p>In terms of display, the tibble has the advantage of showing the class of each column: <code>chr</code> for <code>character</code>, <code>fct</code> for <code>factor</code>, <code>int</code> for <code>integer</code>, <code>dbl</code> for <code>numeric</code> and <code>lgl</code> for <code>logical</code>, just to name the main atomic classes. This may be more important than you think, because many hard-to-find bugs in R are due to wrong variable types and/or cryptic type conversions. This especially happens with <code>factor</code> and <code>character</code>, which can cause quite some confusion. More about this in the extra section at the end of this chapter!</p>
<p>Note that you can build a tibble by rows rather than by columns with <code>tribble</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb33-2" title="2">  <span class="op">~</span>who, <span class="op">~</span>chapt,</a>
<a class="sourceLine" id="cb33-3" title="3">  <span class="st">&quot;Pratik&quot;</span>, <span class="st">&quot;1, 4&quot;</span>,</a>
<a class="sourceLine" id="cb33-4" title="4">  <span class="st">&quot;Theo&quot;</span>, <span class="st">&quot;3&quot;</span>,</a>
<a class="sourceLine" id="cb33-5" title="5">  <span class="st">&quot;Raph&quot;</span>, <span class="st">&quot;2, 5&quot;</span></a>
<a class="sourceLine" id="cb33-6" title="6">)</a>
<a class="sourceLine" id="cb33-7" title="7"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb33-8" title="8"><span class="co">#&gt;   who    chapt</span></a>
<a class="sourceLine" id="cb33-9" title="9"><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb33-10" title="10"><span class="co">#&gt; 1 Pratik 1, 4 </span></a>
<a class="sourceLine" id="cb33-11" title="11"><span class="co">#&gt; 2 Theo   3    </span></a>
<a class="sourceLine" id="cb33-12" title="12"><span class="co">#&gt; 3 Raph   2, 5</span></a></code></pre></div>
<p>As a rule of thumb, try to convert your tables to tibbles whenever you can, especially when the original table is <em>not</em> a data frame. For example, the principal component analysis function <code>prcomp</code> outputs a <code>matrix</code> of coordinates in principal component-space.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="co"># Perform a PCA on mtcars</span></a>
<a class="sourceLine" id="cb34-2" title="2">pca_scores &lt;-<span class="st"> </span><span class="kw">prcomp</span>(mtcars)<span class="op">$</span>x</a>
<a class="sourceLine" id="cb34-3" title="3"><span class="kw">head</span>(pca_scores) <span class="co"># looks like a data frame or a tibble...</span></a>
<a class="sourceLine" id="cb34-4" title="4"><span class="co">#&gt;                       PC1   PC2   PC3    PC4    PC5     PC6      PC7     PC8</span></a>
<a class="sourceLine" id="cb34-5" title="5"><span class="co">#&gt; Mazda RX4          -79.60  2.13 -2.15 -2.707 -0.702 -0.3149 -0.09870 -0.0779</span></a>
<a class="sourceLine" id="cb34-6" title="6"><span class="co">#&gt; Mazda RX4 Wag      -79.60  2.15 -2.22 -2.178 -0.884 -0.4534 -0.00355 -0.0957</span></a>
<a class="sourceLine" id="cb34-7" title="7"><span class="co">#&gt; Datsun 710        -133.89 -5.06 -2.14  0.346  1.106  1.1730  0.00576  0.1362</span></a>
<a class="sourceLine" id="cb34-8" title="8"><span class="co">#&gt; Hornet 4 Drive       8.52 44.99  1.23  0.827  0.424 -0.0579 -0.02431  0.2212</span></a>
<a class="sourceLine" id="cb34-9" title="9"><span class="co">#&gt; Hornet Sportabout  128.69 30.82  3.34 -0.521  0.737 -0.3329  0.10630 -0.0530</span></a>
<a class="sourceLine" id="cb34-10" title="10"><span class="co">#&gt; Valiant            -23.22 35.11 -3.26  1.401  0.803 -0.0884  0.23895  0.4239</span></a>
<a class="sourceLine" id="cb34-11" title="11"><span class="co">#&gt;                      PC9    PC10   PC11</span></a>
<a class="sourceLine" id="cb34-12" title="12"><span class="co">#&gt; Mazda RX4         -0.200 -0.2901  0.106</span></a>
<a class="sourceLine" id="cb34-13" title="13"><span class="co">#&gt; Mazda RX4 Wag     -0.353 -0.1928  0.107</span></a>
<a class="sourceLine" id="cb34-14" title="14"><span class="co">#&gt; Datsun 710        -0.198  0.0763  0.267</span></a>
<a class="sourceLine" id="cb34-15" title="15"><span class="co">#&gt; Hornet 4 Drive     0.356 -0.0906  0.209</span></a>
<a class="sourceLine" id="cb34-16" title="16"><span class="co">#&gt; Hornet Sportabout  0.153 -0.1886 -0.109</span></a>
<a class="sourceLine" id="cb34-17" title="17"><span class="co">#&gt; Valiant            0.101 -0.0377  0.276</span></a>
<a class="sourceLine" id="cb34-18" title="18"><span class="kw">class</span>(pca_scores) <span class="co"># but is actually a matrix</span></a>
<a class="sourceLine" id="cb34-19" title="19"><span class="co">#&gt; [1] &quot;matrix&quot;</span></a>
<a class="sourceLine" id="cb34-20" title="20"></a>
<a class="sourceLine" id="cb34-21" title="21"><span class="co"># Convert to tibble</span></a>
<a class="sourceLine" id="cb34-22" title="22"><span class="kw">as_tibble</span>(pca_scores)</a>
<a class="sourceLine" id="cb34-23" title="23"><span class="co">#&gt; # A tibble: 32 x 11</span></a>
<a class="sourceLine" id="cb34-24" title="24"><span class="co">#&gt;       PC1   PC2   PC3    PC4    PC5     PC6      PC7     PC8    PC9    PC10</span></a>
<a class="sourceLine" id="cb34-25" title="25"><span class="co">#&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb34-26" title="26"><span class="co">#&gt; 1  -79.6   2.13 -2.15 -2.71  -0.702 -0.315  -0.0987  -0.0779 -0.200 -0.290 </span></a>
<a class="sourceLine" id="cb34-27" title="27"><span class="co">#&gt; 2  -79.6   2.15 -2.22 -2.18  -0.884 -0.453  -0.00355 -0.0957 -0.353 -0.193 </span></a>
<a class="sourceLine" id="cb34-28" title="28"><span class="co">#&gt; 3 -134.   -5.06 -2.14  0.346  1.11   1.17    0.00576  0.136  -0.198  0.0763</span></a>
<a class="sourceLine" id="cb34-29" title="29"><span class="co">#&gt; 4    8.52 45.0   1.23  0.827  0.424 -0.0579 -0.0243   0.221   0.356 -0.0906</span></a>
<a class="sourceLine" id="cb34-30" title="30"><span class="co">#&gt; 5  129.   30.8   3.34 -0.521  0.737 -0.333   0.106   -0.0530  0.153 -0.189 </span></a>
<a class="sourceLine" id="cb34-31" title="31"><span class="co">#&gt; 6  -23.2  35.1  -3.26  1.40   0.803 -0.0884  0.239    0.424   0.101 -0.0377</span></a>
<a class="sourceLine" id="cb34-32" title="32"><span class="co">#&gt; # … with 26 more rows, and 1 more variable: PC11 &lt;dbl&gt;</span></a></code></pre></div>
<p>This is important because a <code>matrix</code> can contain only one type of values (e.g. only <code>numeric</code> or <code>character</code>), while <code>tibble</code> (and <code>data.frame</code>) allow you to have columns of different types.</p>
<p>So, in the tidyverse we are going to work with tibbles, got it. But what does “tidy” mean exactly?</p>
</div>
<div id="the-concept-of-tidy-data" class="section level2">
<h2><span class="header-section-number">2.2</span> The concept of tidy data</h2>
<p>When it comes to putting data into tables, there are many ways one could organize a dataset. The <em>tidy</em> format is one such format. According to the formal <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">definition</a>, a table is tidy if each column is a variable and each row is an observation. In practice, however, I found that this is not a very operational definition, especially in ecology and evolution where we often record multiple variables per individual. So, let’s dig in with an example.</p>
<p>Say we have a dataset of several morphometrics measured on Darwin’s finches in the Galapagos islands. Let’s first get this dataset.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co"># We first simulate random data</span></a>
<a class="sourceLine" id="cb35-2" title="2">beak_lengths &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb35-3" title="3">beak_widths &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean =</span> <span class="dv">2</span>, <span class="dt">sd =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb35-4" title="4">body_weights &lt;-<span class="st"> </span><span class="kw">rgamma</span>(<span class="dv">100</span>, <span class="dt">shape =</span> <span class="dv">10</span>, <span class="dt">rate =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb35-5" title="5">islands &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Isabela&quot;</span>, <span class="st">&quot;Santa Cruz&quot;</span>), <span class="dt">each =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb35-6" title="6"></a>
<a class="sourceLine" id="cb35-7" title="7"><span class="co"># Assemble into a tibble</span></a>
<a class="sourceLine" id="cb35-8" title="8">data &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb35-9" title="9">  <span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb35-10" title="10">  <span class="dt">body_weight =</span> body_weights,</a>
<a class="sourceLine" id="cb35-11" title="11">  <span class="dt">beak_length =</span> beak_lengths,</a>
<a class="sourceLine" id="cb35-12" title="12">  <span class="dt">beak_width =</span> beak_widths,</a>
<a class="sourceLine" id="cb35-13" title="13">  <span class="dt">island =</span> islands</a>
<a class="sourceLine" id="cb35-14" title="14">)</a>
<a class="sourceLine" id="cb35-15" title="15"></a>
<a class="sourceLine" id="cb35-16" title="16"><span class="co"># Snapshot</span></a>
<a class="sourceLine" id="cb35-17" title="17">data</a>
<a class="sourceLine" id="cb35-18" title="18"><span class="co">#&gt; # A tibble: 100 x 5</span></a>
<a class="sourceLine" id="cb35-19" title="19"><span class="co">#&gt;      id body_weight beak_length beak_width island </span></a>
<a class="sourceLine" id="cb35-20" title="20"><span class="co">#&gt;   &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb35-21" title="21"><span class="co">#&gt; 1     1       10.8         4.94       1.94 Isabela</span></a>
<a class="sourceLine" id="cb35-22" title="22"><span class="co">#&gt; 2     2       15.4         5.02       2.00 Isabela</span></a>
<a class="sourceLine" id="cb35-23" title="23"><span class="co">#&gt; 3     3       15.0         4.92       1.91 Isabela</span></a>
<a class="sourceLine" id="cb35-24" title="24"><span class="co">#&gt; 4     4        8.51        5.16       2.02 Isabela</span></a>
<a class="sourceLine" id="cb35-25" title="25"><span class="co">#&gt; 5     5       14.9         5.03       1.93 Isabela</span></a>
<a class="sourceLine" id="cb35-26" title="26"><span class="co">#&gt; 6     6        8.41        4.92       2.18 Isabela</span></a>
<a class="sourceLine" id="cb35-27" title="27"><span class="co">#&gt; # … with 94 more rows</span></a></code></pre></div>
<p>Here, we pretend to have measured <code>beak_length</code>, <code>beak_width</code> and <code>body_weight</code> on 100 birds, 50 of them from Isabela and 50 of them from Santa Cruz. In this tibble, each row is an individual bird. This is probably the way most scientists would record their data in the field. However, a single bird is not an “observation” in the sense used in the tidyverse. Our dataset is not tidy but <em>messy</em>.</p>
<p>The tidy equivalent of this dataset would be:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">data &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb36-2" title="2">  data,</a>
<a class="sourceLine" id="cb36-3" title="3">  <span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;body_weight&quot;</span>, <span class="st">&quot;beak_length&quot;</span>, <span class="st">&quot;beak_width&quot;</span>),</a>
<a class="sourceLine" id="cb36-4" title="4">  <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span></a>
<a class="sourceLine" id="cb36-5" title="5">)</a>
<a class="sourceLine" id="cb36-6" title="6">data</a>
<a class="sourceLine" id="cb36-7" title="7"><span class="co">#&gt; # A tibble: 300 x 4</span></a>
<a class="sourceLine" id="cb36-8" title="8"><span class="co">#&gt;      id island  variable    value</span></a>
<a class="sourceLine" id="cb36-9" title="9"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb36-10" title="10"><span class="co">#&gt; 1     1 Isabela body_weight 10.8 </span></a>
<a class="sourceLine" id="cb36-11" title="11"><span class="co">#&gt; 2     1 Isabela beak_length  4.94</span></a>
<a class="sourceLine" id="cb36-12" title="12"><span class="co">#&gt; 3     1 Isabela beak_width   1.94</span></a>
<a class="sourceLine" id="cb36-13" title="13"><span class="co">#&gt; 4     2 Isabela body_weight 15.4 </span></a>
<a class="sourceLine" id="cb36-14" title="14"><span class="co">#&gt; 5     2 Isabela beak_length  5.02</span></a>
<a class="sourceLine" id="cb36-15" title="15"><span class="co">#&gt; 6     2 Isabela beak_width   2.00</span></a>
<a class="sourceLine" id="cb36-16" title="16"><span class="co">#&gt; # … with 294 more rows</span></a></code></pre></div>
<p>where each <em>measurement</em> (and not each <em>individual</em>) is now the unit of observation (the rows). The <code>pivot_longer</code> function is the easiest way to get to this format. It belongs to the <code>tidyr</code> package, which we’ll cover in a minute.</p>
<p>As you can see our tibble now has three times as many rows and fewer columns. This format is rather unintuitive and not optimal for display. However, it provides a very standardized and consistent way of organizing data that will be understood (and expected) by pretty much all functions in the tidyverse. This makes the tidyverse tools work well together and reduces the time you would otherwise spend reformatting your data from one tool to the next.</p>
<p>That does not mean that the <em>messy</em> format is useless though. There may be use-cases where you need to switch back and forth between formats. For this reason I prefer referring to these formats using their other names: <em>long</em> (tidy) versus <em>wide</em> (messy). For example, matrix operations work much faster on wide data, and the wide format arguably looks nicer for display. Luckily the <code>tidyr</code> package gives us the tools to reshape our data as needed, as we shall see shortly.</p>
<p>Another common example of wide-or-long dilemma is when dealing with <em>contingency tables</em>. This would be our case, for example, if we asked how many observations we have for each morphometric and each island. We use <code>table</code> (from base R) to get the answer:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co"># Make a contingency table</span></a>
<a class="sourceLine" id="cb37-2" title="2">ctg &lt;-<span class="st"> </span><span class="kw">with</span>(data, <span class="kw">table</span>(island, variable))</a>
<a class="sourceLine" id="cb37-3" title="3">ctg</a>
<a class="sourceLine" id="cb37-4" title="4"><span class="co">#&gt;             variable</span></a>
<a class="sourceLine" id="cb37-5" title="5"><span class="co">#&gt; island       beak_length beak_width body_weight</span></a>
<a class="sourceLine" id="cb37-6" title="6"><span class="co">#&gt;   Isabela             50         50          50</span></a>
<a class="sourceLine" id="cb37-7" title="7"><span class="co">#&gt;   Santa Cruz          50         50          50</span></a></code></pre></div>
<p>A variety of statistical tests can be used on contingency tables such as Fisher’s exact test, the chi-square test or the binomial test. Contingency tables are in the wide format by construction, but they too can be pivoted to the long format, and the tidyverse manipulation tools will expect you to do so. Actually, <code>tibble</code> knows that very well and does it by default if you convert your <code>table</code> into a <code>tibble</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="co"># Contingency table is pivoted to the long-format automatically</span></a>
<a class="sourceLine" id="cb38-2" title="2"><span class="kw">as_tibble</span>(ctg)</a>
<a class="sourceLine" id="cb38-3" title="3"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb38-4" title="4"><span class="co">#&gt;   island     variable        n</span></a>
<a class="sourceLine" id="cb38-5" title="5"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;       &lt;int&gt;</span></a>
<a class="sourceLine" id="cb38-6" title="6"><span class="co">#&gt; 1 Isabela    beak_length    50</span></a>
<a class="sourceLine" id="cb38-7" title="7"><span class="co">#&gt; 2 Santa Cruz beak_length    50</span></a>
<a class="sourceLine" id="cb38-8" title="8"><span class="co">#&gt; 3 Isabela    beak_width     50</span></a>
<a class="sourceLine" id="cb38-9" title="9"><span class="co">#&gt; 4 Santa Cruz beak_width     50</span></a>
<a class="sourceLine" id="cb38-10" title="10"><span class="co">#&gt; 5 Isabela    body_weight    50</span></a>
<a class="sourceLine" id="cb38-11" title="11"><span class="co">#&gt; 6 Santa Cruz body_weight    50</span></a></code></pre></div>
<div class="infobox caution">
<p><em>Summary: Tidy or not tidy</em></p>
<p>To sum up, the definition of what is tidy and what is not is somewhat subjective. Tables can be in long or wide format, and depending on the complexity of a dataset, there may even be some intermediate states. To be clear, the tidyverse does not only accept long tables, and wide tables may sometimes be the way to go. This is very use-case specific. Have a clear idea of what you want to do with your data (what tidyverse tools you will use), and use that to figure which format makes more sense. And remember, <code>tidyr</code> is here to easily do the switching for you.</p>
</div>
</div>
<div id="reshaping-with-tidyr" class="section level2">
<h2><span class="header-section-number">2.3</span> Reshaping with <code>tidyr</code></h2>
<p>The <code>tidyr</code> package implements tools to easily switch between layouts and also perform a few other reshaping operations. Old school R users will be familiar with the <code>reshape</code> and <code>reshape2</code> packages, of which <code>tidyr</code> is the tidyverse equivalent. Beware that <code>tidyr</code> is about playing with the general <em>layout</em> of the dataset, while <em>operations</em> and <em>transformations</em> of the data are within the scope of the <code>dplyr</code> and <code>purrr</code> packages. All these packages work hand-in-hand really well, and analysis pipelines usually involve all of them. But today, we focus on the first member of this holy trinity, which is often the first one you’ll need because you will want to reshape your data before doing other things. So, please hold your non-layout-related questions for the next chapters.</p>
<div id="pivoting" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Pivoting</h3>
<p>Pivoting a dataset between the long and wide layout is the main purpose of <code>tidyr</code> (check out the package’s logo). We already saw the <code>pivot_longer</code> function above. This function converts a table form wide to long format. Similarly, there is a <code>pivot_wider</code> function that does exactly the opposite and takes you back to the wide format:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">pivot_wider</span>(</a>
<a class="sourceLine" id="cb39-2" title="2">  data,</a>
<a class="sourceLine" id="cb39-3" title="3">  <span class="dt">names_from =</span> <span class="st">&quot;variable&quot;</span>,</a>
<a class="sourceLine" id="cb39-4" title="4">  <span class="dt">values_from =</span> <span class="st">&quot;value&quot;</span>,</a>
<a class="sourceLine" id="cb39-5" title="5">  <span class="dt">id_cols =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;island&quot;</span>)</a>
<a class="sourceLine" id="cb39-6" title="6">)</a>
<a class="sourceLine" id="cb39-7" title="7"><span class="co">#&gt; # A tibble: 100 x 5</span></a>
<a class="sourceLine" id="cb39-8" title="8"><span class="co">#&gt;      id island  body_weight beak_length beak_width</span></a>
<a class="sourceLine" id="cb39-9" title="9"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb39-10" title="10"><span class="co">#&gt; 1     1 Isabela       10.8         4.94       1.94</span></a>
<a class="sourceLine" id="cb39-11" title="11"><span class="co">#&gt; 2     2 Isabela       15.4         5.02       2.00</span></a>
<a class="sourceLine" id="cb39-12" title="12"><span class="co">#&gt; 3     3 Isabela       15.0         4.92       1.91</span></a>
<a class="sourceLine" id="cb39-13" title="13"><span class="co">#&gt; 4     4 Isabela        8.51        5.16       2.02</span></a>
<a class="sourceLine" id="cb39-14" title="14"><span class="co">#&gt; 5     5 Isabela       14.9         5.03       1.93</span></a>
<a class="sourceLine" id="cb39-15" title="15"><span class="co">#&gt; 6     6 Isabela        8.41        4.92       2.18</span></a>
<a class="sourceLine" id="cb39-16" title="16"><span class="co">#&gt; # … with 94 more rows</span></a></code></pre></div>
<p>The order of the columns is not exactly as it was, but this should not matter in a data analysis pipeline where you should access columns by their names. It is straightforward to change the order of the columns, but this is more within the scope of the <code>dplyr</code> package.</p>
<p>If you are familiar with earlier versions of the tidyverse, <code>pivot_longer</code> and <code>pivot_wider</code> are the respective equivalents of <code>gather</code> and <code>spread</code>, which are now deprecated.</p>
<p>There are a few other reshaping operations from <code>tidyr</code> that are worth knowing.</p>
</div>
<div id="handling-missing-values" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Handling missing values</h3>
<p>Say we have some missing measurements in the column “value” of our finch dataset:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="co"># We replace 100 random observations by NAs</span></a>
<a class="sourceLine" id="cb40-2" title="2">ii &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(data), <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb40-3" title="3">data<span class="op">$</span>value[ii] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb40-4" title="4">data</a>
<a class="sourceLine" id="cb40-5" title="5"><span class="co">#&gt; # A tibble: 300 x 4</span></a>
<a class="sourceLine" id="cb40-6" title="6"><span class="co">#&gt;      id island  variable    value</span></a>
<a class="sourceLine" id="cb40-7" title="7"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb40-8" title="8"><span class="co">#&gt; 1     1 Isabela body_weight 10.8 </span></a>
<a class="sourceLine" id="cb40-9" title="9"><span class="co">#&gt; 2     1 Isabela beak_length NA   </span></a>
<a class="sourceLine" id="cb40-10" title="10"><span class="co">#&gt; 3     1 Isabela beak_width  NA   </span></a>
<a class="sourceLine" id="cb40-11" title="11"><span class="co">#&gt; 4     2 Isabela body_weight NA   </span></a>
<a class="sourceLine" id="cb40-12" title="12"><span class="co">#&gt; 5     2 Isabela beak_length  5.02</span></a>
<a class="sourceLine" id="cb40-13" title="13"><span class="co">#&gt; 6     2 Isabela beak_width  NA   </span></a>
<a class="sourceLine" id="cb40-14" title="14"><span class="co">#&gt; # … with 294 more rows</span></a></code></pre></div>
<p>We could get rid of the rows that have missing values using <code>drop_na</code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">drop_na</span>(data, value)</a>
<a class="sourceLine" id="cb41-2" title="2"><span class="co">#&gt; # A tibble: 200 x 4</span></a>
<a class="sourceLine" id="cb41-3" title="3"><span class="co">#&gt;      id island  variable    value</span></a>
<a class="sourceLine" id="cb41-4" title="4"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb41-5" title="5"><span class="co">#&gt; 1     1 Isabela body_weight 10.8 </span></a>
<a class="sourceLine" id="cb41-6" title="6"><span class="co">#&gt; 2     2 Isabela beak_length  5.02</span></a>
<a class="sourceLine" id="cb41-7" title="7"><span class="co">#&gt; 3     3 Isabela body_weight 15.0 </span></a>
<a class="sourceLine" id="cb41-8" title="8"><span class="co">#&gt; 4     3 Isabela beak_length  4.92</span></a>
<a class="sourceLine" id="cb41-9" title="9"><span class="co">#&gt; 5     4 Isabela body_weight  8.51</span></a>
<a class="sourceLine" id="cb41-10" title="10"><span class="co">#&gt; 6     4 Isabela beak_width   2.02</span></a>
<a class="sourceLine" id="cb41-11" title="11"><span class="co">#&gt; # … with 194 more rows</span></a></code></pre></div>
<p>Else, we could replace the NAs with some user-defined value:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="kw">replace_na</span>(data, <span class="dt">replace =</span> <span class="kw">list</span>(<span class="dt">value =</span> <span class="dv">-999</span>))</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="co">#&gt; # A tibble: 300 x 4</span></a>
<a class="sourceLine" id="cb42-3" title="3"><span class="co">#&gt;      id island  variable      value</span></a>
<a class="sourceLine" id="cb42-4" title="4"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb42-5" title="5"><span class="co">#&gt; 1     1 Isabela body_weight   10.8 </span></a>
<a class="sourceLine" id="cb42-6" title="6"><span class="co">#&gt; 2     1 Isabela beak_length -999   </span></a>
<a class="sourceLine" id="cb42-7" title="7"><span class="co">#&gt; 3     1 Isabela beak_width  -999   </span></a>
<a class="sourceLine" id="cb42-8" title="8"><span class="co">#&gt; 4     2 Isabela body_weight -999   </span></a>
<a class="sourceLine" id="cb42-9" title="9"><span class="co">#&gt; 5     2 Isabela beak_length    5.02</span></a>
<a class="sourceLine" id="cb42-10" title="10"><span class="co">#&gt; 6     2 Isabela beak_width  -999   </span></a>
<a class="sourceLine" id="cb42-11" title="11"><span class="co">#&gt; # … with 294 more rows</span></a></code></pre></div>
<p>where the <code>replace</code> argument takes a named list, and the names should refer to the columns to apply the replacement to.</p>
<p>We could also replace NAs with the most recent non-NA values:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">fill</span>(data, value)</a>
<a class="sourceLine" id="cb43-2" title="2"><span class="co">#&gt; # A tibble: 300 x 4</span></a>
<a class="sourceLine" id="cb43-3" title="3"><span class="co">#&gt;      id island  variable    value</span></a>
<a class="sourceLine" id="cb43-4" title="4"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb43-5" title="5"><span class="co">#&gt; 1     1 Isabela body_weight 10.8 </span></a>
<a class="sourceLine" id="cb43-6" title="6"><span class="co">#&gt; 2     1 Isabela beak_length 10.8 </span></a>
<a class="sourceLine" id="cb43-7" title="7"><span class="co">#&gt; 3     1 Isabela beak_width  10.8 </span></a>
<a class="sourceLine" id="cb43-8" title="8"><span class="co">#&gt; 4     2 Isabela body_weight 10.8 </span></a>
<a class="sourceLine" id="cb43-9" title="9"><span class="co">#&gt; 5     2 Isabela beak_length  5.02</span></a>
<a class="sourceLine" id="cb43-10" title="10"><span class="co">#&gt; 6     2 Isabela beak_width   5.02</span></a>
<a class="sourceLine" id="cb43-11" title="11"><span class="co">#&gt; # … with 294 more rows</span></a></code></pre></div>
<p>Note that most functions in the tidyverse take a tibble as their first argument, and columns to which to apply the functions are usually passed as “objects” rather than character strings. In the above example, we passed the <code>value</code> column as <code>value</code>, not <code>"value"</code>. These column-objects are called by the tidyverse functions <em>in the context</em> of the data (the tibble) they belong to.</p>
</div>
<div id="splitting-and-combining-cells" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Splitting and combining cells</h3>
<p>The <code>tidyr</code> package offers tools to split and combine columns. This is a nice extension to the string manipulations we saw last week in the <code>stringr</code> tutorial.</p>
<p>Say we want to add the specific dates when we took measurements on our birds (we would normally do this using <code>dplyr</code> but for now we will stick to the old way):</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="co"># Sample random dates for each observation</span></a>
<a class="sourceLine" id="cb44-2" title="2">data<span class="op">$</span>day &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">30</span>, <span class="kw">nrow</span>(data), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb44-3" title="3">data<span class="op">$</span>month &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">12</span>, <span class="kw">nrow</span>(data), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb44-4" title="4">data<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2020</span>, <span class="kw">nrow</span>(data), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb44-5" title="5">data</a>
<a class="sourceLine" id="cb44-6" title="6"><span class="co">#&gt; # A tibble: 300 x 7</span></a>
<a class="sourceLine" id="cb44-7" title="7"><span class="co">#&gt;      id island  variable    value   day month  year</span></a>
<a class="sourceLine" id="cb44-8" title="8"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb44-9" title="9"><span class="co">#&gt; 1     1 Isabela body_weight 10.8      8     7  2020</span></a>
<a class="sourceLine" id="cb44-10" title="10"><span class="co">#&gt; 2     1 Isabela beak_length NA       19     7  2019</span></a>
<a class="sourceLine" id="cb44-11" title="11"><span class="co">#&gt; 3     1 Isabela beak_width  NA       17    12  2019</span></a>
<a class="sourceLine" id="cb44-12" title="12"><span class="co">#&gt; 4     2 Isabela body_weight NA       20    12  2020</span></a>
<a class="sourceLine" id="cb44-13" title="13"><span class="co">#&gt; 5     2 Isabela beak_length  5.02    21    10  2020</span></a>
<a class="sourceLine" id="cb44-14" title="14"><span class="co">#&gt; 6     2 Isabela beak_width  NA       23     2  2020</span></a>
<a class="sourceLine" id="cb44-15" title="15"><span class="co">#&gt; # … with 294 more rows</span></a></code></pre></div>
<p>We could combine the <code>day</code>, <code>month</code> and <code>year</code> columns into a single <code>date</code> column, with a dash as a separator, using <code>unite</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">data &lt;-<span class="st"> </span><span class="kw">unite</span>(data, day, month, year, <span class="dt">col =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>)</a>
<a class="sourceLine" id="cb45-2" title="2">data</a>
<a class="sourceLine" id="cb45-3" title="3"><span class="co">#&gt; # A tibble: 300 x 5</span></a>
<a class="sourceLine" id="cb45-4" title="4"><span class="co">#&gt;      id island  variable    value date      </span></a>
<a class="sourceLine" id="cb45-5" title="5"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb45-6" title="6"><span class="co">#&gt; 1     1 Isabela body_weight 10.8  8-7-2020  </span></a>
<a class="sourceLine" id="cb45-7" title="7"><span class="co">#&gt; 2     1 Isabela beak_length NA    19-7-2019 </span></a>
<a class="sourceLine" id="cb45-8" title="8"><span class="co">#&gt; 3     1 Isabela beak_width  NA    17-12-2019</span></a>
<a class="sourceLine" id="cb45-9" title="9"><span class="co">#&gt; 4     2 Isabela body_weight NA    20-12-2020</span></a>
<a class="sourceLine" id="cb45-10" title="10"><span class="co">#&gt; 5     2 Isabela beak_length  5.02 21-10-2020</span></a>
<a class="sourceLine" id="cb45-11" title="11"><span class="co">#&gt; 6     2 Isabela beak_width  NA    23-2-2020 </span></a>
<a class="sourceLine" id="cb45-12" title="12"><span class="co">#&gt; # … with 294 more rows</span></a></code></pre></div>
<p>Of course, we can revert back to the previous dataset by splitting the <code>date</code> column with <code>separate</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="kw">separate</span>(data, date, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;day&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;year&quot;</span>))</a>
<a class="sourceLine" id="cb46-2" title="2"><span class="co">#&gt; # A tibble: 300 x 7</span></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="co">#&gt;      id island  variable    value day   month year </span></a>
<a class="sourceLine" id="cb46-4" title="4"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb46-5" title="5"><span class="co">#&gt; 1     1 Isabela body_weight 10.8  8     7     2020 </span></a>
<a class="sourceLine" id="cb46-6" title="6"><span class="co">#&gt; 2     1 Isabela beak_length NA    19    7     2019 </span></a>
<a class="sourceLine" id="cb46-7" title="7"><span class="co">#&gt; 3     1 Isabela beak_width  NA    17    12    2019 </span></a>
<a class="sourceLine" id="cb46-8" title="8"><span class="co">#&gt; 4     2 Isabela body_weight NA    20    12    2020 </span></a>
<a class="sourceLine" id="cb46-9" title="9"><span class="co">#&gt; 5     2 Isabela beak_length  5.02 21    10    2020 </span></a>
<a class="sourceLine" id="cb46-10" title="10"><span class="co">#&gt; 6     2 Isabela beak_width  NA    23    2     2020 </span></a>
<a class="sourceLine" id="cb46-11" title="11"><span class="co">#&gt; # … with 294 more rows</span></a></code></pre></div>
<p>But note that the <code>day</code>, <code>month</code> and <code>year</code> columns are now of class <code>character</code> and not <code>integer</code> anymore. This is because they result from the splitting of <code>date</code>, which itself was a <code>character</code> column.</p>
<p>You can also separate a single column into multiple <em>rows</em> using <code>separate_rows</code>:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="kw">separate_rows</span>(data, date)</a>
<a class="sourceLine" id="cb47-2" title="2"><span class="co">#&gt; # A tibble: 900 x 5</span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="co">#&gt;      id island  variable    value date </span></a>
<a class="sourceLine" id="cb47-4" title="4"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb47-5" title="5"><span class="co">#&gt; 1     1 Isabela body_weight  10.8 8    </span></a>
<a class="sourceLine" id="cb47-6" title="6"><span class="co">#&gt; 2     1 Isabela body_weight  10.8 7    </span></a>
<a class="sourceLine" id="cb47-7" title="7"><span class="co">#&gt; 3     1 Isabela body_weight  10.8 2020 </span></a>
<a class="sourceLine" id="cb47-8" title="8"><span class="co">#&gt; 4     1 Isabela beak_length  NA   19   </span></a>
<a class="sourceLine" id="cb47-9" title="9"><span class="co">#&gt; 5     1 Isabela beak_length  NA   7    </span></a>
<a class="sourceLine" id="cb47-10" title="10"><span class="co">#&gt; 6     1 Isabela beak_length  NA   2019 </span></a>
<a class="sourceLine" id="cb47-11" title="11"><span class="co">#&gt; # … with 894 more rows</span></a></code></pre></div>
</div>
<div id="expanding-tables-using-combinations" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Expanding tables using combinations</h3>
<p>Instead of getting rid of rows with NAs, we may want to add rows with NAs, for example, for combinations of parameters that we did not measure.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">data &lt;-<span class="st"> </span><span class="kw">separate</span>(data, date, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;day&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;year&quot;</span>))</a>
<a class="sourceLine" id="cb48-2" title="2">to_rm &lt;-<span class="st"> </span><span class="kw">with</span>(data, island <span class="op">==</span><span class="st"> &quot;Santa Cruz&quot;</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">==</span><span class="st"> &quot;2020&quot;</span>)</a>
<a class="sourceLine" id="cb48-3" title="3">data &lt;-<span class="st"> </span>data[<span class="op">!</span>to_rm,]</a>
<a class="sourceLine" id="cb48-4" title="4"><span class="kw">tail</span>(data)</a>
<a class="sourceLine" id="cb48-5" title="5"><span class="co">#&gt; # A tibble: 6 x 7</span></a>
<a class="sourceLine" id="cb48-6" title="6"><span class="co">#&gt;      id island     variable    value day   month year </span></a>
<a class="sourceLine" id="cb48-7" title="7"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb48-8" title="8"><span class="co">#&gt; 1    98 Santa Cruz beak_length  4.94 22    12    2019 </span></a>
<a class="sourceLine" id="cb48-9" title="9"><span class="co">#&gt; 2    98 Santa Cruz beak_width   1.90 9     1     2019 </span></a>
<a class="sourceLine" id="cb48-10" title="10"><span class="co">#&gt; 3    99 Santa Cruz body_weight 15.0  16    7     2019 </span></a>
<a class="sourceLine" id="cb48-11" title="11"><span class="co">#&gt; 4    99 Santa Cruz beak_length NA    26    10    2019 </span></a>
<a class="sourceLine" id="cb48-12" title="12"><span class="co">#&gt; 5    99 Santa Cruz beak_width   2.04 30    7     2019 </span></a>
<a class="sourceLine" id="cb48-13" title="13"><span class="co">#&gt; 6   100 Santa Cruz beak_width  NA    23    3     2019</span></a></code></pre></div>
<p>We could generate a tibble with all combinations of island, morphometric and year using <code>expand_grid</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">expand_grid</span>(</a>
<a class="sourceLine" id="cb49-2" title="2">  <span class="dt">island =</span> <span class="kw">c</span>(<span class="st">&quot;Isabela&quot;</span>, <span class="st">&quot;Santa Cruz&quot;</span>),</a>
<a class="sourceLine" id="cb49-3" title="3">  <span class="dt">year =</span> <span class="kw">c</span>(<span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>)</a>
<a class="sourceLine" id="cb49-4" title="4">)</a>
<a class="sourceLine" id="cb49-5" title="5"><span class="co">#&gt; # A tibble: 4 x 2</span></a>
<a class="sourceLine" id="cb49-6" title="6"><span class="co">#&gt;   island     year </span></a>
<a class="sourceLine" id="cb49-7" title="7"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb49-8" title="8"><span class="co">#&gt; 1 Isabela    2019 </span></a>
<a class="sourceLine" id="cb49-9" title="9"><span class="co">#&gt; 2 Isabela    2020 </span></a>
<a class="sourceLine" id="cb49-10" title="10"><span class="co">#&gt; 3 Santa Cruz 2019 </span></a>
<a class="sourceLine" id="cb49-11" title="11"><span class="co">#&gt; 4 Santa Cruz 2020</span></a></code></pre></div>
<p>If we already have a tibble to work from that contains the variables to combine, we can use <code>expand</code> on that tibble:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="kw">expand</span>(data, island, year)</a>
<a class="sourceLine" id="cb50-2" title="2"><span class="co">#&gt; # A tibble: 4 x 2</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="co">#&gt;   island     year </span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb50-5" title="5"><span class="co">#&gt; 1 Isabela    2019 </span></a>
<a class="sourceLine" id="cb50-6" title="6"><span class="co">#&gt; 2 Isabela    2020 </span></a>
<a class="sourceLine" id="cb50-7" title="7"><span class="co">#&gt; 3 Santa Cruz 2019 </span></a>
<a class="sourceLine" id="cb50-8" title="8"><span class="co">#&gt; 4 Santa Cruz 2020</span></a></code></pre></div>
<p>As you can see, we get all the combinations of the variables of interest, even those that are missing. But sometimes you might be interested in variables that are <em>nested</em> within each other and not <em>crossed</em>. For example, say we have measured birds at different locations within each island:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">nrow_Isabela &lt;-<span class="st"> </span><span class="kw">with</span>(data, <span class="kw">length</span>(<span class="kw">which</span>(island <span class="op">==</span><span class="st"> &quot;Isabela&quot;</span>)))</a>
<a class="sourceLine" id="cb51-2" title="2">nrow_SantaCruz &lt;-<span class="st"> </span><span class="kw">with</span>(data, <span class="kw">length</span>(<span class="kw">which</span>(island <span class="op">==</span><span class="st"> &quot;Santa Cruz&quot;</span>)))</a>
<a class="sourceLine" id="cb51-3" title="3">sites_Isabela &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">size =</span> nrow_Isabela, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb51-4" title="4">sites_SantaCruz &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="dt">size =</span> nrow_SantaCruz, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb51-5" title="5">sites &lt;-<span class="st"> </span><span class="kw">c</span>(sites_Isabela, sites_SantaCruz)</a>
<a class="sourceLine" id="cb51-6" title="6">data<span class="op">$</span>site &lt;-<span class="st"> </span>sites</a>
<a class="sourceLine" id="cb51-7" title="7">data</a>
<a class="sourceLine" id="cb51-8" title="8"><span class="co">#&gt; # A tibble: 232 x 8</span></a>
<a class="sourceLine" id="cb51-9" title="9"><span class="co">#&gt;      id island  variable    value day   month year  site </span></a>
<a class="sourceLine" id="cb51-10" title="10"><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb51-11" title="11"><span class="co">#&gt; 1     1 Isabela body_weight 10.8  8     7     2020  A    </span></a>
<a class="sourceLine" id="cb51-12" title="12"><span class="co">#&gt; 2     1 Isabela beak_length NA    19    7     2019  B    </span></a>
<a class="sourceLine" id="cb51-13" title="13"><span class="co">#&gt; 3     1 Isabela beak_width  NA    17    12    2019  B    </span></a>
<a class="sourceLine" id="cb51-14" title="14"><span class="co">#&gt; 4     2 Isabela body_weight NA    20    12    2020  A    </span></a>
<a class="sourceLine" id="cb51-15" title="15"><span class="co">#&gt; 5     2 Isabela beak_length  5.02 21    10    2020  A    </span></a>
<a class="sourceLine" id="cb51-16" title="16"><span class="co">#&gt; 6     2 Isabela beak_width  NA    23    2     2020  A    </span></a>
<a class="sourceLine" id="cb51-17" title="17"><span class="co">#&gt; # … with 226 more rows</span></a></code></pre></div>
<p>Of course, if sites A and B are on Isabela, they cannot be on Santa Cruz, where we have sites C and D instead. It would not make sense to <code>expand</code> assuming that <code>island</code> and <code>site</code> are crossed, instead, they are nested. We can therefore expand using the <code>nesting</code> function:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">expand</span>(data, <span class="kw">nesting</span>(island, site, year))</a>
<a class="sourceLine" id="cb52-2" title="2"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb52-3" title="3"><span class="co">#&gt;   island     site  year </span></a>
<a class="sourceLine" id="cb52-4" title="4"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb52-5" title="5"><span class="co">#&gt; 1 Isabela    A     2019 </span></a>
<a class="sourceLine" id="cb52-6" title="6"><span class="co">#&gt; 2 Isabela    A     2020 </span></a>
<a class="sourceLine" id="cb52-7" title="7"><span class="co">#&gt; 3 Isabela    B     2019 </span></a>
<a class="sourceLine" id="cb52-8" title="8"><span class="co">#&gt; 4 Isabela    B     2020 </span></a>
<a class="sourceLine" id="cb52-9" title="9"><span class="co">#&gt; 5 Santa Cruz C     2019 </span></a>
<a class="sourceLine" id="cb52-10" title="10"><span class="co">#&gt; 6 Santa Cruz D     2019</span></a></code></pre></div>
<p>But now the missing data for Santa Cruz in 2020 are not accounted for because <code>expand</code> thinks the <code>year</code> is also nested within island. To get back the missing combination, we use <code>crossing</code>, the complement of <code>nesting</code>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="kw">expand</span>(data, <span class="kw">crossing</span>(<span class="kw">nesting</span>(island, site), year)) <span class="co"># both can be used together</span></a>
<a class="sourceLine" id="cb53-2" title="2"><span class="co">#&gt; # A tibble: 8 x 3</span></a>
<a class="sourceLine" id="cb53-3" title="3"><span class="co">#&gt;   island     site  year </span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="co">#&gt; 1 Isabela    A     2019 </span></a>
<a class="sourceLine" id="cb53-6" title="6"><span class="co">#&gt; 2 Isabela    A     2020 </span></a>
<a class="sourceLine" id="cb53-7" title="7"><span class="co">#&gt; 3 Isabela    B     2019 </span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="co">#&gt; 4 Isabela    B     2020 </span></a>
<a class="sourceLine" id="cb53-9" title="9"><span class="co">#&gt; 5 Santa Cruz C     2019 </span></a>
<a class="sourceLine" id="cb53-10" title="10"><span class="co">#&gt; 6 Santa Cruz C     2020 </span></a>
<a class="sourceLine" id="cb53-11" title="11"><span class="co">#&gt; # … with 2 more rows</span></a></code></pre></div>
<p>Here, we specify that <code>site</code> is nested within <code>island</code> and these two are crossed with <code>year</code>. Easy!</p>
<p>But wait a minute. These combinations are all very good, but our measurements have disappeared! We can get them back by levelling up to the <code>complete</code> function instead of using <code>expand</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="kw">tail</span>(<span class="kw">complete</span>(data, <span class="kw">crossing</span>(<span class="kw">nesting</span>(island, site), year)))</a>
<a class="sourceLine" id="cb54-2" title="2"><span class="co">#&gt; # A tibble: 6 x 8</span></a>
<a class="sourceLine" id="cb54-3" title="3"><span class="co">#&gt;   island     site  year     id variable    value day   month</span></a>
<a class="sourceLine" id="cb54-4" title="4"><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb54-5" title="5"><span class="co">#&gt; 1 Santa Cruz D     2019     95 beak_width  NA    13    10   </span></a>
<a class="sourceLine" id="cb54-6" title="6"><span class="co">#&gt; 2 Santa Cruz D     2019     98 beak_length  4.94 22    12   </span></a>
<a class="sourceLine" id="cb54-7" title="7"><span class="co">#&gt; 3 Santa Cruz D     2019     99 body_weight 15.0  16    7    </span></a>
<a class="sourceLine" id="cb54-8" title="8"><span class="co">#&gt; 4 Santa Cruz D     2019     99 beak_length NA    26    10   </span></a>
<a class="sourceLine" id="cb54-9" title="9"><span class="co">#&gt; 5 Santa Cruz D     2019     99 beak_width   2.04 30    7    </span></a>
<a class="sourceLine" id="cb54-10" title="10"><span class="co">#&gt; 6 Santa Cruz D     2020     NA &lt;NA&gt;        NA    &lt;NA&gt;  &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb54-11" title="11"><span class="co"># the last row has been added, full of NAs</span></a></code></pre></div>
<p>which nicely keeps the rest of the columns in the tibble and just adds the missing combinations.</p>
</div>
<div id="nesting" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Nesting</h3>
<p>The <code>tidyr</code> package has yet another feature that makes the tidyverse very powerful: the <code>nest</code> function. However, it makes little sense without combining it with the functions in the <code>purrr</code> package, so we will not cover it in this chapter but rather in the <code>purrr</code> chapter.</p>
</div>
<div id="what-else-can-be-tidied-up" class="section level3">
<h3><span class="header-section-number">2.3.6</span> What else can be tidied up?</h3>
<div id="model-output-with-broom" class="section level4">
<h4><span class="header-section-number">2.3.6.1</span> Model output with <code>broom</code></h4>
<p>Check out the <a href="https://cran.r-project.org/web/packages/broom/vignettes/broom.html"><code>broom</code></a> package and its <code>tidy</code> function to tidy up messy linear model output, e.g.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb55-2" title="2">fit &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>cyl, mtcars)</a>
<a class="sourceLine" id="cb55-3" title="3"><span class="kw">summary</span>(fit)</a>
<a class="sourceLine" id="cb55-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb55-5" title="5"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb55-6" title="6"><span class="co">#&gt; lm(formula = mpg ~ cyl, data = mtcars)</span></a>
<a class="sourceLine" id="cb55-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb55-8" title="8"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb55-9" title="9"><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></a>
<a class="sourceLine" id="cb55-10" title="10"><span class="co">#&gt; -4.981 -2.119  0.222  1.072  7.519 </span></a>
<a class="sourceLine" id="cb55-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb55-12" title="12"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb55-13" title="13"><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb55-14" title="14"><span class="co">#&gt; (Intercept)   37.885      2.074   18.27  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb55-15" title="15"><span class="co">#&gt; cyl           -2.876      0.322   -8.92  6.1e-10 ***</span></a>
<a class="sourceLine" id="cb55-16" title="16"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb55-17" title="17"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb55-18" title="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb55-19" title="19"><span class="co">#&gt; Residual standard error: 3.21 on 30 degrees of freedom</span></a>
<a class="sourceLine" id="cb55-20" title="20"><span class="co">#&gt; Multiple R-squared:  0.726,  Adjusted R-squared:  0.717 </span></a>
<a class="sourceLine" id="cb55-21" title="21"><span class="co">#&gt; F-statistic: 79.6 on 1 and 30 DF,  p-value: 6.11e-10</span></a>
<a class="sourceLine" id="cb55-22" title="22"><span class="kw">tidy</span>(fit) <span class="co"># returns a tibble</span></a>
<a class="sourceLine" id="cb55-23" title="23"><span class="co">#&gt; # A tibble: 2 x 5</span></a>
<a class="sourceLine" id="cb55-24" title="24"><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></a>
<a class="sourceLine" id="cb55-25" title="25"><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb55-26" title="26"><span class="co">#&gt; 1 (Intercept)    37.9      2.07      18.3  8.37e-18</span></a>
<a class="sourceLine" id="cb55-27" title="27"><span class="co">#&gt; 2 cyl            -2.88     0.322     -8.92 6.11e-10</span></a></code></pre></div>
<p>The <code>broom</code> package is just one package among a series of packages together known as <a href="https://www.tidymodels.org/">tidymodels</a> that deal with statistical models according to the tidyverse philosophy, and those include machine learning models.</p>
</div>
<div id="graphs-with-tidygraph" class="section level4">
<h4><span class="header-section-number">2.3.6.2</span> Graphs with <code>tidygraph</code></h4>
<p>For some datasets, sometimes there is no trivial and intuitive way to store them into a table. This is the case, for example, for data underlying graphs (as in networks), which contain information about relations between entities. What is the unit of observation in a network? A node? An edge between two nodes? Nodes and edges in a network may each have node- or edge-specific variables mapped to them, and both may be equally valid units of observation. The <a href="https://www.data-imaginist.com/2017/introducing-tidygraph/"><code>tidygraph</code></a> package has tools to store graph-data in a tidyverse-friendly object, consisting of two tibbles: one for node-specific information, the other for edge-specific information. This package goes hand in hand with the <a href="https://ggraph.data-imaginist.com/"><code>ggraph</code></a>, that makes plotting networks compatible with the grammar of graphics.</p>
</div>
<div id="trees-with-tidytree" class="section level4">
<h4><span class="header-section-number">2.3.6.3</span> Trees with <code>tidytree</code></h4>
<p>Phylogenetic trees are a special type of graphs suffering from the same issue, i.e. of being non-trivial to store in a table. The <a href="https://yulab-smu.github.io/treedata-book/"><code>tidytree</code></a> package and its companion <code>treeio</code> offer an interface to convert tree-like objects (from most format used by other packages and software) into a tidyverse-friendly format. Again, the point is that the rest of the tidyverse can be used to wrangle or plot this type of data in the same way as one would do with regular tabular data. For plotting a <code>tidytree</code> with the grammar of graphics, see <a href="https://guangchuangyu.github.io/ggtree-book/chapter-ggtree.html"><code>ggtree</code></a>.</p>
</div>
</div>
</div>
<div id="extra-factors-and-the-forcats-package" class="section level2">
<h2><span class="header-section-number">2.4</span> Extra: factors and the <code>forcats</code> package</h2>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="kw">library</span>(forcats)</a></code></pre></div>
<p>Categorical variables can be stored in R as character strings in <code>character</code> or <code>factor</code> objects. A <code>factor</code> looks like a <code>character</code>, but it actually is an <code>integer</code> vector, where each <code>integer</code> is mapped to a <code>character</code> label. With this respect it is sort of an enhanced version of <code>character</code>. For example,</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1">my_char_vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Pratik&quot;</span>, <span class="st">&quot;Theo&quot;</span>, <span class="st">&quot;Raph&quot;</span>)</a>
<a class="sourceLine" id="cb57-2" title="2">my_char_vec</a>
<a class="sourceLine" id="cb57-3" title="3"><span class="co">#&gt; [1] &quot;Pratik&quot; &quot;Theo&quot;   &quot;Raph&quot;</span></a></code></pre></div>
<p>is a <code>character</code> vector, recognizable to its double quotes, while</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1">my_fact_vec &lt;-<span class="st"> </span><span class="kw">factor</span>(my_char_vec) <span class="co"># as.factor would work too</span></a>
<a class="sourceLine" id="cb58-2" title="2">my_fact_vec</a>
<a class="sourceLine" id="cb58-3" title="3"><span class="co">#&gt; [1] Pratik Theo   Raph  </span></a>
<a class="sourceLine" id="cb58-4" title="4"><span class="co">#&gt; Levels: Pratik Raph Theo</span></a></code></pre></div>
<p>is a <code>factor</code>, of which the <em>labels</em> are displayed. The <em>levels</em> of the factor are the unique values that appear in the vector. If I added an extra occurrence of my name:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1"><span class="kw">factor</span>(<span class="kw">c</span>(my_char_vec, <span class="st">&quot;Raph&quot;</span>))</a>
<a class="sourceLine" id="cb59-2" title="2"><span class="co">#&gt; [1] Pratik Theo   Raph   Raph  </span></a>
<a class="sourceLine" id="cb59-3" title="3"><span class="co">#&gt; Levels: Pratik Raph Theo</span></a></code></pre></div>
<p>we would still have the the same levels. Note that the levels are returned as a <code>character</code> vector in alphabetical order by the <code>levels</code> function:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="kw">levels</span>(my_fact_vec)</a>
<a class="sourceLine" id="cb60-2" title="2"><span class="co">#&gt; [1] &quot;Pratik&quot; &quot;Raph&quot;   &quot;Theo&quot;</span></a></code></pre></div>
<p>Why does it matter? Well, most operations on categorical variables can be performed on <code>character</code> of <code>factor</code> objects, so it does not matter so much which one you use for your own data. However, some functions in R require you to provide categorical variables in one specific format, and others may even implicitely convert your variables. In <code>ggplot2</code> for example, character vectors are converted into factors by default. So, it is always good to remember the differences and what type your variables are.</p>
<p>But this is a tidyverse tutorial, so I would like to introduce here the package <code>forcats</code>, which offers tools to manipulate factors. First of all, most tools from <code>stringr</code> <em>will work</em> on factors. The <code>forcats</code> functions expand the string manipulation toolbox with factor-specific utilities. Similar in philosophy to <code>stringr</code> where functions started with <code>str_</code>, in <code>forcats</code> most functions start with <code>fct_</code>.</p>
<p>I see two main ways <code>forcats</code> can come handy in the kind of data most people deal with: playing with the order of the levels of a factor and playing with the levels themselves. We will show here a few examples, but the full breadth of factor manipulations can be found online or in the excellent <code>forcats</code> cheatsheet.</p>
<div id="change-the-order-of-the-levels" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Change the order of the levels</h3>
<p>One example use-case where you would want to change the order of the levels of a factor is when plotting. Your categorical variable, for example, may not be plotted in the order you want. If we plot the distribution of each variable across islands, we get</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1"><span class="co"># Make the plotting code a function so we can re-use it without copying and pasting</span></a>
<a class="sourceLine" id="cb61-2" title="2">my_plot &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb61-3" title="3"></a>
<a class="sourceLine" id="cb61-4" title="4">  <span class="co"># We do not cover the ggplot functions in this chapter, this is just to</span></a>
<a class="sourceLine" id="cb61-5" title="5">  <span class="co"># illustrate our use-case, wait until chapter 5!</span></a>
<a class="sourceLine" id="cb61-6" title="6">  <span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb61-7" title="7">  <span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x =</span> island, <span class="dt">y =</span> value, <span class="dt">color =</span> island)) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-8" title="8"><span class="st">    </span><span class="kw">geom_violin</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb61-9" title="9"><span class="st">    </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-10" title="10"><span class="st">    </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>year, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb61-11" title="11"><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb61-12" title="12"><span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;forestgreen&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>))</a>
<a class="sourceLine" id="cb61-13" title="13"></a>
<a class="sourceLine" id="cb61-14" title="14">}</a>
<a class="sourceLine" id="cb61-15" title="15"></a>
<a class="sourceLine" id="cb61-16" title="16"><span class="kw">my_plot</span>(data)</a>
<a class="sourceLine" id="cb61-17" title="17"><span class="co"># Remember that data are missing from Santa Cruz in 2020</span></a></code></pre></div>
<p><img src="TRES-Tidy-Tutorial_files/figure-html/unnamed-chunk-61-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
<p>Here, the islands (horizontal axis) and the variables (the facets) are displayed in alphabetical order. When making a figure you may want to customize these orders in such a way that your message is optimally conveyed by your figure, and this may involve playing with the order of levels.</p>
<p>Use <code>fct_relevel</code> to manually change the order of the levels:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1">data<span class="op">$</span>island &lt;-<span class="st"> </span><span class="kw">as.factor</span>(data<span class="op">$</span>island) <span class="co"># turn this column into a factor</span></a>
<a class="sourceLine" id="cb62-2" title="2">data<span class="op">$</span>island &lt;-<span class="st"> </span><span class="kw">fct_relevel</span>(data<span class="op">$</span>island, <span class="kw">c</span>(<span class="st">&quot;Santa Cruz&quot;</span>, <span class="st">&quot;Isabela&quot;</span>))</a>
<a class="sourceLine" id="cb62-3" title="3"><span class="kw">my_plot</span>(data) <span class="co"># order of islands has changed!</span></a></code></pre></div>
<p><img src="TRES-Tidy-Tutorial_files/figure-html/unnamed-chunk-62-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
<p>Beware that reordering a factor <em>does not change</em> the order of the items within the vector, only the order of the <em>levels</em>. So, it does not introduce any mistmatch between the <code>island</code> column and the other columns! It only matters when the levels are called, for example, in a <code>ggplot</code>. As you can see:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">data<span class="op">$</span>island[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb63-2" title="2"><span class="co">#&gt;  [1] Isabela Isabela Isabela Isabela Isabela Isabela Isabela Isabela Isabela</span></a>
<a class="sourceLine" id="cb63-3" title="3"><span class="co">#&gt; [10] Isabela</span></a>
<a class="sourceLine" id="cb63-4" title="4"><span class="co">#&gt; Levels: Santa Cruz Isabela</span></a>
<a class="sourceLine" id="cb63-5" title="5"><span class="kw">fct_relevel</span>(data<span class="op">$</span>island, <span class="kw">c</span>(<span class="st">&quot;Isabela&quot;</span>, <span class="st">&quot;Santa Cruz&quot;</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>] <span class="co"># same thing, different levels</span></a>
<a class="sourceLine" id="cb63-6" title="6"><span class="co">#&gt;  [1] Isabela Isabela Isabela Isabela Isabela Isabela Isabela Isabela Isabela</span></a>
<a class="sourceLine" id="cb63-7" title="7"><span class="co">#&gt; [10] Isabela</span></a>
<a class="sourceLine" id="cb63-8" title="8"><span class="co">#&gt; Levels: Isabela Santa Cruz</span></a></code></pre></div>
<p>Alternatively, use <code>fct_inorder</code> to set the order of the levels to the order in which they appear:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1">data<span class="op">$</span>variable &lt;-<span class="st"> </span><span class="kw">as.factor</span>(data<span class="op">$</span>variable)</a>
<a class="sourceLine" id="cb64-2" title="2"><span class="kw">levels</span>(data<span class="op">$</span>variable)</a>
<a class="sourceLine" id="cb64-3" title="3"><span class="co">#&gt; [1] &quot;beak_length&quot; &quot;beak_width&quot;  &quot;body_weight&quot;</span></a>
<a class="sourceLine" id="cb64-4" title="4"><span class="kw">levels</span>(<span class="kw">fct_inorder</span>(data<span class="op">$</span>variable))</a>
<a class="sourceLine" id="cb64-5" title="5"><span class="co">#&gt; [1] &quot;body_weight&quot; &quot;beak_length&quot; &quot;beak_width&quot;</span></a></code></pre></div>
<p>or <code>fct_rev</code> to reverse the order of the levels:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1"><span class="kw">levels</span>(<span class="kw">fct_rev</span>(data<span class="op">$</span>island)) <span class="co"># back in the alphabetical order</span></a>
<a class="sourceLine" id="cb65-2" title="2"><span class="co">#&gt; [1] &quot;Isabela&quot;    &quot;Santa Cruz&quot;</span></a></code></pre></div>
<p>Other variants exist to do more complex reordering, all present in the forcats <a href="https://rstudio.com/resources/cheatsheets/">cheatsheet</a>, for example:
* <code>fct_infreq</code> to re-order according to the frequency of each level (how many observation on each island?)
* <code>fct_shift</code> to shift the order of all levels by a certain rank (in a circular way so that the last one becomes the first one or vice versa)
* <code>fct_shuffle</code> if you want your levels in random order
* <code>fct_reorder</code>, which reorders based on an associated variable (see <code>fct_reorder2</code> for even more complex relationship between the factor and the associated variable)</p>
</div>
<div id="change-the-levels-themselves" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Change the levels themselves</h3>
<p>Changing the levels of a factor will change the labels in the actual vector. It is similar to performing a string substitution in <code>stringr</code>. One can change the levels of a factor using <code>fct_recode</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1"><span class="kw">fct_recode</span>(</a>
<a class="sourceLine" id="cb66-2" title="2">  my_fact_vec,</a>
<a class="sourceLine" id="cb66-3" title="3">  <span class="st">&quot;Pratik Gupte&quot;</span> =<span class="st"> &quot;Pratik&quot;</span>,</a>
<a class="sourceLine" id="cb66-4" title="4">  <span class="st">&quot;Theo Pannetier&quot;</span> =<span class="st"> &quot;Theo&quot;</span>,</a>
<a class="sourceLine" id="cb66-5" title="5">  <span class="st">&quot;Raphael Scherrer&quot;</span> =<span class="st"> &quot;Raph&quot;</span></a>
<a class="sourceLine" id="cb66-6" title="6">)</a>
<a class="sourceLine" id="cb66-7" title="7"><span class="co">#&gt; [1] Pratik Gupte     Theo Pannetier   Raphael Scherrer</span></a>
<a class="sourceLine" id="cb66-8" title="8"><span class="co">#&gt; Levels: Pratik Gupte Raphael Scherrer Theo Pannetier</span></a></code></pre></div>
<p>or collapse factor levels together using <code>fct_collapse</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1"><span class="kw">fct_collapse</span>(my_fact_vec, <span class="dt">EU =</span> <span class="kw">c</span>(<span class="st">&quot;Theo&quot;</span>, <span class="st">&quot;Raph&quot;</span>), <span class="dt">NonEU =</span> <span class="st">&quot;Pratik&quot;</span>)</a>
<a class="sourceLine" id="cb67-2" title="2"><span class="co">#&gt; [1] NonEU EU    EU   </span></a>
<a class="sourceLine" id="cb67-3" title="3"><span class="co">#&gt; Levels: NonEU EU</span></a></code></pre></div>
<p>Again, we do not provide an exhaustive list of <code>forcats</code> functions here but the most usual ones, to give a glimpse of many things that one can do with factors. So, if you are dealing with factors, remember that <code>forcats</code> may have handy tools for you. Among others:
* <code>fct_anon</code> to “anonymize”, i.e. replace the levels by random integers
* <code>fct_lump</code> to collapse levels together based on their frequency (e.g. the two most frequent levels together)</p>
</div>
<div id="dropping-levels" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Dropping levels</h3>
<p>If you use factors in your tibble and get rid of one level, for any reason, the factor will usually remember the old levels, which may cause some problems when applying functions to your data.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1">data &lt;-<span class="st"> </span>data[data<span class="op">$</span>island <span class="op">==</span><span class="st"> &quot;Santa Cruz&quot;</span>,] <span class="co"># keep only one island</span></a>
<a class="sourceLine" id="cb68-2" title="2"><span class="kw">unique</span>(data<span class="op">$</span>island) <span class="co"># Isabela is gone from the labels</span></a>
<a class="sourceLine" id="cb68-3" title="3"><span class="co">#&gt; [1] Santa Cruz</span></a>
<a class="sourceLine" id="cb68-4" title="4"><span class="co">#&gt; Levels: Santa Cruz Isabela</span></a>
<a class="sourceLine" id="cb68-5" title="5"><span class="kw">levels</span>(data<span class="op">$</span>island) <span class="co"># but not from the levels</span></a>
<a class="sourceLine" id="cb68-6" title="6"><span class="co">#&gt; [1] &quot;Santa Cruz&quot; &quot;Isabela&quot;</span></a></code></pre></div>
<p>Use <code>droplevels</code> (from base R) to make sure you get rid of levels that are not in your data anymore:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">data &lt;-<span class="st"> </span><span class="kw">droplevels</span>(data)</a>
<a class="sourceLine" id="cb69-2" title="2"><span class="kw">levels</span>(data<span class="op">$</span>island)</a>
<a class="sourceLine" id="cb69-3" title="3"><span class="co">#&gt; [1] &quot;Santa Cruz&quot;</span></a></code></pre></div>
<p>Fortunately, most functions within the tidyverse will not complain about missing levels, and will automatically get rid of those inexistant levels for you. But because factors are such common causes of bugs, keep this in mind!</p>
<p>Note that this is equivalent to doing:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1">data<span class="op">$</span>island &lt;-<span class="st"> </span><span class="kw">fct_drop</span>(data<span class="op">$</span>island)</a></code></pre></div>
</div>
<div id="other-things" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Other things</h3>
<p>Among other things you can use in <code>forcats</code>:
* <code>fct_count</code> to get the frequency of each level
* <code>fct_c</code> to combine factors together</p>
</div>
<div id="take-home-message-for-forcats" class="section level3">
<h3><span class="header-section-number">2.4.5</span> Take home message for forcats</h3>
<p>Use this package to manipulate your factors. Do you need factors? Or are character vectors enough? That is your call, and may depend on the kind of analyses you want to do and what they require. We saw here that for plotting, having factors can allow you to do quite some tweaking of the display. If you encounter a situation where the order of encoding of your character vector starts to matter, then maybe converting into a factor would make your life easier. And if you do so, remember that lots of tools to perform all kinds of manipulation are available to you with both <code>stringr</code>and <code>forcats</code>.</p>
</div>
</div>
<div id="external-resources" class="section level2">
<h2><span class="header-section-number">2.5</span> External resources</h2>
<p>Find lots of additional info by looking up the following links:</p>
<ul>
<li>The <code>readr</code>/<code>tibble</code>/<code>tidyr</code> and <code>forcats</code> <a href="https://rstudio.com/resources/cheatsheets/">cheatsheets</a>.</li>
<li>This <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">link</a> on the concept of tidy data</li>
<li>The <a href="https://tibble.tidyverse.org/">tibble</a>, <a href="https://tidyr.tidyverse.org/">tidyr</a> and <a href="https://forcats.tidyverse.org/">forcats</a> websites</li>
<li>The <a href="https://broom.tidymodels.org/">broom</a>, <a href="https://www.tidymodels.org/">tidymodels</a>, <a href="https://www.data-imaginist.com/2017/introducing-tidygraph/">tidygraph</a> and <a href="https://yulab-smu.github.io/treedata-book/">tidytree</a> websites</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading-files-and-string-manipulation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-manipulation-with-dplyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/tres-tidy-tutorial/edit/master/02_reshaping_data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["TRES-Tidy-Tutorial.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
