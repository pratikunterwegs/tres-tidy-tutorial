<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 7 Programming in the tidyverse | TRES Tidyverse Tutorial</title>
  <meta name="description" content="Section 7 Programming in the tidyverse | TRES Tidyverse Tutorial" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 7 Programming in the tidyverse | TRES Tidyverse Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Section 7 Programming in the tidyverse | TRES Tidyverse Tutorial" />
  <meta name="github-repo" content="pratikunterwegs/tres-tidy-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 7 Programming in the tidyverse | TRES Tidyverse Tutorial" />
  
  <meta name="twitter:description" content="Section 7 Programming in the tidyverse | TRES Tidyverse Tutorial" />
  

<meta name="author" content="Raphael, Pratik, Theo and RichÃ¨l" />


<meta name="date" content="2020-07-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="regular-expressions-and-testthat.html"/>
<link rel="next" href="developing-r-packages.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Outline</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#possible-extras"><i class="fa fa-check"></i>Possible extras</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#join"><i class="fa fa-check"></i>Join</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html"><i class="fa fa-check"></i><b>1</b> Reading files and string manipulation</a><ul>
<li class="chapter" data-level="1.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#data-import-and-export-with-readr"><i class="fa fa-check"></i><b>1.1</b> Data import and export with <code>readr</code></a><ul>
<li class="chapter" data-level="1.1.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#reading-data"><i class="fa fa-check"></i><b>1.1.1</b> Reading data</a></li>
<li class="chapter" data-level="1.1.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#writing-data"><i class="fa fa-check"></i><b>1.1.2</b> Writing data</a></li>
<li class="chapter" data-level="1.1.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#reading-and-writing-lines"><i class="fa fa-check"></i><b>1.1.3</b> Reading and writing lines</a></li>
<li class="chapter" data-level="" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#excel-files"><i class="fa fa-check"></i>Excel files</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#string-manipulation-with-stringr"><i class="fa fa-check"></i><b>1.2</b> String manipulation with <code>stringr</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#putting-strings-together"><i class="fa fa-check"></i><b>1.2.1</b> Putting strings together</a></li>
<li class="chapter" data-level="1.2.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#detecting-strings"><i class="fa fa-check"></i><b>1.2.2</b> Detecting strings</a></li>
<li class="chapter" data-level="1.2.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#matching-strings"><i class="fa fa-check"></i><b>1.2.3</b> Matching strings</a></li>
<li class="chapter" data-level="1.2.4" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#simpler-pattern-extraction"><i class="fa fa-check"></i><b>1.2.4</b> Simpler pattern extraction</a></li>
<li class="chapter" data-level="1.2.5" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#breaking-strings-apart"><i class="fa fa-check"></i><b>1.2.5</b> Breaking strings apart</a></li>
<li class="chapter" data-level="1.2.6" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#replacing-string-elements"><i class="fa fa-check"></i><b>1.2.6</b> Replacing string elements</a></li>
<li class="chapter" data-level="1.2.7" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#subsetting-within-strings"><i class="fa fa-check"></i><b>1.2.7</b> Subsetting within strings</a></li>
<li class="chapter" data-level="1.2.8" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#padding-and-truncating-strings"><i class="fa fa-check"></i><b>1.2.8</b> Padding and truncating strings</a></li>
<li class="chapter" data-level="1.2.9" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#stringr-aspects-not-covered-here"><i class="fa fa-check"></i><b>1.2.9</b> Stringr aspects not covered here</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#string-interpolation-with-glue"><i class="fa fa-check"></i><b>1.3</b> String interpolation with <code>glue</code></a></li>
<li class="chapter" data-level="1.4" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#strings-in-ggplot"><i class="fa fa-check"></i><b>1.4</b> Strings in <code>ggplot</code></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><i class="fa fa-check"></i><b>2</b> Reshaping data tables in the tidyverse, and other things</a><ul>
<li class="chapter" data-level="2.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#the-new-data-frame-tibble"><i class="fa fa-check"></i><b>2.1</b> The new data frame: tibble</a></li>
<li class="chapter" data-level="2.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#the-concept-of-tidy-data"><i class="fa fa-check"></i><b>2.2</b> The concept of tidy data</a></li>
<li class="chapter" data-level="2.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#reshaping-with-tidyr"><i class="fa fa-check"></i><b>2.3</b> Reshaping with <code>tidyr</code></a><ul>
<li class="chapter" data-level="2.3.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#pivoting"><i class="fa fa-check"></i><b>2.3.1</b> Pivoting</a></li>
<li class="chapter" data-level="2.3.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#handling-missing-values"><i class="fa fa-check"></i><b>2.3.2</b> Handling missing values</a></li>
<li class="chapter" data-level="2.3.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#splitting-and-combining-cells"><i class="fa fa-check"></i><b>2.3.3</b> Splitting and combining cells</a></li>
<li class="chapter" data-level="2.3.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#expanding-tables-using-combinations"><i class="fa fa-check"></i><b>2.3.4</b> Expanding tables using combinations</a></li>
<li class="chapter" data-level="2.3.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#nesting"><i class="fa fa-check"></i><b>2.3.5</b> Nesting</a></li>
<li class="chapter" data-level="2.3.6" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#what-else-can-be-tidied-up"><i class="fa fa-check"></i><b>2.3.6</b> What else can be tidied up?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#extra-factors-and-the-forcats-package"><i class="fa fa-check"></i><b>2.4</b> Extra: factors and the <code>forcats</code> package</a><ul>
<li class="chapter" data-level="2.4.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#change-the-order-of-the-levels"><i class="fa fa-check"></i><b>2.4.1</b> Change the order of the levels</a></li>
<li class="chapter" data-level="2.4.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#change-the-levels-themselves"><i class="fa fa-check"></i><b>2.4.2</b> Change the levels themselves</a></li>
<li class="chapter" data-level="2.4.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#dropping-levels"><i class="fa fa-check"></i><b>2.4.3</b> Dropping levels</a></li>
<li class="chapter" data-level="2.4.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#other-things"><i class="fa fa-check"></i><b>2.4.4</b> Other things</a></li>
<li class="chapter" data-level="2.4.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#take-home-message-for-forcats"><i class="fa fa-check"></i><b>2.4.5</b> Take home message for forcats</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#external-resources"><i class="fa fa-check"></i><b>2.5</b> External resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html"><i class="fa fa-check"></i><b>3</b> Data manipulation with <code>dplyr</code></a><ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#foreword-on-dplyr"><i class="fa fa-check"></i><b>3.1.1</b> Foreword on <code>dplyr</code></a></li>
<li class="chapter" data-level="3.1.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#example-data"><i class="fa fa-check"></i><b>3.1.2</b> Example data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-existing-variables"><i class="fa fa-check"></i><b>3.2</b> Working with existing variables</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#renaming-variables-with-rename"><i class="fa fa-check"></i><b>3.2.1</b> Renaming variables with <code>rename()</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.2.2</b> The pipe operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#select-variables-with-select"><i class="fa fa-check"></i><b>3.2.3</b> Select variables with <code>select()</code></a></li>
<li class="chapter" data-level="3.2.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#select-variables-with-helpers"><i class="fa fa-check"></i><b>3.2.4</b> Select variables with helpers</a></li>
<li class="chapter" data-level="3.2.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#rearranging-variable-order-with-relocate"><i class="fa fa-check"></i><b>3.2.5</b> Rearranging variable order with <code>relocate()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-observations"><i class="fa fa-check"></i><b>3.3</b> Working with observations</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#ordering-rows-by-value---arrange"><i class="fa fa-check"></i><b>3.3.1</b> Ordering rows by value - <code>arrange()</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#subset-rows-by-position---slice"><i class="fa fa-check"></i><b>3.3.2</b> Subset rows by position - <code>slice()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#subsetting-rows-by-value-with-filter"><i class="fa fa-check"></i><b>3.3.3</b> Subsetting rows by value with <code>filter()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#making-new-variables"><i class="fa fa-check"></i><b>3.4</b> Making new variables</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#create-new-variables-with-mutate"><i class="fa fa-check"></i><b>3.4.1</b> Create new variables with <code>mutate()</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#summarise-observations-with-summarise"><i class="fa fa-check"></i><b>3.4.2</b> Summarise observations with <code>summarise()</code></a></li>
<li class="chapter" data-level="3.4.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#grouping-observations-by-variables"><i class="fa fa-check"></i><b>3.4.3</b> Grouping observations by variables</a></li>
<li class="chapter" data-level="3.4.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#grouped-data-and-other-dplyr-verbs"><i class="fa fa-check"></i><b>3.4.4</b> Grouped data and other <code>dplyr</code> verbs</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-multiple-tables"><i class="fa fa-check"></i><b>3.5</b> Working with multiple tables</a><ul>
<li class="chapter" data-level="3.5.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#binding-tables"><i class="fa fa-check"></i><b>3.5.1</b> Binding tables</a></li>
<li class="chapter" data-level="3.5.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#combining-variables-of-two-tables-with-mutating-joins"><i class="fa fa-check"></i><b>3.5.2</b> Combining variables of two tables with mutating joins</a></li>
<li class="chapter" data-level="3.5.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#filtering-matching-observations-between-two-tables-wiht-filtering-joins"><i class="fa fa-check"></i><b>3.5.3</b> Filtering matching observations between two tables wiht filtering joins</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html"><i class="fa fa-check"></i><b>4</b> Working with lists and iteration</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#list-columns-with-tidyr"><i class="fa fa-check"></i><b>4.1</b> List columns with <code>tidyr</code></a><ul>
<li class="chapter" data-level="4.1.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#nesting-data"><i class="fa fa-check"></i><b>4.1.1</b> Nesting data</a></li>
<li class="chapter" data-level="4.1.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#unnesting-data"><i class="fa fa-check"></i><b>4.1.2</b> Unnesting data</a></li>
<li class="chapter" data-level="4.1.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#working-with-list-columns"><i class="fa fa-check"></i><b>4.1.3</b> Working with list columns</a></li>
<li class="chapter" data-level="" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#functionals"><i class="fa fa-check"></i>Functionals</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#iteration-with-map"><i class="fa fa-check"></i><b>4.2</b> Iteration with <code>map</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#basic-use-of-map"><i class="fa fa-check"></i><b>4.2.1</b> Basic use of <code>map</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#map-variants-returning-vectors"><i class="fa fa-check"></i><b>4.2.2</b> <code>map</code> variants returning vectors</a></li>
<li class="chapter" data-level="4.2.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#map-variants-returning-data-frames"><i class="fa fa-check"></i><b>4.2.3</b> <code>map</code> variants returning data frames</a></li>
<li class="chapter" data-level="4.2.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#working-with-list-columns-using-map"><i class="fa fa-check"></i><b>4.2.4</b> Working with list columns using <code>map</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#selective-mapping-using-map-variants"><i class="fa fa-check"></i><b>4.2.5</b> Selective mapping using <code>map</code> variants</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#more-map-variants"><i class="fa fa-check"></i><b>4.3</b> More <code>map</code> variants</a><ul>
<li class="chapter" data-level="4.3.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#mapping-over-two-inputs-with-map2"><i class="fa fa-check"></i><b>4.3.1</b> Mapping over two inputs with map2</a></li>
<li class="chapter" data-level="4.3.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#mapping-over-multiple-inputs-with-pmap"><i class="fa fa-check"></i><b>4.3.2</b> Mapping over multiple inputs with pmap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#combining-map-variants-and-tidyverse-functions"><i class="fa fa-check"></i><b>4.4</b> Combining map variants and tidyverse functions</a></li>
<li class="chapter" data-level="4.5" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#a-return-to-map-variants"><i class="fa fa-check"></i><b>4.5</b> A return to map variants</a><ul>
<li class="chapter" data-level="4.5.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#iteration-without-a-return"><i class="fa fa-check"></i><b>4.5.1</b> Iteration without a return</a></li>
<li class="chapter" data-level="4.5.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#modify-rather-than-map"><i class="fa fa-check"></i><b>4.5.2</b> Modify rather than map</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#other-functions-for-working-with-lists"><i class="fa fa-check"></i><b>4.6</b> Other functions for working with lists</a><ul>
<li class="chapter" data-level="4.6.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#filtering-lists"><i class="fa fa-check"></i><b>4.6.1</b> Filtering lists</a></li>
<li class="chapter" data-level="4.6.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#summarising-lists"><i class="fa fa-check"></i><b>4.6.2</b> Summarising lists</a></li>
<li class="chapter" data-level="4.6.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#reduction-and-accumulation"><i class="fa fa-check"></i><b>4.6.3</b> Reduction and accumulation</a></li>
<li class="chapter" data-level="4.6.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#miscellaneous-operation"><i class="fa fa-check"></i><b>4.6.4</b> Miscellaneous operation</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#lists-of-ggplots-with-patchwork"><i class="fa fa-check"></i><b>4.7</b> Lists of <code>ggplots</code> with <code>patchwork</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html"><i class="fa fa-check"></i><b>5</b> <code>ggplot2</code> and the grammar of graphics</a><ul>
<li class="chapter" data-level="5.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="5.1.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#what-is-ggplot2-and-why-use-it"><i class="fa fa-check"></i><b>5.1.1</b> What is <code>ggplot2</code> and why use it?</a></li>
<li class="chapter" data-level="5.1.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#what-is-the-grammar-of-graphics"><i class="fa fa-check"></i><b>5.1.2</b> What is the grammar of graphics?</a></li>
<li class="chapter" data-level="5.1.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#quick-plot"><i class="fa fa-check"></i><b>5.1.3</b> Quick plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#but-first-the-data"><i class="fa fa-check"></i><b>5.2</b> But first, the data</a></li>
<li class="chapter" data-level="5.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#geom-layers"><i class="fa fa-check"></i><b>5.3</b> Geom layers</a><ul>
<li class="chapter" data-level="5.3.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#mapping-variables-to-aesthetics"><i class="fa fa-check"></i><b>5.3.1</b> Mapping variables to aesthetics</a></li>
<li class="chapter" data-level="5.3.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#fixed-aesthetics"><i class="fa fa-check"></i><b>5.3.2</b> Fixed aesthetics</a></li>
<li class="chapter" data-level="5.3.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#statistical-transformation"><i class="fa fa-check"></i><b>5.3.3</b> Statistical transformation</a></li>
<li class="chapter" data-level="5.3.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#position"><i class="fa fa-check"></i><b>5.3.4</b> Position</a></li>
<li class="chapter" data-level="5.3.5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#other-geoms"><i class="fa fa-check"></i><b>5.3.5</b> Other geoms</a></li>
<li class="chapter" data-level="5.3.6" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#extra-on-aesthetics"><i class="fa fa-check"></i><b>5.3.6</b> Extra on aesthetics</a></li>
<li class="chapter" data-level="5.3.7" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#plot-wide-aesthetics-and-multiple-geoms"><i class="fa fa-check"></i><b>5.3.7</b> Plot-wide aesthetics and multiple geoms</a></li>
<li class="chapter" data-level="5.3.8" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#multiple-geoms-with-different-datasets"><i class="fa fa-check"></i><b>5.3.8</b> Multiple geoms with different datasets</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#coordinate-system"><i class="fa fa-check"></i><b>5.4</b> Coordinate-system</a></li>
<li class="chapter" data-level="5.5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#facetting"><i class="fa fa-check"></i><b>5.5</b> Facetting</a></li>
<li class="chapter" data-level="5.6" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#the-right-format-for-the-dataset"><i class="fa fa-check"></i><b>5.6</b> The right format for the dataset</a></li>
<li class="chapter" data-level="5.7" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#plotting-as-part-of-a-pipeline"><i class="fa fa-check"></i><b>5.7</b> Plotting as part of a pipeline</a></li>
<li class="chapter" data-level="5.8" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#customization"><i class="fa fa-check"></i><b>5.8</b> Customization</a><ul>
<li class="chapter" data-level="5.8.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#scales"><i class="fa fa-check"></i><b>5.8.1</b> Scales</a></li>
<li class="chapter" data-level="5.8.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#labels"><i class="fa fa-check"></i><b>5.8.2</b> Labels</a></li>
<li class="chapter" data-level="5.8.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#themes"><i class="fa fa-check"></i><b>5.8.3</b> Themes</a></li>
<li class="chapter" data-level="5.8.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#legend"><i class="fa fa-check"></i><b>5.8.4</b> Legend</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#combining-plots"><i class="fa fa-check"></i><b>5.9</b> Combining plots</a></li>
<li class="chapter" data-level="5.10" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#saving-a-plot"><i class="fa fa-check"></i><b>5.10</b> Saving a plot</a></li>
<li class="chapter" data-level="5.11" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#high-throughput-plotting-workflow"><i class="fa fa-check"></i><b>5.11</b> High throughput plotting workflow</a></li>
<li class="chapter" data-level="5.12" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#want-more"><i class="fa fa-check"></i><b>5.12</b> Want more?</a></li>
<li class="chapter" data-level="5.13" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#references"><i class="fa fa-check"></i><b>5.13</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html"><i class="fa fa-check"></i><b>6</b> Regular expressions and <code>testthat</code></a><ul>
<li class="chapter" data-level="6.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="6.1.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#goal"><i class="fa fa-check"></i><b>6.1.1</b> Goal</a></li>
<li class="chapter" data-level="6.1.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#why-is-this-important"><i class="fa fa-check"></i><b>6.1.2</b> Why is this important?</a></li>
<li class="chapter" data-level="6.1.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#what-are-regular-expressions"><i class="fa fa-check"></i><b>6.1.3</b> What are regular expressions?</a></li>
<li class="chapter" data-level="6.1.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#applications"><i class="fa fa-check"></i><b>6.1.4</b> Applications</a></li>
<li class="chapter" data-level="6.1.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#using-regexes-in-r"><i class="fa fa-check"></i><b>6.1.5</b> Using regexes in R</a></li>
<li class="chapter" data-level="6.1.6" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#dangers-of-regexes"><i class="fa fa-check"></i><b>6.1.6</b> Dangers of regexes</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#testing"><i class="fa fa-check"></i><b>6.2</b> Testing</a><ul>
<li class="chapter" data-level="6.2.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#why-test"><i class="fa fa-check"></i><b>6.2.1</b> Why test?</a></li>
<li class="chapter" data-level="6.2.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#our-first-test"><i class="fa fa-check"></i><b>6.2.2</b> Our first test</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#detect-a-full-match"><i class="fa fa-check"></i><b>6.3</b> Detect a full match</a><ul>
<li class="chapter" data-level="6.3.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#str_which-demo"><i class="fa fa-check"></i><b>6.3.1</b> <code>str_which</code> demo</a></li>
<li class="chapter" data-level="6.3.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#example-exercise-has_a_one"><i class="fa fa-check"></i><b>6.3.2</b> Example exercise: <code>has_a_one</code></a></li>
<li class="chapter" data-level="6.3.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-has_a_digit"><i class="fa fa-check"></i><b>6.3.3</b> Exercise: <code>has_a_digit</code></a></li>
<li class="chapter" data-level="6.3.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-has_a_word"><i class="fa fa-check"></i><b>6.3.4</b> Exercise: <code>has_a_word</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-has_dna_seq-alternates"><i class="fa fa-check"></i><b>6.3.5</b> Exercise: <code>has_dna_seq</code> (alternates)</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#extract-a-pattern-for-one-submatch"><i class="fa fa-check"></i><b>6.4</b> Extract a pattern for one submatch</a><ul>
<li class="chapter" data-level="6.4.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#str_match"><i class="fa fa-check"></i><b>6.4.1</b> <code>str_match</code></a></li>
<li class="chapter" data-level="6.4.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#context"><i class="fa fa-check"></i><b>6.4.2</b> Context</a></li>
<li class="chapter" data-level="6.4.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#extract-a-character-vector-from-a-submatch"><i class="fa fa-check"></i><b>6.4.3</b> Extract a character vector from a submatch</a></li>
<li class="chapter" data-level="6.4.4" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#example-exercise-extract_dna_seq_numbers-1-submatch"><i class="fa fa-check"></i><b>6.4.4</b> Example exercise: <code>extract_dna_seq_numbers</code> (1 submatch)</a></li>
<li class="chapter" data-level="6.4.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#answer-extract_dna_seq_numbers"><i class="fa fa-check"></i><b>6.4.5</b> Answer: <code>extract_dna_seq_numbers</code></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#extract-a-pattern-for-multiple-submatches"><i class="fa fa-check"></i><b>6.5</b> Extract a pattern for multiple submatches</a><ul>
<li class="chapter" data-level="6.5.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#context-1"><i class="fa fa-check"></i><b>6.5.1</b> Context</a></li>
<li class="chapter" data-level="6.5.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#exercise-extract_prot_and_seq_ids"><i class="fa fa-check"></i><b>6.5.2</b> Exercise: <code>extract_prot_and_seq_ids</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#answer-extract_prot_and_seq_ids"><i class="fa fa-check"></i><b>6.5.3</b> Answer: <code>extract_prot_and_seq_ids</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#mutate"><i class="fa fa-check"></i><b>6.6</b> Mutate</a></li>
<li class="chapter" data-level="6.7" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#test-for-match"><i class="fa fa-check"></i><b>6.7</b> Test for match</a></li>
<li class="chapter" data-level="6.8" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#bigger-picture"><i class="fa fa-check"></i><b>6.8</b> Bigger picture</a><ul>
<li class="chapter" data-level="6.8.1" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#develop-in-packages"><i class="fa fa-check"></i><b>6.8.1</b> Develop in packages</a></li>
<li class="chapter" data-level="6.8.2" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#regex-usage-outside-r"><i class="fa fa-check"></i><b>6.8.2</b> Regex usage outside R</a></li>
<li class="chapter" data-level="6.8.3" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#warning"><i class="fa fa-check"></i><b>6.8.3</b> Warning</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="regular-expressions-and-testthat.html"><a href="regular-expressions-and-testthat.html#resources"><i class="fa fa-check"></i><b>6.9</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html"><i class="fa fa-check"></i><b>7</b> Programming in the <em>tidyverse</em></a><ul>
<li class="chapter" data-level="7.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#an-exlanation-of-the-problem"><i class="fa fa-check"></i><b>7.1</b> An exlanation of the problem</a><ul>
<li class="chapter" data-level="7.1.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#what-the-issue-is"><i class="fa fa-check"></i><b>7.1.1</b> What the issue is</a></li>
<li class="chapter" data-level="7.1.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#why-the-issue-is-a-problem"><i class="fa fa-check"></i><b>7.1.2</b> Why the issue is a problem</a></li>
<li class="chapter" data-level="7.1.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#passing-variables-as-strings-is-also-an-issue"><i class="fa fa-check"></i><b>7.1.3</b> Passing variables as strings is (also) an issue</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-selection-is-easy"><i class="fa fa-check"></i><b>7.2</b> Flexible selection is easy</a></li>
<li class="chapter" data-level="7.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#a-first-attempt-at-a-flexible-function"><i class="fa fa-check"></i><b>7.3</b> A first attempt at a flexible function</a><ul>
<li class="chapter" data-level="7.3.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#failure-of-the-first-attempt"><i class="fa fa-check"></i><b>7.3.1</b> Failure of the first attempt</a></li>
<li class="chapter" data-level="7.3.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#passing-arguments-as-strings-doesnt-help"><i class="fa fa-check"></i><b>7.3.2</b> Passing arguments as strings doesnât help</a></li>
<li class="chapter" data-level="7.3.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#none-of-the-other-arguments-will-be-successful"><i class="fa fa-check"></i><b>7.3.3</b> None of the other arguments will be successful</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-filtering-in-a-function"><i class="fa fa-check"></i><b>7.4</b> Flexible filtering in a function</a><ul>
<li class="chapter" data-level="7.4.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-filtering-using-expressions"><i class="fa fa-check"></i><b>7.4.1</b> Flexible filtering using expressions</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-grouping-in-a-function"><i class="fa fa-check"></i><b>7.5</b> Flexible grouping in a function</a><ul>
<li class="chapter" data-level="7.5.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-...-and-forwarding"><i class="fa fa-check"></i><b>7.5.1</b> Using <code>...</code> and âforwardingâ</a></li>
<li class="chapter" data-level="7.5.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#passing-grouping-variables-as-strings"><i class="fa fa-check"></i><b>7.5.2</b> Passing grouping variables as strings</a></li>
<li class="chapter" data-level="7.5.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-rlangsyms"><i class="fa fa-check"></i><b>7.5.3</b> Using <code>rlang::syms</code></a></li>
<li class="chapter" data-level="7.5.4" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-rlangparse_exprs"><i class="fa fa-check"></i><b>7.5.4</b> Using <code>rlang::parse_exprs</code></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#flexible-summarising-in-a-function"><i class="fa fa-check"></i><b>7.6</b> Flexible summarising in a function</a><ul>
<li class="chapter" data-level="7.6.1" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-dplyrsummarise_at"><i class="fa fa-check"></i><b>7.6.1</b> Using <code>dplyr::summarise_at</code></a></li>
<li class="chapter" data-level="7.6.2" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#using-the-across-argument-for-summary-variables"><i class="fa fa-check"></i><b>7.6.2</b> Using the <code>across</code> argument for summary variables</a></li>
<li class="chapter" data-level="7.6.3" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#summarise-multiple-variables-using-..."><i class="fa fa-check"></i><b>7.6.3</b> Summarise multiple variables using <code>...</code></a></li>
<li class="chapter" data-level="7.6.4" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#summarise-with-multiple-functions"><i class="fa fa-check"></i><b>7.6.4</b> Summarise with multiple functions</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="programming-in-the-tidyverse.html"><a href="programming-in-the-tidyverse.html#further-resources"><i class="fa fa-check"></i><b>7.7</b> Further resources</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="developing-r-packages.html"><a href="developing-r-packages.html"><i class="fa fa-check"></i><b>8</b> Developing R packages</a><ul>
<li class="chapter" data-level="8.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html#why-writing-packages"><i class="fa fa-check"></i><b>8.1</b> Why writing packages?</a></li>
<li class="chapter" data-level="8.2" data-path="developing-r-packages.html"><a href="developing-r-packages.html#hands-on-workflow"><i class="fa fa-check"></i><b>8.2</b> Hands-on workflow</a><ul>
<li class="chapter" data-level="8.2.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html#primer-what-is-an-rstudio-project"><i class="fa fa-check"></i><b>8.2.1</b> Primer: what is an RStudio project?</a></li>
<li class="chapter" data-level="8.2.2" data-path="developing-r-packages.html"><a href="developing-r-packages.html#create-a-project-for-your-package"><i class="fa fa-check"></i><b>8.2.2</b> Create a project for your package</a></li>
<li class="chapter" data-level="8.2.3" data-path="developing-r-packages.html"><a href="developing-r-packages.html#link-to-github"><i class="fa fa-check"></i><b>8.2.3</b> Link to GitHub?</a></li>
<li class="chapter" data-level="8.2.4" data-path="developing-r-packages.html"><a href="developing-r-packages.html#write-your-functions"><i class="fa fa-check"></i><b>8.2.4</b> Write your functions</a></li>
<li class="chapter" data-level="8.2.5" data-path="developing-r-packages.html"><a href="developing-r-packages.html#tests"><i class="fa fa-check"></i><b>8.2.5</b> Tests</a></li>
<li class="chapter" data-level="8.2.6" data-path="developing-r-packages.html"><a href="developing-r-packages.html#document-your-functions"><i class="fa fa-check"></i><b>8.2.6</b> Document your functions</a></li>
<li class="chapter" data-level="8.2.7" data-path="developing-r-packages.html"><a href="developing-r-packages.html#build-the-package"><i class="fa fa-check"></i><b>8.2.7</b> Build the package</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="developing-r-packages.html"><a href="developing-r-packages.html#write-a-vignette"><i class="fa fa-check"></i><b>8.3</b> Write a vignette</a></li>
<li class="chapter" data-level="8.4" data-path="developing-r-packages.html"><a href="developing-r-packages.html#update-the-description"><i class="fa fa-check"></i><b>8.4</b> Update the description</a></li>
<li class="chapter" data-level="8.5" data-path="developing-r-packages.html"><a href="developing-r-packages.html#check-the-package"><i class="fa fa-check"></i><b>8.5</b> Check the package</a><ul>
<li class="chapter" data-level="8.5.1" data-path="developing-r-packages.html"><a href="developing-r-packages.html#good-practices"><i class="fa fa-check"></i><b>8.5.1</b> Good practices</a></li>
<li class="chapter" data-level="8.5.2" data-path="developing-r-packages.html"><a href="developing-r-packages.html#better-practices"><i class="fa fa-check"></i><b>8.5.2</b> Better practices</a></li>
<li class="chapter" data-level="8.5.3" data-path="developing-r-packages.html"><a href="developing-r-packages.html#even-better-practices"><i class="fa fa-check"></i><b>8.5.3</b> Even better practices</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="developing-r-packages.html"><a href="developing-r-packages.html#references-1"><i class="fa fa-check"></i><b>8.6</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">TRES Tidyverse Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="programming-in-the-tidyverse" class="section level1">
<h1><span class="header-section-number">Section 7</span> Programming in the <em>tidyverse</em></h1>
<p><img src="opening-image.png" /></p>
<p>Load the packages for the day.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb253-2" title="2"><span class="kw">library</span>(rlang)</a></code></pre></div>
<p>A function to look at errors.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" title="1">try_this &lt;-<span class="st"> </span><span class="cf">function</span>(ex) {</a>
<a class="sourceLine" id="cb254-2" title="2">  <span class="kw">tryCatch</span>(</a>
<a class="sourceLine" id="cb254-3" title="3">    <span class="dt">expr =</span> {</a>
<a class="sourceLine" id="cb254-4" title="4">      ex</a>
<a class="sourceLine" id="cb254-5" title="5">    },</a>
<a class="sourceLine" id="cb254-6" title="6">    <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb254-7" title="7">      <span class="kw">print</span>(glue<span class="op">::</span><span class="kw">glue</span>(<span class="kw">as.character</span>(e), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb254-8" title="8">    }</a>
<a class="sourceLine" id="cb254-9" title="9">  )</a>
<a class="sourceLine" id="cb254-10" title="10">}</a></code></pre></div>
<div id="an-exlanation-of-the-problem" class="section level2">
<h2><span class="header-section-number">7.1</span> An exlanation of the problem</h2>
<div id="what-the-issue-is" class="section level3">
<h3><span class="header-section-number">7.1.1</span> What the issue is</h3>
<p>Get some data from <em>Phylacine</em>, and attempt to select or filter.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1"><span class="co"># read in phylacine data</span></a>
<a class="sourceLine" id="cb255-2" title="2">data =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/phylacine_traits.csv&quot;</span>)</a>
<a class="sourceLine" id="cb255-3" title="3"></a>
<a class="sourceLine" id="cb255-4" title="4"><span class="co"># regular filtering</span></a>
<a class="sourceLine" id="cb255-5" title="5">small_mammals =<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb255-6" title="6"><span class="st">  </span><span class="kw">filter</span>(Mass.g <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>)</a></code></pre></div>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" title="1"><span class="co"># filtering on a string</span></a>
<a class="sourceLine" id="cb256-2" title="2">small_mammals_too =<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb256-3" title="3"><span class="st">  </span><span class="kw">filter</span>(<span class="st">&quot;Mass.g&quot;</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>)</a></code></pre></div>
<p>Examine <code>small_mammals</code> and <code>small_mammals_too</code> to check whether they are as expected.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1"><span class="co"># count rows</span></a>
<a class="sourceLine" id="cb257-2" title="2"><span class="kw">map_int</span>(<span class="kw">list</span>(<span class="dt">sm_1 =</span> small_mammals, <span class="dt">sm2 =</span> small_mammals_too),</a>
<a class="sourceLine" id="cb257-3" title="3">        nrow)</a>
<a class="sourceLine" id="cb257-4" title="4"><span class="co">#&gt; sm_1  sm2 </span></a>
<a class="sourceLine" id="cb257-5" title="5"><span class="co">#&gt; 4381    0</span></a></code></pre></div>
<p>The difference in the number of rows is because <code>dplyr::filter</code> could not understand the string <code>"Mass.g"</code> as a variable in the dataframe.</p>
<p>This is because the <code>tidyverse</code>, through its <code>tidyselect</code> package, makes a distinction between <code>"Mass.g"</code>, and <code>Mass.g</code>.</p>
<p>A better explanation of (some of) the theory behind this can be found here: <a href="https://dplyr.tidyverse.org/articles/programming.html#setting-variable-names">Programming with dplyr</a>.</p>
<p>The same issue arises with functions such as <code>dplyr::summarise</code> and <code>dplyr::group_by</code>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" title="1"><span class="co"># summarise using an unquoted variable</span></a>
<a class="sourceLine" id="cb258-2" title="2"><span class="kw">summarise</span>(data,</a>
<a class="sourceLine" id="cb258-3" title="3">          <span class="dt">mean_mass =</span> <span class="kw">mean</span>(Mass.g))</a>
<a class="sourceLine" id="cb258-4" title="4"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb258-5" title="5"><span class="co">#&gt;   mean_mass</span></a>
<a class="sourceLine" id="cb258-6" title="6"><span class="co">#&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb258-7" title="7"><span class="co">#&gt; 1   156882.</span></a>
<a class="sourceLine" id="cb258-8" title="8"></a>
<a class="sourceLine" id="cb258-9" title="9"><span class="co"># this will print a warning</span></a>
<a class="sourceLine" id="cb258-10" title="10"><span class="kw">summarise</span>(data,</a>
<a class="sourceLine" id="cb258-11" title="11">          <span class="dt">mean_mass =</span> <span class="kw">mean</span>(<span class="st">&quot;Mass.g&quot;</span>))</a>
<a class="sourceLine" id="cb258-12" title="12"><span class="co">#&gt; Warning in mean.default(&quot;Mass.g&quot;): argument is not numeric or logical: returning</span></a>
<a class="sourceLine" id="cb258-13" title="13"><span class="co">#&gt; NA</span></a>
<a class="sourceLine" id="cb258-14" title="14"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb258-15" title="15"><span class="co">#&gt;   mean_mass</span></a>
<a class="sourceLine" id="cb258-16" title="16"><span class="co">#&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb258-17" title="17"><span class="co">#&gt; 1        NA</span></a></code></pre></div>
</div>
<div id="why-the-issue-is-a-problem" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Why the issue is a problem</h3>
<p>Consider an analysis pipeline as follows.</p>
<p><code>data %&gt;% select variables %&gt;% summarise by groups</code></p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1">data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-2" title="2"><span class="st">  </span><span class="kw">select</span>(Mass.g, Diet.Plant, Order.<span class="fl">1.2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(Order.<span class="fl">1.2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-4" title="4"><span class="st">  </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> mean) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-5" title="5"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb259-6" title="6"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb259-7" title="7"><span class="co">#&gt;   Order.1.2          Mass.g Diet.Plant</span></a>
<a class="sourceLine" id="cb259-8" title="8"><span class="co">#&gt;   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb259-9" title="9"><span class="co">#&gt; 1 Afrosoricida        306.       0.947</span></a>
<a class="sourceLine" id="cb259-10" title="10"><span class="co">#&gt; 2 Carnivora         47905.      14.1  </span></a>
<a class="sourceLine" id="cb259-11" title="11"><span class="co">#&gt; 3 Cetartiodactyla 1854811.      76.2  </span></a>
<a class="sourceLine" id="cb259-12" title="12"><span class="co">#&gt; 4 Chiroptera           49.1     27.3  </span></a>
<a class="sourceLine" id="cb259-13" title="13"><span class="co">#&gt; 5 Cingulata        235529.      43.0  </span></a>
<a class="sourceLine" id="cb259-14" title="14"><span class="co">#&gt; 6 Dasyuromorphia      748.       1.09</span></a></code></pre></div>
<p>Now consider that this analysis pipeline is repeated many times in your document. Consider also that a well intentioned person has renamed the dataframe columns.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" title="1">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-2" title="2"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">str_replace_all</span>(<span class="kw">colnames</span>(data), <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-3" title="3"><span class="st">                 </span>str_to_lower <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-4" title="4"><span class="st">                 </span><span class="kw">str_remove</span>(<span class="st">&quot;_1_2&quot;</span>))</a></code></pre></div>
<p>The group-summarise code above will no longer work.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" title="1"><span class="kw">try_this</span>(<span class="dt">ex =</span></a>
<a class="sourceLine" id="cb261-2" title="2"></a>
<a class="sourceLine" id="cb261-3" title="3">    data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb261-4" title="4"><span class="st">      </span><span class="kw">select</span>(Mass.g, Diet.Plant, Order.<span class="fl">1.2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb261-5" title="5"><span class="st">      </span><span class="kw">group_by</span>(Order.<span class="fl">1.2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb261-6" title="6"><span class="st">      </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> mean) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb261-7" title="7"><span class="st">      </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb261-8" title="8">)</a>
<a class="sourceLine" id="cb261-9" title="9"><span class="co">#&gt; Error: Can&#39;t subset columns that don&#39;t exist.</span></a>
<a class="sourceLine" id="cb261-10" title="10"><span class="co">#&gt; â Column `Mass.g` doesn&#39;t exist.</span></a></code></pre></div>
<p>This illustrates the problem in part: when the columns to be operated upon are <em>unknown to the programmer</em>, much of basic <code>tidyverse</code> code cannot be generalised to be used with any dataframe.</p>
</div>
<div id="passing-variables-as-strings-is-also-an-issue" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Passing variables as strings is (also) an issue</h3>
<p>The variables to be operated on could be given as strings, perhaps as the argument to a function, or as a global variable. This way, a single global vector could contain the grouping variables for all further <code>summarise</code> procedures.</p>
<p>This runs into the problem identified earlier.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" title="1"><span class="co"># choose some variables</span></a>
<a class="sourceLine" id="cb262-2" title="2">vars_to_select =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mass.g&quot;</span>, <span class="st">&quot;Diet.Plant&quot;</span>)</a>
<a class="sourceLine" id="cb262-3" title="3">vars_to_group =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Order.1.2&quot;</span>)</a>
<a class="sourceLine" id="cb262-4" title="4"></a>
<a class="sourceLine" id="cb262-5" title="5"><span class="co"># attempt to select and summarise on group</span></a>
<a class="sourceLine" id="cb262-6" title="6"><span class="co"># the tidyverse will not be pleased</span></a>
<a class="sourceLine" id="cb262-7" title="7"><span class="kw">try_this</span>(<span class="dt">ex =</span></a>
<a class="sourceLine" id="cb262-8" title="8"></a>
<a class="sourceLine" id="cb262-9" title="9">    data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb262-10" title="10"><span class="st">      </span><span class="kw">select</span>(vars_to_select) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># this works with a warning</span></a>
<a class="sourceLine" id="cb262-11" title="11"><span class="st">      </span><span class="kw">group_by</span>(vars_to_group) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb262-12" title="12"><span class="st">      </span><span class="kw">summarise</span>(<span class="dt">mean_mass =</span> <span class="kw">mean</span>(Mass.g),</a>
<a class="sourceLine" id="cb262-13" title="13">                <span class="dt">mean_plant =</span> <span class="kw">mean</span>(Diet.Plant))</a>
<a class="sourceLine" id="cb262-14" title="14">)</a>
<a class="sourceLine" id="cb262-15" title="15"><span class="co">#&gt; Error: Can&#39;t subset columns that don&#39;t exist.</span></a>
<a class="sourceLine" id="cb262-16" title="16"><span class="co">#&gt; â Columns `Mass.g` and `Diet.Plant` don&#39;t exist.</span></a></code></pre></div>
<p>In the case of a standard <code>filter %&gt;% group %&gt;% summarise</code> pipeline, the functionâs operations are evident. It must filter a dataframe based on a/some column(s), and then summarise by groups. The filter to be applied, the variables to group by, and the variables to be summarised should be passed as function arguments â just how this is to be done is not immediately obvious.</p>
</div>
</div>
<div id="flexible-selection-is-easy" class="section level2">
<h2><span class="header-section-number">7.2</span> Flexible selection is easy</h2>
<p>Selection often precedes data operations, but is not part of the pipeline dealt with further.</p>
<p>This is because <code>dplyr::select</code> appears to work on both quoted and unquoted variables, but in general some useful <code>select</code> helpers such as <code>dplyr::all_of</code> should be used. These straightforward helper functions significantly expand <code>select</code>âs flexibility and ease of use, and are not covered here. See the <code>select</code> help for more information.</p>
</div>
<div id="a-first-attempt-at-a-flexible-function" class="section level2">
<h2><span class="header-section-number">7.3</span> A first attempt at a flexible function</h2>
<p>The attempt below to write such a function, which gives the mean and confidence intervals of groups is likely to fail.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" title="1"><span class="co"># define a ci function</span></a>
<a class="sourceLine" id="cb263-2" title="2">ci &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">ci =</span> <span class="dv">95</span>) {</a>
<a class="sourceLine" id="cb263-3" title="3">  <span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>ci <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb263-4" title="4">}</a></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" title="1">custom_summary &lt;-<span class="st"> </span><span class="cf">function</span>(data, filters, grouping_vars, summary_vars) {</a>
<a class="sourceLine" id="cb264-2" title="2"></a>
<a class="sourceLine" id="cb264-3" title="3">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb264-4" title="4"><span class="st">    </span><span class="kw">filter</span>(filters) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb264-5" title="5"><span class="st">    </span><span class="kw">group_by</span>(grouping_vars) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb264-6" title="6"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(summary_vars),</a>
<a class="sourceLine" id="cb264-7" title="7">              <span class="dt">ci =</span> <span class="kw">ci</span>(summary_vars))</a>
<a class="sourceLine" id="cb264-8" title="8"></a>
<a class="sourceLine" id="cb264-9" title="9">}</a></code></pre></div>
<div id="failure-of-the-first-attempt" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Failure of the first attempt</h3>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" title="1"><span class="co"># this is going to fail, so look at the error message</span></a>
<a class="sourceLine" id="cb265-2" title="2"><span class="kw">try_this</span>(<span class="dt">ex =</span> <span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb265-3" title="3">                   <span class="dt">filters =</span> <span class="kw">list</span>(mass_g <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>),</a>
<a class="sourceLine" id="cb265-4" title="4">                   <span class="dt">grouping_vars =</span> <span class="kw">list</span>(order, family),</a>
<a class="sourceLine" id="cb265-5" title="5">                   <span class="dt">summary_vars =</span> <span class="kw">list</span>(diet_plant))</a>
<a class="sourceLine" id="cb265-6" title="6">         )</a>
<a class="sourceLine" id="cb265-7" title="7"><span class="co">#&gt; Error: Problem with `filter()` input `..1`.</span></a>
<a class="sourceLine" id="cb265-8" title="8"><span class="co">#&gt; â object &#39;mass_g&#39; not found</span></a>
<a class="sourceLine" id="cb265-9" title="9"><span class="co">#&gt; â¹ Input `..1` is `filters`.</span></a></code></pre></div>
<p>This function initially failed because <code>filter</code> could not find <code>mass_g</code> in the dataframe. This is because <code>mass_g</code> is treated as an independent <code>R</code> object, while the function should instead treat it as a variable in a dataframe.</p>
<p>The difference between so-called <code>data</code> and <code>environment</code> variables is explained better at the <code>rlang</code> and <code>tidyeval</code> websites and tutorials linked at the end of this chapter. It is this difference that prevents filter from correctly interpreting <code>mass_g</code>.</p>
</div>
<div id="passing-arguments-as-strings-doesnt-help" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Passing arguments as strings doesnât help</h3>
<p>The example below tries to get <code>filter</code> to work. What could be tried? One option is to attempt passing the filtering process as a string argument, i.e., <code>"mass_g &gt; 1000"</code>.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" title="1"><span class="co"># it doesn&#39;t matter whether filters is a vector or list</span></a>
<a class="sourceLine" id="cb266-2" title="2"><span class="kw">try_this</span>(<span class="dt">ex =</span> <span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb266-3" title="3">                   <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb266-4" title="4">                   <span class="dt">grouping_vars =</span> <span class="kw">list</span>(order, family),</a>
<a class="sourceLine" id="cb266-5" title="5">                   <span class="dt">summary_vars =</span> <span class="kw">list</span>(diet_plant))</a>
<a class="sourceLine" id="cb266-6" title="6">         )</a>
<a class="sourceLine" id="cb266-7" title="7"><span class="co">#&gt; Error: Problem with `filter()` input `..1`.</span></a>
<a class="sourceLine" id="cb266-8" title="8"><span class="co">#&gt; â Input `..1` must be a logical vector, not a character.</span></a>
<a class="sourceLine" id="cb266-9" title="9"><span class="co">#&gt; â¹ Input `..1` is `filters`.</span></a></code></pre></div>
<p>While this doesnât work, it is on the right track, which is that the <code>filters</code> argument needs some extra work beyond changing the type.</p>
</div>
<div id="none-of-the-other-arguments-will-be-successful" class="section level3">
<h3><span class="header-section-number">7.3.3</span> None of the other arguments will be successful</h3>
<p><code>filter</code> was the first failure, after which it stopped further evaluation, but none of the steps of the custom function would have worked, for the same reason filter would not have worked: all the arguments need some work before they can be passed to their respective functions.</p>
</div>
</div>
<div id="flexible-filtering-in-a-function" class="section level2">
<h2><span class="header-section-number">7.4</span> Flexible filtering in a function</h2>
<p>The first thing to try is to change how <code>filter</code> uses the argument passed to it.
Here, the argument <code>filters</code> is passed as a character vector, and is set by default to filter out mammals with masses below 1 kg.</p>
<p>The argument could be passed as a list, but the <code>rlang::parse_exprs</code> function works on vectors, not lists. The conversion between them is trivial for single level lists with atomic types (<code>purrr::as_vector</code>).</p>
<div id="a-brief-detour-expressions-in-r" class="section level4 unnumbered">
<h4>A brief detour: Expressions in R</h4>
<p>A full explanation of <code>R</code> works under the hood would take a very long time. A working knowledge of how this working can be exploited is usually sufficient to use most of <code>R</code>âs functionality.</p>
<p><code>R</code> expressions are one such. They represent a promise of <code>R</code> code, but without being evaluated. Any string can be parsed (interpreted) as an <code>R</code> expression.</p>
<p>What does <code>rlang::parse_exprs</code> do? It interprets a string as an <code>R</code> command.
This expression can then be evaluated later. Consider the following, where <code>a</code> is assigned the <code>numeric</code> value 3.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" title="1"><span class="co"># a is assigned</span></a>
<a class="sourceLine" id="cb267-2" title="2">a =<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb267-3" title="3"></a>
<a class="sourceLine" id="cb267-4" title="4"><span class="co"># parsed but not evaluated</span></a>
<a class="sourceLine" id="cb267-5" title="5">rlang<span class="op">::</span><span class="kw">parse_expr</span>(<span class="st">&quot;a + 3&quot;</span>)</a>
<a class="sourceLine" id="cb267-6" title="6"><span class="co">#&gt; a + 3</span></a>
<a class="sourceLine" id="cb267-7" title="7"></a>
<a class="sourceLine" id="cb267-8" title="8"><span class="co"># evaluated</span></a>
<a class="sourceLine" id="cb267-9" title="9">rlang<span class="op">::</span><span class="kw">parse_expr</span>(<span class="st">&quot;a + 3&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>eval</a>
<a class="sourceLine" id="cb267-10" title="10"><span class="co">#&gt; [1] 6</span></a></code></pre></div>
<p>Here, <code>a + 3</code> was converted to an expression in the second command, and only evaluated in the third.</p>
</div>
<div id="unquoting-with" class="section level4 unnumbered">
<h4>Unquoting with <code>!!!</code></h4>
<p><code>R</code> expressions underlie <code>R</code> code. Their evaluation can be forced inside another function using the special operators <code>!!</code> and <code>!!!</code>, for single and multiple <code>R</code> expressions respectively.</p>
</div>
<div id="flexible-filtering-using-expressions" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Flexible filtering using expressions</h3>
<p>Consider the case where mammals below 1 kg body mass are to be excluded. The <code>dplyr</code> code would look like this:</p>
<p><code>filter(data, mass_g &gt; 1000)</code></p>
<p>This fixes both the variable to be filtered by, as well as the cut-off value. This can be made flexible for a custom function that allows any kind of filtering.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb268-2" title="2">                          <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>)) {</a>
<a class="sourceLine" id="cb268-3" title="3"></a>
<a class="sourceLine" id="cb268-4" title="4">  <span class="co"># THIS IS THE IMPORTANT BIT</span></a>
<a class="sourceLine" id="cb268-5" title="5">  filters =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(filters)</a>
<a class="sourceLine" id="cb268-6" title="6"></a>
<a class="sourceLine" id="cb268-7" title="7">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb268-8" title="8"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span>filters)</a>
<a class="sourceLine" id="cb268-9" title="9">}</a></code></pre></div>
<p>Try this function with single and multiple filters.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" title="1"><span class="co"># mammals above a kilo</span></a>
<a class="sourceLine" id="cb269-2" title="2"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb269-3" title="3">               <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb269-4" title="4"></a>
<a class="sourceLine" id="cb269-5" title="5"><span class="st">  </span><span class="kw">select</span>(binomial, mass_g) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb269-6" title="6"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb269-7" title="7"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb269-8" title="8"><span class="co">#&gt;   binomial                mass_g</span></a>
<a class="sourceLine" id="cb269-9" title="9"><span class="co">#&gt;   &lt;chr&gt;                    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb269-10" title="10"><span class="co">#&gt; 1 Acerodon_jubatus         1075 </span></a>
<a class="sourceLine" id="cb269-11" title="11"><span class="co">#&gt; 2 Acinonyx_jubatus        46700 </span></a>
<a class="sourceLine" id="cb269-12" title="12"><span class="co">#&gt; 3 Acratocnus_odontrigonus 22990 </span></a>
<a class="sourceLine" id="cb269-13" title="13"><span class="co">#&gt; 4 Acratocnus_ye           21310 </span></a>
<a class="sourceLine" id="cb269-14" title="14"><span class="co">#&gt; 5 Addax_nasomaculatus     70000.</span></a>
<a class="sourceLine" id="cb269-15" title="15"><span class="co">#&gt; 6 Aepyceros_melampus      52500.</span></a></code></pre></div>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" title="1"><span class="co"># mammals between 250 and 500 g and which are mostly carnivorous</span></a>
<a class="sourceLine" id="cb270-2" title="2"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb270-3" title="3">               <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;between(mass_g, 250, 500)&quot;</span>,</a>
<a class="sourceLine" id="cb270-4" title="4">                           <span class="st">&quot;diet_plant &lt; 10&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-5" title="5"></a>
<a class="sourceLine" id="cb270-6" title="6"><span class="st">  </span><span class="kw">select</span>(binomial, mass_g, diet_plant) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-7" title="7"></a>
<a class="sourceLine" id="cb270-8" title="8"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb270-9" title="9"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb270-10" title="10"><span class="co">#&gt;   binomial                mass_g diet_plant</span></a>
<a class="sourceLine" id="cb270-11" title="11"><span class="co">#&gt;   &lt;chr&gt;                    &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb270-12" title="12"><span class="co">#&gt; 1 Chrysospalax_trevelyani   426.          0</span></a>
<a class="sourceLine" id="cb270-13" title="13"><span class="co">#&gt; 2 Cyclopes_didactylus       330.          0</span></a>
<a class="sourceLine" id="cb270-14" title="14"><span class="co">#&gt; 3 Desmana_moschata          383           0</span></a>
<a class="sourceLine" id="cb270-15" title="15"><span class="co">#&gt; 4 Dologale_dybowskii        350           0</span></a>
<a class="sourceLine" id="cb270-16" title="16"><span class="co">#&gt; 5 Hydromys_chrysogaster     480.          0</span></a>
<a class="sourceLine" id="cb270-17" title="17"><span class="co">#&gt; 6 Hyosciurus_heinrichi      296           0</span></a></code></pre></div>
<p>The function <code>filter</code> correctly processes the string passed to filter the data.</p>
</div>
</div>
<div id="flexible-grouping-in-a-function" class="section level2">
<h2><span class="header-section-number">7.5</span> Flexible grouping in a function</h2>
<p>Just as the exact filtering approach can be controlled from a single string vector in the example above, the grouping variables can also be stored and passed as arguments using the <code>...</code> (dots) argument. Dots are a convenient way of referring to all unnamed arguments of a function.
Here, they are used to accept the grouping variables.</p>
<div id="using-...-and-forwarding" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Using <code>...</code> and âforwardingâ</h3>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb271-2" title="2">                          <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb271-3" title="3">                          ...) {</a>
<a class="sourceLine" id="cb271-4" title="4">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb271-5" title="5">  grouping_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">enquos</span>(...)</a>
<a class="sourceLine" id="cb271-6" title="6"></a>
<a class="sourceLine" id="cb271-7" title="7">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb271-8" title="8"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb271-9" title="9"></a>
<a class="sourceLine" id="cb271-10" title="10"><span class="st">    </span><span class="co"># this is the important bit</span></a>
<a class="sourceLine" id="cb271-11" title="11"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars)</a>
<a class="sourceLine" id="cb271-12" title="12">}</a></code></pre></div>
<p>Try the function again, and check the grouping variables.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb272-2" title="2">               <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb272-3" title="3">               order, family) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb272-4" title="4"></a>
<a class="sourceLine" id="cb272-5" title="5"><span class="st">  </span><span class="kw">group_vars</span>()</a>
<a class="sourceLine" id="cb272-6" title="6"><span class="co">#&gt; [1] &quot;order&quot;  &quot;family&quot;</span></a></code></pre></div>
</div>
<div id="passing-grouping-variables-as-strings" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Passing grouping variables as strings</h3>
<p>In the previous example, the grouping variables were passed as unquoted variables, then <code>enquo</code>-ted and parsed, after which they were applied.
An alternative way of passing arguments to a function is as a string vector, i.e, <code>grouping_vars = c("var_a", "var_b)</code>.</p>
<p>This can be done by interpreting the string vector as <code>R</code> symbols using <code>rlang::syms</code>. It could also be done by treating them as a full expression using the previously covered <code>rlang::parse_exprs</code>. However, both methods must use an unquoting-splice (<code>!!!</code>), i.e., force the evaluation of a list of <code>R</code> expressions.</p>
</div>
<div id="using-rlangsyms" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Using <code>rlang::syms</code></h3>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb273-2" title="2">                          <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb273-3" title="3">                          grouping_vars) {</a>
<a class="sourceLine" id="cb273-4" title="4">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb273-5" title="5">  grouping_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">syms</span>(grouping_vars)</a>
<a class="sourceLine" id="cb273-6" title="6"></a>
<a class="sourceLine" id="cb273-7" title="7">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb273-8" title="8"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb273-9" title="9"></a>
<a class="sourceLine" id="cb273-10" title="10"><span class="st">    </span><span class="co"># this is the important bit</span></a>
<a class="sourceLine" id="cb273-11" title="11"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars)</a>
<a class="sourceLine" id="cb273-12" title="12">}</a></code></pre></div>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb274-2" title="2">               <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb274-3" title="3">               <span class="dt">grouping_vars =</span> <span class="kw">c</span>(<span class="st">&quot;order&quot;</span>, <span class="st">&quot;family&quot;</span>)</a>
<a class="sourceLine" id="cb274-4" title="4">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb274-5" title="5"></a>
<a class="sourceLine" id="cb274-6" title="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_mass =</span> <span class="kw">mean</span>(mass_g)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb274-7" title="7"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb274-8" title="8"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb274-9" title="9"><span class="co">#&gt; # Groups:   order [2]</span></a>
<a class="sourceLine" id="cb274-10" title="10"><span class="co">#&gt;   order        family      mean_mass</span></a>
<a class="sourceLine" id="cb274-11" title="11"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb274-12" title="12"><span class="co">#&gt; 1 Afrosoricida Tenrecidae     13220 </span></a>
<a class="sourceLine" id="cb274-13" title="13"><span class="co">#&gt; 2 Carnivora    Ailuridae       4900 </span></a>
<a class="sourceLine" id="cb274-14" title="14"><span class="co">#&gt; 3 Carnivora    Canidae        10502.</span></a>
<a class="sourceLine" id="cb274-15" title="15"><span class="co">#&gt; 4 Carnivora    Eupleridae      5853.</span></a>
<a class="sourceLine" id="cb274-16" title="16"><span class="co">#&gt; 5 Carnivora    Felidae        52801.</span></a>
<a class="sourceLine" id="cb274-17" title="17"><span class="co">#&gt; 6 Carnivora    Herpestidae     2334.</span></a></code></pre></div>
</div>
<div id="using-rlangparse_exprs" class="section level3">
<h3><span class="header-section-number">7.5.4</span> Using <code>rlang::parse_exprs</code></h3>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb275-2" title="2">                          <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb275-3" title="3">                          grouping_vars) {</a>
<a class="sourceLine" id="cb275-4" title="4">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb275-5" title="5">  grouping_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(grouping_vars)</a>
<a class="sourceLine" id="cb275-6" title="6"></a>
<a class="sourceLine" id="cb275-7" title="7">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb275-8" title="8"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb275-9" title="9"></a>
<a class="sourceLine" id="cb275-10" title="10"><span class="st">    </span><span class="co"># this is the important bit</span></a>
<a class="sourceLine" id="cb275-11" title="11"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars)</a>
<a class="sourceLine" id="cb275-12" title="12">}</a></code></pre></div>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb276-2" title="2">               <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb276-3" title="3">               <span class="dt">grouping_vars =</span> <span class="kw">c</span>(<span class="st">&quot;family&quot;</span>, <span class="st">&quot;iucn_status&quot;</span>)</a>
<a class="sourceLine" id="cb276-4" title="4">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-5" title="5"></a>
<a class="sourceLine" id="cb276-6" title="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_mass =</span> <span class="kw">mean</span>(mass_g)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-7" title="7"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb276-8" title="8"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb276-9" title="9"><span class="co">#&gt; # Groups:   family [5]</span></a>
<a class="sourceLine" id="cb276-10" title="10"><span class="co">#&gt;   family         iucn_status mean_mass</span></a>
<a class="sourceLine" id="cb276-11" title="11"><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt;           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb276-12" title="12"><span class="co">#&gt; 1 Ailuridae      EN              4900 </span></a>
<a class="sourceLine" id="cb276-13" title="13"><span class="co">#&gt; 2 Anomaluridae   DD              1770 </span></a>
<a class="sourceLine" id="cb276-14" title="14"><span class="co">#&gt; 3 Antilocapridae EP             40503.</span></a>
<a class="sourceLine" id="cb276-15" title="15"><span class="co">#&gt; 4 Antilocapridae LC             46083.</span></a>
<a class="sourceLine" id="cb276-16" title="16"><span class="co">#&gt; 5 Aotidae        LC              1060 </span></a>
<a class="sourceLine" id="cb276-17" title="17"><span class="co">#&gt; 6 Aplodontiidae  LC              1004</span></a></code></pre></div>
</div>
</div>
<div id="flexible-summarising-in-a-function" class="section level2">
<h2><span class="header-section-number">7.6</span> Flexible summarising in a function</h2>
<p>Summarising using string expressions has been around in the <code>tidyverse</code> for a very long time, and <code>summarise_at</code> is a function most users are familiar with, along with its variants <code>summarise_if</code>, <code>summarise_all</code></p>
<div id="using-dplyrsummarise_at" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Using <code>dplyr::summarise_at</code></h3>
<p>Simply pass a string vector to the <code>.vars</code> argument of <code>summarise_at</code>, while passing a list, named or otherwise, of functions to the <code>.funs</code> argument.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb277-2" title="2">                          <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb277-3" title="3">                          grouping_vars,</a>
<a class="sourceLine" id="cb277-4" title="4">                          summary_vars,</a>
<a class="sourceLine" id="cb277-5" title="5">                          summary_funs) {</a>
<a class="sourceLine" id="cb277-6" title="6">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb277-7" title="7">  grouping_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(grouping_vars)</a>
<a class="sourceLine" id="cb277-8" title="8"></a>
<a class="sourceLine" id="cb277-9" title="9">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-10" title="10"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-11" title="11"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-12" title="12"></a>
<a class="sourceLine" id="cb277-13" title="13"><span class="st">    </span><span class="co"># important bit</span></a>
<a class="sourceLine" id="cb277-14" title="14"><span class="st">    </span><span class="kw">summarise_at</span>(<span class="dt">.vars =</span> summary_vars,</a>
<a class="sourceLine" id="cb277-15" title="15">                 <span class="dt">.funs =</span> summary_funs)</a>
<a class="sourceLine" id="cb277-16" title="16">}</a></code></pre></div>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb278-2" title="2">               <span class="dt">grouping_vars =</span> <span class="kw">c</span>(<span class="st">&quot;order&quot;</span>, <span class="st">&quot;family&quot;</span>),</a>
<a class="sourceLine" id="cb278-3" title="3">               <span class="dt">summary_vars =</span> <span class="st">&quot;mass_g&quot;</span>,</a>
<a class="sourceLine" id="cb278-4" title="4">               <span class="dt">summary_funs =</span> <span class="kw">list</span>(<span class="dt">this_is_a_mean =</span> mean, sd))</a>
<a class="sourceLine" id="cb278-5" title="5"><span class="co">#&gt; # A tibble: 113 x 4</span></a>
<a class="sourceLine" id="cb278-6" title="6"><span class="co">#&gt; # Groups:   order [24]</span></a>
<a class="sourceLine" id="cb278-7" title="7"><span class="co">#&gt;   order        family      this_is_a_mean    fn1</span></a>
<a class="sourceLine" id="cb278-8" title="8"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb278-9" title="9"><span class="co">#&gt; 1 Afrosoricida Tenrecidae          13220     NA </span></a>
<a class="sourceLine" id="cb278-10" title="10"><span class="co">#&gt; 2 Carnivora    Ailuridae            4900     NA </span></a>
<a class="sourceLine" id="cb278-11" title="11"><span class="co">#&gt; 3 Carnivora    Canidae             10502. 11618.</span></a>
<a class="sourceLine" id="cb278-12" title="12"><span class="co">#&gt; 4 Carnivora    Eupleridae           5853.  6234.</span></a>
<a class="sourceLine" id="cb278-13" title="13"><span class="co">#&gt; 5 Carnivora    Felidae             52801. 88201.</span></a>
<a class="sourceLine" id="cb278-14" title="14"><span class="co">#&gt; 6 Carnivora    Herpestidae          2334.   937.</span></a>
<a class="sourceLine" id="cb278-15" title="15"><span class="co">#&gt; # â¦ with 107 more rows</span></a></code></pre></div>
</div>
<div id="using-the-across-argument-for-summary-variables" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Using the <code>across</code> argument for summary variables</h3>
<p><code>dplyr 1.0.0</code> had <code>summarise_*</code> superseded by the <code>across</code> argument to <code>summarise</code>. This works somewhat differently.
The example below shows how the <code>mean</code> of a trait of mammal groups can be found.</p>
<p>This example makes use of embracing using <code>{{ }}</code>, where the double curly braces indicate a <a href="https://adv-r.hadley.nz/functions.html#lazy-evaluation">promise</a>, i.e., an expectation that such a variable will exist in the function environment.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb279-2" title="2">                          <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g &gt; 1000&quot;</span>),</a>
<a class="sourceLine" id="cb279-3" title="3">                          grouping_vars,</a>
<a class="sourceLine" id="cb279-4" title="4">                          summary_vars) {</a>
<a class="sourceLine" id="cb279-5" title="5">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb279-6" title="6">  grouping_vars =<span class="st"> </span><span class="kw">parse_exprs</span>(grouping_vars)</a>
<a class="sourceLine" id="cb279-7" title="7"></a>
<a class="sourceLine" id="cb279-8" title="8">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-9" title="9"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-10" title="10"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-11" title="11"></a>
<a class="sourceLine" id="cb279-12" title="12"><span class="st">    </span><span class="co"># important bit</span></a>
<a class="sourceLine" id="cb279-13" title="13"><span class="st">    </span><span class="kw">summarise</span>(<span class="kw">across</span>({{ summary_vars }},</a>
<a class="sourceLine" id="cb279-14" title="14">              <span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.)))</a>
<a class="sourceLine" id="cb279-15" title="15">}</a></code></pre></div>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb280-2" title="2">               <span class="dt">grouping_vars =</span> <span class="kw">c</span>(<span class="st">&quot;order&quot;</span>, <span class="st">&quot;family&quot;</span>),</a>
<a class="sourceLine" id="cb280-3" title="3">               <span class="dt">summary_vars =</span> <span class="kw">c</span>(mass_g, diet_plant)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb280-4" title="4"></a>
<a class="sourceLine" id="cb280-5" title="5"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb280-6" title="6"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb280-7" title="7"><span class="co">#&gt; # Groups:   order [2]</span></a>
<a class="sourceLine" id="cb280-8" title="8"><span class="co">#&gt;   order        family      mass_g diet_plant</span></a>
<a class="sourceLine" id="cb280-9" title="9"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb280-10" title="10"><span class="co">#&gt; 1 Afrosoricida Tenrecidae  13220       4    </span></a>
<a class="sourceLine" id="cb280-11" title="11"><span class="co">#&gt; 2 Carnivora    Ailuridae    4900      80    </span></a>
<a class="sourceLine" id="cb280-12" title="12"><span class="co">#&gt; 3 Carnivora    Canidae     10502.     15.0  </span></a>
<a class="sourceLine" id="cb280-13" title="13"><span class="co">#&gt; 4 Carnivora    Eupleridae   5853.      2.67 </span></a>
<a class="sourceLine" id="cb280-14" title="14"><span class="co">#&gt; 5 Carnivora    Felidae     52801.      0.348</span></a>
<a class="sourceLine" id="cb280-15" title="15"><span class="co">#&gt; 6 Carnivora    Herpestidae  2334.      9.86</span></a></code></pre></div>
<p><code>across</code> also accepts multiple functions just as <code>summarise_</code> did. This works as follows.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" title="1"><span class="co"># mean and sd</span></a>
<a class="sourceLine" id="cb281-2" title="2">data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(order, family) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">c</span>(mass_g, diet_plant),</a>
<a class="sourceLine" id="cb281-5" title="5">                   <span class="kw">list</span>(<span class="op">~</span><span class="st"> </span><span class="kw">mean</span>(.),</a>
<a class="sourceLine" id="cb281-6" title="6">                        <span class="op">~</span><span class="st"> </span><span class="kw">sd</span>(.))</a>
<a class="sourceLine" id="cb281-7" title="7">                   )</a>
<a class="sourceLine" id="cb281-8" title="8">            ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-9" title="9"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb281-10" title="10"><span class="co">#&gt; # A tibble: 6 x 6</span></a>
<a class="sourceLine" id="cb281-11" title="11"><span class="co">#&gt; # Groups:   order [2]</span></a>
<a class="sourceLine" id="cb281-12" title="12"><span class="co">#&gt;   order        family          mass_g_1 mass_g_2 diet_plant_1 diet_plant_2</span></a>
<a class="sourceLine" id="cb281-13" title="13"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb281-14" title="14"><span class="co">#&gt; 1 Afrosoricida Chrysochloridae     60.7     86.6        0             0   </span></a>
<a class="sourceLine" id="cb281-15" title="15"><span class="co">#&gt; 2 Afrosoricida Tenrecidae         449.    2197.         1.5           6.83</span></a>
<a class="sourceLine" id="cb281-16" title="16"><span class="co">#&gt; 3 Carnivora    Ailuridae         4900       NA         80            NA   </span></a>
<a class="sourceLine" id="cb281-17" title="17"><span class="co">#&gt; 4 Carnivora    Canidae          10268.   11568.        16.0          18.0 </span></a>
<a class="sourceLine" id="cb281-18" title="18"><span class="co">#&gt; 5 Carnivora    Eupleridae        3777.    5364.         4.6           6.72</span></a>
<a class="sourceLine" id="cb281-19" title="19"><span class="co">#&gt; 6 Carnivora    Felidae          52801.   88201.         0.348         2.36</span></a></code></pre></div>
</div>
<div id="summarise-multiple-variables-using-..." class="section level3">
<h3><span class="header-section-number">7.6.3</span> Summarise multiple variables using <code>...</code></h3>
<p>Here, the unquoted and unnamed variables passed to the function are captured by <code>...</code> and <code>enquos</code>-ed, i.e, their evaluation is delayed.
Then the variables are forcibly evaluated within the <code>mean</code> function, and this expression is captured using <code>expr</code>. Since there are multiple variables to summarise, these expressions are stored as a list.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb282-2" title="2">                          grouping_vars,</a>
<a class="sourceLine" id="cb282-3" title="3">                          filters,</a>
<a class="sourceLine" id="cb282-4" title="4">                          ...) {</a>
<a class="sourceLine" id="cb282-5" title="5">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb282-6" title="6">  grouping_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(grouping_vars)</a>
<a class="sourceLine" id="cb282-7" title="7"></a>
<a class="sourceLine" id="cb282-8" title="8">  <span class="co"># deal with summary variables</span></a>
<a class="sourceLine" id="cb282-9" title="9">  summary_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">enquos</span>(...)</a>
<a class="sourceLine" id="cb282-10" title="10"></a>
<a class="sourceLine" id="cb282-11" title="11">  <span class="co"># apply the summary function to the variables</span></a>
<a class="sourceLine" id="cb282-12" title="12">  summary_vars &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(summary_vars, <span class="cf">function</span>(var) {</a>
<a class="sourceLine" id="cb282-13" title="13">    rlang<span class="op">::</span><span class="kw">expr</span>(<span class="kw">mean</span>(<span class="op">!!</span>var, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb282-14" title="14">  })</a>
<a class="sourceLine" id="cb282-15" title="15"></a>
<a class="sourceLine" id="cb282-16" title="16">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb282-17" title="17"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb282-18" title="18"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb282-19" title="19"></a>
<a class="sourceLine" id="cb282-20" title="20"><span class="st">    </span><span class="co"># important bit</span></a>
<a class="sourceLine" id="cb282-21" title="21"><span class="st">    </span><span class="kw">summarise</span>(<span class="op">!!!</span>summary_vars)</a>
<a class="sourceLine" id="cb282-22" title="22">}</a></code></pre></div>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb283-2" title="2">               <span class="dt">grouping_vars =</span> <span class="kw">c</span>(<span class="st">&quot;order&quot;</span>, <span class="st">&quot;family&quot;</span>),</a>
<a class="sourceLine" id="cb283-3" title="3">               <span class="dt">filters =</span> <span class="st">&quot;mass_g &gt; 10&quot;</span>,</a>
<a class="sourceLine" id="cb283-4" title="4">               mass_g, diet_plant) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb283-5" title="5"></a>
<a class="sourceLine" id="cb283-6" title="6"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb283-7" title="7"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb283-8" title="8"><span class="co">#&gt; # Groups:   order [2]</span></a>
<a class="sourceLine" id="cb283-9" title="9"><span class="co">#&gt;   order       family        `mean(mass_g, na.rm = Tâ¦ `mean(diet_plant, na.rm = â¦</span></a>
<a class="sourceLine" id="cb283-10" title="10"><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;                            &lt;dbl&gt;                       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb283-11" title="11"><span class="co">#&gt; 1 Afrosoriciâ¦ Chrysochloriâ¦                     60.7                       0    </span></a>
<a class="sourceLine" id="cb283-12" title="12"><span class="co">#&gt; 2 Afrosoriciâ¦ Tenrecidae                       597.                        2    </span></a>
<a class="sourceLine" id="cb283-13" title="13"><span class="co">#&gt; 3 Carnivora   Ailuridae                       4900                        80    </span></a>
<a class="sourceLine" id="cb283-14" title="14"><span class="co">#&gt; 4 Carnivora   Canidae                        10268.                       16.0  </span></a>
<a class="sourceLine" id="cb283-15" title="15"><span class="co">#&gt; 5 Carnivora   Eupleridae                      3777.                        4.6  </span></a>
<a class="sourceLine" id="cb283-16" title="16"><span class="co">#&gt; 6 Carnivora   Felidae                        52801.                        0.348</span></a></code></pre></div>
<div id="expr-and-enquo" class="section level4 unnumbered">
<h4><code>expr</code> and <code>enquo</code></h4>
<p><code>expr</code> and <code>enquo</code> are essentially the same, defusing/quoting (delaying evaluation) of <code>R</code> code. <code>expr</code> works on expressions supplied by the primary user, while <code>enquo</code> works on arguments passed to a function. When in doubt, ask whether the expression to be quoted has entered the function environment as an argument. If yes, use <code>enquo</code>, and if not <code>expr</code>. The plural forms <code>enquos</code> and <code>exprs</code> exist for multiple arguments.</p>
</div>
<div id="correct-the-names-of-summary-variables" class="section level4">
<h4><span class="header-section-number">7.6.3.1</span> Correct the names of summary variables</h4>
<p>The example above returns summary variables that are not assigned a name.
The <code>enquos</code> function can assign the name from the variable names, so <code>mean(mass_g)</code> is returned as <code>mass_g</code>.
Since it is useful to add a tag to make clear what the summary variable is (mean, variance etc.) an extra <code>glue</code> step is added to assign informative names to the summary variables.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb284-2" title="2">                          grouping_vars,</a>
<a class="sourceLine" id="cb284-3" title="3">                          filters,</a>
<a class="sourceLine" id="cb284-4" title="4">                          ...) {</a>
<a class="sourceLine" id="cb284-5" title="5">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb284-6" title="6">  grouping_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(grouping_vars)</a>
<a class="sourceLine" id="cb284-7" title="7"></a>
<a class="sourceLine" id="cb284-8" title="8">  <span class="co"># deal with summary variables</span></a>
<a class="sourceLine" id="cb284-9" title="9">  summary_vars =<span class="st"> </span>rlang<span class="op">::</span><span class="kw">enquos</span>(..., <span class="dt">.named =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb284-10" title="10"></a>
<a class="sourceLine" id="cb284-11" title="11">  <span class="co"># apply the summary function to the variables</span></a>
<a class="sourceLine" id="cb284-12" title="12">  summary_vars &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(summary_vars, <span class="cf">function</span>(var) {</a>
<a class="sourceLine" id="cb284-13" title="13">    rlang<span class="op">::</span><span class="kw">expr</span>(<span class="kw">mean</span>(<span class="op">!!</span>var, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb284-14" title="14">  })</a>
<a class="sourceLine" id="cb284-15" title="15"></a>
<a class="sourceLine" id="cb284-16" title="16">  <span class="co"># add a prefix to the summary variables</span></a>
<a class="sourceLine" id="cb284-17" title="17">  <span class="kw">names</span>(summary_vars) &lt;-<span class="st"> </span>glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;mean_{names(summary_vars)}&#39;</span>)</a>
<a class="sourceLine" id="cb284-18" title="18"></a>
<a class="sourceLine" id="cb284-19" title="19">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-20" title="20"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span>rlang<span class="op">::</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-21" title="21"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-22" title="22"></a>
<a class="sourceLine" id="cb284-23" title="23"><span class="st">    </span><span class="co"># important bit</span></a>
<a class="sourceLine" id="cb284-24" title="24"><span class="st">    </span><span class="kw">summarise</span>(<span class="op">!!!</span>summary_vars)</a>
<a class="sourceLine" id="cb284-25" title="25">}</a></code></pre></div>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb285-2" title="2">               <span class="dt">grouping_vars =</span> <span class="kw">c</span>(<span class="st">&quot;order&quot;</span>, <span class="st">&quot;family&quot;</span>),</a>
<a class="sourceLine" id="cb285-3" title="3">               <span class="dt">filters =</span> <span class="st">&quot;mass_g &gt; 10&quot;</span>,</a>
<a class="sourceLine" id="cb285-4" title="4">               mass_g, diet_plant) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb285-5" title="5"></a>
<a class="sourceLine" id="cb285-6" title="6"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb285-7" title="7"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb285-8" title="8"><span class="co">#&gt; # Groups:   order [2]</span></a>
<a class="sourceLine" id="cb285-9" title="9"><span class="co">#&gt;   order        family          mean_mass_g mean_diet_plant</span></a>
<a class="sourceLine" id="cb285-10" title="10"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;                 &lt;dbl&gt;           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb285-11" title="11"><span class="co">#&gt; 1 Afrosoricida Chrysochloridae        60.7           0    </span></a>
<a class="sourceLine" id="cb285-12" title="12"><span class="co">#&gt; 2 Afrosoricida Tenrecidae            597.            2    </span></a>
<a class="sourceLine" id="cb285-13" title="13"><span class="co">#&gt; 3 Carnivora    Ailuridae            4900            80    </span></a>
<a class="sourceLine" id="cb285-14" title="14"><span class="co">#&gt; 4 Carnivora    Canidae             10268.           16.0  </span></a>
<a class="sourceLine" id="cb285-15" title="15"><span class="co">#&gt; 5 Carnivora    Eupleridae           3777.            4.6  </span></a>
<a class="sourceLine" id="cb285-16" title="16"><span class="co">#&gt; 6 Carnivora    Felidae             52801.            0.348</span></a></code></pre></div>
</div>
</div>
<div id="summarise-with-multiple-functions" class="section level3">
<h3><span class="header-section-number">7.6.4</span> Summarise with multiple functions</h3>
<p>The final step is to pass multiple summary functions to the summary variables.
Unlike the earlier example using <code>summarise(across(vars, funs))</code>, the goal here is to apply one function to each variable.</p>
<p>This is done by passing the functions and the variables on which they should operate as strings, and using string interpolation via <code>glue</code> to construct a coherent <code>R</code> expression. This expression is then named and evaluated.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" title="1">custom_summary =<span class="st"> </span><span class="cf">function</span>(data,</a>
<a class="sourceLine" id="cb286-2" title="2">                          grouping_vars,</a>
<a class="sourceLine" id="cb286-3" title="3">                          filters,</a>
<a class="sourceLine" id="cb286-4" title="4">                          functions,</a>
<a class="sourceLine" id="cb286-5" title="5">                          summary_vars) {</a>
<a class="sourceLine" id="cb286-6" title="6">  <span class="co"># deal with groups</span></a>
<a class="sourceLine" id="cb286-7" title="7">  grouping_vars =<span class="st"> </span><span class="kw">parse_exprs</span>(grouping_vars)</a>
<a class="sourceLine" id="cb286-8" title="8"></a>
<a class="sourceLine" id="cb286-9" title="9">  <span class="co"># deal with summary variables</span></a>
<a class="sourceLine" id="cb286-10" title="10">  <span class="co"># summary_vars = # enquos(..., .named = TRUE)</span></a>
<a class="sourceLine" id="cb286-11" title="11"></a>
<a class="sourceLine" id="cb286-12" title="12">  <span class="co"># apply the summary function to the variables</span></a>
<a class="sourceLine" id="cb286-13" title="13">  summary_exprs &lt;-<span class="st"> </span><span class="kw">parse_exprs</span>(glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;{functions}({summary_vars}, na.rm = TRUE)&#39;</span>))</a>
<a class="sourceLine" id="cb286-14" title="14"></a>
<a class="sourceLine" id="cb286-15" title="15">  <span class="co"># add a prefix to the summary variables</span></a>
<a class="sourceLine" id="cb286-16" title="16">  <span class="kw">names</span>(summary_exprs) &lt;-<span class="st"> </span>glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;{functions}_{summary_vars}&#39;</span>)</a>
<a class="sourceLine" id="cb286-17" title="17"></a>
<a class="sourceLine" id="cb286-18" title="18">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb286-19" title="19"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!!!</span><span class="kw">parse_exprs</span>(filters)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb286-20" title="20"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!!</span>grouping_vars) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb286-21" title="21"></a>
<a class="sourceLine" id="cb286-22" title="22"><span class="st">    </span><span class="co"># important bit</span></a>
<a class="sourceLine" id="cb286-23" title="23"><span class="st">    </span><span class="kw">summarise</span>(<span class="op">!!!</span>summary_exprs)</a>
<a class="sourceLine" id="cb286-24" title="24">}</a></code></pre></div>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" title="1"><span class="kw">custom_summary</span>(data,</a>
<a class="sourceLine" id="cb287-2" title="2">               <span class="dt">grouping_vars =</span> <span class="kw">c</span>(<span class="st">&quot;order&quot;</span>, <span class="st">&quot;family&quot;</span>),</a>
<a class="sourceLine" id="cb287-3" title="3">               <span class="dt">filters =</span> <span class="st">&quot;mass_g &gt; 10&quot;</span>,</a>
<a class="sourceLine" id="cb287-4" title="4">               <span class="dt">functions =</span> <span class="kw">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;var&quot;</span>),</a>
<a class="sourceLine" id="cb287-5" title="5">               <span class="dt">summary_vars =</span> <span class="kw">c</span>(<span class="st">&quot;mass_g&quot;</span>, <span class="st">&quot;diet_plant&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb287-6" title="6"></a>
<a class="sourceLine" id="cb287-7" title="7"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb287-8" title="8"><span class="co">#&gt; # A tibble: 6 x 4</span></a>
<a class="sourceLine" id="cb287-9" title="9"><span class="co">#&gt; # Groups:   order [2]</span></a>
<a class="sourceLine" id="cb287-10" title="10"><span class="co">#&gt;   order        family          mean_mass_g var_diet_plant</span></a>
<a class="sourceLine" id="cb287-11" title="11"><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;                 &lt;dbl&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb287-12" title="12"><span class="co">#&gt; 1 Afrosoricida Chrysochloridae        60.7           0   </span></a>
<a class="sourceLine" id="cb287-13" title="13"><span class="co">#&gt; 2 Afrosoricida Tenrecidae            597.           61.8 </span></a>
<a class="sourceLine" id="cb287-14" title="14"><span class="co">#&gt; 3 Carnivora    Ailuridae            4900            NA   </span></a>
<a class="sourceLine" id="cb287-15" title="15"><span class="co">#&gt; 4 Carnivora    Canidae             10268.          325.  </span></a>
<a class="sourceLine" id="cb287-16" title="16"><span class="co">#&gt; 5 Carnivora    Eupleridae           3777.           45.2 </span></a>
<a class="sourceLine" id="cb287-17" title="17"><span class="co">#&gt; 6 Carnivora    Felidae             52801.            5.57</span></a></code></pre></div>
</div>
</div>
<div id="further-resources" class="section level2">
<h2><span class="header-section-number">7.7</span> Further resources</h2>
<ul>
<li><code>dplyr</code>: <a href="https://dplyr.tidyverse.org/index.html" class="uri">https://dplyr.tidyverse.org/index.html</a></li>
<li>Tidy evaluation: Superseded and archived, but still useful <a href="https://tidyeval.tidyverse.org/" class="uri">https://tidyeval.tidyverse.org/</a></li>
<li><code>rlang</code>: <a href="https://rlang.r-lib.org/" class="uri">https://rlang.r-lib.org/</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="regular-expressions-and-testthat.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="developing-r-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/tres-tidy-tutorial/edit/master/07_programming_in_the_tidyverse.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["TRES-Tidy-Tutorial.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
