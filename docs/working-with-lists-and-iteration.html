<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Working with lists and iteration | TRES Tidyverse Tutorial</title>
  <meta name="description" content="Section 4 Working with lists and iteration | TRES Tidyverse Tutorial" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Working with lists and iteration | TRES Tidyverse Tutorial" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Section 4 Working with lists and iteration | TRES Tidyverse Tutorial" />
  <meta name="github-repo" content="pratikunterwegs/tres-tidy-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Working with lists and iteration | TRES Tidyverse Tutorial" />
  
  <meta name="twitter:description" content="Section 4 Working with lists and iteration | TRES Tidyverse Tutorial" />
  

<meta name="author" content="Raphael, Pratik and Theo" />


<meta name="date" content="2020-07-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-manipulation-with-dplyr.html"/>
<link rel="next" href="ggplot2-and-the-grammar-of-graphics.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Outline</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#possible-extras"><i class="fa fa-check"></i>Possible extras</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#join"><i class="fa fa-check"></i>Join</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html"><i class="fa fa-check"></i><b>1</b> Reading files and string manipulation</a><ul>
<li class="chapter" data-level="1.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#data-import-and-export-with-readr"><i class="fa fa-check"></i><b>1.1</b> Data import and export with <code>readr</code></a><ul>
<li class="chapter" data-level="1.1.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#reading-data"><i class="fa fa-check"></i><b>1.1.1</b> Reading data</a></li>
<li class="chapter" data-level="1.1.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#writing-data"><i class="fa fa-check"></i><b>1.1.2</b> Writing data</a></li>
<li class="chapter" data-level="1.1.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#reading-and-writing-lines"><i class="fa fa-check"></i><b>1.1.3</b> Reading and writing lines</a></li>
<li class="chapter" data-level="" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#excel-files"><i class="fa fa-check"></i>Excel files</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#string-manipulation-with-stringr"><i class="fa fa-check"></i><b>1.2</b> String manipulation with <code>stringr</code></a><ul>
<li class="chapter" data-level="1.2.1" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#putting-strings-together"><i class="fa fa-check"></i><b>1.2.1</b> Putting strings together</a></li>
<li class="chapter" data-level="1.2.2" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#detecting-strings"><i class="fa fa-check"></i><b>1.2.2</b> Detecting strings</a></li>
<li class="chapter" data-level="1.2.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#matching-strings"><i class="fa fa-check"></i><b>1.2.3</b> Matching strings</a></li>
<li class="chapter" data-level="1.2.4" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#simpler-pattern-extraction"><i class="fa fa-check"></i><b>1.2.4</b> Simpler pattern extraction</a></li>
<li class="chapter" data-level="1.2.5" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#breaking-strings-apart"><i class="fa fa-check"></i><b>1.2.5</b> Breaking strings apart</a></li>
<li class="chapter" data-level="1.2.6" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#replacing-string-elements"><i class="fa fa-check"></i><b>1.2.6</b> Replacing string elements</a></li>
<li class="chapter" data-level="1.2.7" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#subsetting-within-strings"><i class="fa fa-check"></i><b>1.2.7</b> Subsetting within strings</a></li>
<li class="chapter" data-level="1.2.8" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#padding-and-truncating-strings"><i class="fa fa-check"></i><b>1.2.8</b> Padding and truncating strings</a></li>
<li class="chapter" data-level="1.2.9" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#stringr-aspects-not-covered-here"><i class="fa fa-check"></i><b>1.2.9</b> Stringr aspects not covered here</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#string-interpolation-with-glue"><i class="fa fa-check"></i><b>1.3</b> String interpolation with <code>glue</code></a></li>
<li class="chapter" data-level="1.4" data-path="reading-files-and-string-manipulation.html"><a href="reading-files-and-string-manipulation.html#strings-in-ggplot"><i class="fa fa-check"></i><b>1.4</b> Strings in <code>ggplot</code></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><i class="fa fa-check"></i><b>2</b> Reshaping data tables in the tidyverse, and other things</a><ul>
<li class="chapter" data-level="2.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#the-new-data-frame-tibble"><i class="fa fa-check"></i><b>2.1</b> The new data frame: tibble</a></li>
<li class="chapter" data-level="2.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#the-concept-of-tidy-data"><i class="fa fa-check"></i><b>2.2</b> The concept of tidy data</a></li>
<li class="chapter" data-level="2.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#reshaping-with-tidyr"><i class="fa fa-check"></i><b>2.3</b> Reshaping with <code>tidyr</code></a><ul>
<li class="chapter" data-level="2.3.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#pivoting"><i class="fa fa-check"></i><b>2.3.1</b> Pivoting</a></li>
<li class="chapter" data-level="2.3.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#handling-missing-values"><i class="fa fa-check"></i><b>2.3.2</b> Handling missing values</a></li>
<li class="chapter" data-level="2.3.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#splitting-and-combining-cells"><i class="fa fa-check"></i><b>2.3.3</b> Splitting and combining cells</a></li>
<li class="chapter" data-level="2.3.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#expanding-tables-using-combinations"><i class="fa fa-check"></i><b>2.3.4</b> Expanding tables using combinations</a></li>
<li class="chapter" data-level="2.3.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#nesting"><i class="fa fa-check"></i><b>2.3.5</b> Nesting</a></li>
<li class="chapter" data-level="2.3.6" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#what-else-can-be-tidied-up"><i class="fa fa-check"></i><b>2.3.6</b> What else can be tidied up?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#extra-factors-and-the-forcats-package"><i class="fa fa-check"></i><b>2.4</b> Extra: factors and the <code>forcats</code> package</a><ul>
<li class="chapter" data-level="2.4.1" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#change-the-order-of-the-levels"><i class="fa fa-check"></i><b>2.4.1</b> Change the order of the levels</a></li>
<li class="chapter" data-level="2.4.2" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#change-the-levels-themselves"><i class="fa fa-check"></i><b>2.4.2</b> Change the levels themselves</a></li>
<li class="chapter" data-level="2.4.3" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#dropping-levels"><i class="fa fa-check"></i><b>2.4.3</b> Dropping levels</a></li>
<li class="chapter" data-level="2.4.4" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#other-things"><i class="fa fa-check"></i><b>2.4.4</b> Other things</a></li>
<li class="chapter" data-level="2.4.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#take-home-message-for-forcats"><i class="fa fa-check"></i><b>2.4.5</b> Take home message for forcats</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="reshaping-data-tables-in-the-tidyverse-and-other-things.html"><a href="reshaping-data-tables-in-the-tidyverse-and-other-things.html#external-resources"><i class="fa fa-check"></i><b>2.5</b> External resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html"><i class="fa fa-check"></i><b>3</b> Data manipulation with <code>dplyr</code></a><ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#foreword-on-dplyr"><i class="fa fa-check"></i><b>3.1.1</b> Foreword on <code>dplyr</code></a></li>
<li class="chapter" data-level="3.1.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#example-data"><i class="fa fa-check"></i><b>3.1.2</b> Example data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-existing-variables"><i class="fa fa-check"></i><b>3.2</b> Working with existing variables</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#renaming-variables-with-rename"><i class="fa fa-check"></i><b>3.2.1</b> Renaming variables with <code>rename()</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.2.2</b> The pipe operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#select-variables-with-select"><i class="fa fa-check"></i><b>3.2.3</b> Select variables with <code>select()</code></a></li>
<li class="chapter" data-level="3.2.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#select-variables-with-helpers"><i class="fa fa-check"></i><b>3.2.4</b> Select variables with helpers</a></li>
<li class="chapter" data-level="3.2.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#rearranging-variable-order-with-relocate"><i class="fa fa-check"></i><b>3.2.5</b> Rearranging variable order with <code>relocate()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-observations"><i class="fa fa-check"></i><b>3.3</b> Working with observations</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#ordering-rows-by-value---arrange"><i class="fa fa-check"></i><b>3.3.1</b> Ordering rows by value - <code>arrange()</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#subset-rows-by-position---slice"><i class="fa fa-check"></i><b>3.3.2</b> Subset rows by position - <code>slice()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#subsetting-rows-by-value-with-filter"><i class="fa fa-check"></i><b>3.3.3</b> Subsetting rows by value with <code>filter()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#making-new-variables"><i class="fa fa-check"></i><b>3.4</b> Making new variables</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#create-new-variables-with-mutate"><i class="fa fa-check"></i><b>3.4.1</b> Create new variables with <code>mutate()</code></a></li>
<li class="chapter" data-level="3.4.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#summarise-observations-with-summarise"><i class="fa fa-check"></i><b>3.4.2</b> Summarise observations with <code>summarise()</code></a></li>
<li class="chapter" data-level="3.4.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#grouping-observations-by-variables"><i class="fa fa-check"></i><b>3.4.3</b> Grouping observations by variables</a></li>
<li class="chapter" data-level="3.4.4" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#grouped-data-and-other-dplyr-verbs"><i class="fa fa-check"></i><b>3.4.4</b> Grouped data and other <code>dplyr</code> verbs</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#working-with-multiple-tables"><i class="fa fa-check"></i><b>3.5</b> Working with multiple tables</a><ul>
<li class="chapter" data-level="3.5.1" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#binding-tables"><i class="fa fa-check"></i><b>3.5.1</b> Binding tables</a></li>
<li class="chapter" data-level="3.5.2" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#combining-variables-of-two-tables-with-mutating-joins"><i class="fa fa-check"></i><b>3.5.2</b> Combining variables of two tables with mutating joins</a></li>
<li class="chapter" data-level="3.5.3" data-path="data-manipulation-with-dplyr.html"><a href="data-manipulation-with-dplyr.html#filtering-matching-observations-between-two-tables-wiht-filtering-joins"><i class="fa fa-check"></i><b>3.5.3</b> Filtering matching observations between two tables wiht filtering joins</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html"><i class="fa fa-check"></i><b>4</b> Working with lists and iteration</a><ul>
<li class="chapter" data-level="4.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#list-columns-with-tidyr"><i class="fa fa-check"></i><b>4.1</b> List columns with <code>tidyr</code></a><ul>
<li class="chapter" data-level="4.1.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#nesting-data"><i class="fa fa-check"></i><b>4.1.1</b> Nesting data</a></li>
<li class="chapter" data-level="4.1.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#unnesting-data"><i class="fa fa-check"></i><b>4.1.2</b> Unnesting data</a></li>
<li class="chapter" data-level="4.1.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#working-with-list-columns"><i class="fa fa-check"></i><b>4.1.3</b> Working with list columns</a></li>
<li class="chapter" data-level="" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#functionals"><i class="fa fa-check"></i>Functionals</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#iteration-with-map"><i class="fa fa-check"></i><b>4.2</b> Iteration with <code>map</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#basic-use-of-map"><i class="fa fa-check"></i><b>4.2.1</b> Basic use of <code>map</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#map-variants-returning-vectors"><i class="fa fa-check"></i><b>4.2.2</b> <code>map</code> variants returning vectors</a></li>
<li class="chapter" data-level="4.2.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#map-variants-returning-data-frames"><i class="fa fa-check"></i><b>4.2.3</b> <code>map</code> variants returning data frames</a></li>
<li class="chapter" data-level="4.2.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#working-with-list-columns-using-map"><i class="fa fa-check"></i><b>4.2.4</b> Working with list columns using <code>map</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#selective-mapping-using-map-variants"><i class="fa fa-check"></i><b>4.2.5</b> Selective mapping using <code>map</code> variants</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#more-map-variants"><i class="fa fa-check"></i><b>4.3</b> More <code>map</code> variants</a><ul>
<li class="chapter" data-level="4.3.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#mapping-over-two-inputs-with-map2"><i class="fa fa-check"></i><b>4.3.1</b> Mapping over two inputs with map2</a></li>
<li class="chapter" data-level="4.3.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#mapping-over-multiple-inputs-with-pmap"><i class="fa fa-check"></i><b>4.3.2</b> Mapping over multiple inputs with pmap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#combining-map-variants-and-tidyverse-functions"><i class="fa fa-check"></i><b>4.4</b> Combining map variants and tidyverse functions</a></li>
<li class="chapter" data-level="4.5" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#a-return-to-map-variants"><i class="fa fa-check"></i><b>4.5</b> A return to map variants</a><ul>
<li class="chapter" data-level="4.5.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#iteration-without-a-return"><i class="fa fa-check"></i><b>4.5.1</b> Iteration without a return</a></li>
<li class="chapter" data-level="4.5.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#modify-rather-than-map"><i class="fa fa-check"></i><b>4.5.2</b> Modify rather than map</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#other-functions-for-working-with-lists"><i class="fa fa-check"></i><b>4.6</b> Other functions for working with lists</a><ul>
<li class="chapter" data-level="4.6.1" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#filtering-lists"><i class="fa fa-check"></i><b>4.6.1</b> Filtering lists</a></li>
<li class="chapter" data-level="4.6.2" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#summarising-lists"><i class="fa fa-check"></i><b>4.6.2</b> Summarising lists</a></li>
<li class="chapter" data-level="4.6.3" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#reduction-and-accumulation"><i class="fa fa-check"></i><b>4.6.3</b> Reduction and accumulation</a></li>
<li class="chapter" data-level="4.6.4" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#miscellaneous-operation"><i class="fa fa-check"></i><b>4.6.4</b> Miscellaneous operation</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="working-with-lists-and-iteration.html"><a href="working-with-lists-and-iteration.html#lists-of-ggplots-with-patchwork"><i class="fa fa-check"></i><b>4.7</b> Lists of <code>ggplots</code> with <code>patchwork</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html"><i class="fa fa-check"></i><b>5</b> <code>ggplot2</code> and the grammar of graphics</a><ul>
<li class="chapter" data-level="5.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="5.1.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#what-is-ggplot2-and-why-use-it"><i class="fa fa-check"></i><b>5.1.1</b> What is <code>ggplot2</code> and why use it?</a></li>
<li class="chapter" data-level="5.1.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#what-is-the-grammar-of-graphics"><i class="fa fa-check"></i><b>5.1.2</b> What is the grammar of graphics?</a></li>
<li class="chapter" data-level="5.1.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#quick-plot"><i class="fa fa-check"></i><b>5.1.3</b> Quick plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#but-first-the-data"><i class="fa fa-check"></i><b>5.2</b> But first, the data</a></li>
<li class="chapter" data-level="5.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#geom-layers"><i class="fa fa-check"></i><b>5.3</b> Geom layers</a><ul>
<li class="chapter" data-level="5.3.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#mapping-variables-to-aesthetics"><i class="fa fa-check"></i><b>5.3.1</b> Mapping variables to aesthetics</a></li>
<li class="chapter" data-level="5.3.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#fixed-aesthetics"><i class="fa fa-check"></i><b>5.3.2</b> Fixed aesthetics</a></li>
<li class="chapter" data-level="5.3.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#statistical-transformation"><i class="fa fa-check"></i><b>5.3.3</b> Statistical transformation</a></li>
<li class="chapter" data-level="5.3.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#position"><i class="fa fa-check"></i><b>5.3.4</b> Position</a></li>
<li class="chapter" data-level="5.3.5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#other-geoms"><i class="fa fa-check"></i><b>5.3.5</b> Other geoms</a></li>
<li class="chapter" data-level="5.3.6" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#extra-on-aesthetics"><i class="fa fa-check"></i><b>5.3.6</b> Extra on aesthetics</a></li>
<li class="chapter" data-level="5.3.7" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#plot-wide-aesthetics-and-multiple-geoms"><i class="fa fa-check"></i><b>5.3.7</b> Plot-wide aesthetics and multiple geoms</a></li>
<li class="chapter" data-level="5.3.8" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#multiple-geoms-with-different-datasets"><i class="fa fa-check"></i><b>5.3.8</b> Multiple geoms with different datasets</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#coordinate-system"><i class="fa fa-check"></i><b>5.4</b> Coordinate-system</a></li>
<li class="chapter" data-level="5.5" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#facetting"><i class="fa fa-check"></i><b>5.5</b> Facetting</a></li>
<li class="chapter" data-level="5.6" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#the-right-format-for-the-dataset"><i class="fa fa-check"></i><b>5.6</b> The right format for the dataset</a></li>
<li class="chapter" data-level="5.7" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#plotting-as-part-of-a-pipeline"><i class="fa fa-check"></i><b>5.7</b> Plotting as part of a pipeline</a></li>
<li class="chapter" data-level="5.8" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#customization"><i class="fa fa-check"></i><b>5.8</b> Customization</a><ul>
<li class="chapter" data-level="5.8.1" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#scales"><i class="fa fa-check"></i><b>5.8.1</b> Scales</a></li>
<li class="chapter" data-level="5.8.2" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#labels"><i class="fa fa-check"></i><b>5.8.2</b> Labels</a></li>
<li class="chapter" data-level="5.8.3" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#themes"><i class="fa fa-check"></i><b>5.8.3</b> Themes</a></li>
<li class="chapter" data-level="5.8.4" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#legend"><i class="fa fa-check"></i><b>5.8.4</b> Legend</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#combining-plots"><i class="fa fa-check"></i><b>5.9</b> Combining plots</a></li>
<li class="chapter" data-level="5.10" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#saving-a-plot"><i class="fa fa-check"></i><b>5.10</b> Saving a plot</a></li>
<li class="chapter" data-level="5.11" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#high-throughput-plotting-workflow"><i class="fa fa-check"></i><b>5.11</b> High throughput plotting workflow</a></li>
<li class="chapter" data-level="5.12" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#want-more"><i class="fa fa-check"></i><b>5.12</b> Want more?</a></li>
<li class="chapter" data-level="5.13" data-path="ggplot2-and-the-grammar-of-graphics.html"><a href="ggplot2-and-the-grammar-of-graphics.html#references"><i class="fa fa-check"></i><b>5.13</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">TRES Tidyverse Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-lists-and-iteration" class="section level1">
<h1><span class="header-section-number">Section 4</span> Working with lists and iteration</h1>
<p><img src="opening-image.png" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1"><span class="co"># load the tidyverse</span></a>
<a class="sourceLine" id="cb120-2" title="2"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div id="list-columns-with-tidyr" class="section level2">
<h2><span class="header-section-number">4.1</span> List columns with <code>tidyr</code></h2>
<div id="nesting-data" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Nesting data</h3>
<p>It may become necessary to indicate the groups of a tibble in a somewhat more explicit way than simply using <code>dplyr::group_by</code>. <code>tidyr</code> offers the option to create nested tibbles, that is, to store complex objects in the columns of a tibble. This includes other tibbles, as well as model objects and plots.</p>
<p><em>NB:</em> Nesting data is done using <code>tidyr::nest</code>, which is different from the similarly named <code>tidyr::nesting</code>.</p>
<p>The example below shows how <em>Phylacine</em> data can be converted into a nested tibble.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="co"># get phylacine data</span></a>
<a class="sourceLine" id="cb121-2" title="2">data =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/phylacine_traits.csv&quot;</span>)</a>
<a class="sourceLine" id="cb121-3" title="3">data =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-4" title="4"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">str_to_lower</span>(<span class="kw">colnames</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-5" title="5"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">str_remove</span>(<span class="kw">colnames</span>(.), <span class="st">&quot;(.1.2)&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-6" title="6"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(<span class="kw">str_replace_all</span>(<span class="kw">colnames</span>(.), <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;_&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="co"># nest phylacine by order</span></a>
<a class="sourceLine" id="cb122-2" title="2">nested_data =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb122-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(order) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb122-4" title="4"><span class="st">  </span><span class="kw">nest</span>()</a>
<a class="sourceLine" id="cb122-5" title="5"></a>
<a class="sourceLine" id="cb122-6" title="6">nested_data</a>
<a class="sourceLine" id="cb122-7" title="7"><span class="co">#&gt; # A tibble: 29 x 2</span></a>
<a class="sourceLine" id="cb122-8" title="8"><span class="co">#&gt; # Groups:   order [29]</span></a>
<a class="sourceLine" id="cb122-9" title="9"><span class="co">#&gt;   order           data                 </span></a>
<a class="sourceLine" id="cb122-10" title="10"><span class="co">#&gt;   &lt;chr&gt;           &lt;list&gt;               </span></a>
<a class="sourceLine" id="cb122-11" title="11"><span class="co">#&gt; 1 Rodentia        &lt;tibble [2,306 × 23]&gt;</span></a>
<a class="sourceLine" id="cb122-12" title="12"><span class="co">#&gt; 2 Chiroptera      &lt;tibble [1,162 × 23]&gt;</span></a>
<a class="sourceLine" id="cb122-13" title="13"><span class="co">#&gt; 3 Carnivora       &lt;tibble [313 × 23]&gt;  </span></a>
<a class="sourceLine" id="cb122-14" title="14"><span class="co">#&gt; 4 Pilosa          &lt;tibble [34 × 23]&gt;   </span></a>
<a class="sourceLine" id="cb122-15" title="15"><span class="co">#&gt; 5 Diprotodontia   &lt;tibble [183 × 23]&gt;  </span></a>
<a class="sourceLine" id="cb122-16" title="16"><span class="co">#&gt; 6 Cetartiodactyla &lt;tibble [392 × 23]&gt;  </span></a>
<a class="sourceLine" id="cb122-17" title="17"><span class="co">#&gt; # … with 23 more rows</span></a>
<a class="sourceLine" id="cb122-18" title="18"></a>
<a class="sourceLine" id="cb122-19" title="19"><span class="co"># get column class</span></a>
<a class="sourceLine" id="cb122-20" title="20"><span class="kw">sapply</span>(nested_data, class)</a>
<a class="sourceLine" id="cb122-21" title="21"><span class="co">#&gt;       order        data </span></a>
<a class="sourceLine" id="cb122-22" title="22"><span class="co">#&gt; &quot;character&quot;      &quot;list&quot;</span></a></code></pre></div>
<p>The data is now a nested data frame. The class of each of its columns is respectively, a character (order name) and a list (the data of all mammals in the corresponding order).</p>
<p>While <code>nest</code> can be used without first grouping the tibble, it’s just much easier to group first.</p>
</div>
<div id="unnesting-data" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Unnesting data</h3>
<p>A nested tibble can be converted back into the original, or into a processed form, using <code>tidyr::unnest</code>. The original groups are retained.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1"><span class="co"># use unnest to recover the original data frame</span></a>
<a class="sourceLine" id="cb123-2" title="2"><span class="kw">unnest</span>(nested_data, <span class="dt">cols =</span> <span class="st">&quot;data&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb123-3" title="3"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb123-4" title="4"><span class="co">#&gt; # A tibble: 6 x 24</span></a>
<a class="sourceLine" id="cb123-5" title="5"><span class="co">#&gt; # Groups:   order [1]</span></a>
<a class="sourceLine" id="cb123-6" title="6"><span class="co">#&gt;   order binomial family genus species terrestrial marine freshwater aerial</span></a>
<a class="sourceLine" id="cb123-7" title="7"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb123-8" title="8"><span class="co">#&gt; 1 Rode… Abditom… Murid… Abdi… latide…           1      0          0      0</span></a>
<a class="sourceLine" id="cb123-9" title="9"><span class="co">#&gt; 2 Rode… Abeomel… Murid… Abeo… sevia             1      0          0      0</span></a>
<a class="sourceLine" id="cb123-10" title="10"><span class="co">#&gt; 3 Rode… Abraway… Crice… Abra… ruschii           1      0          0      0</span></a>
<a class="sourceLine" id="cb123-11" title="11"><span class="co">#&gt; 4 Rode… Abrocom… Abroc… Abro… bennet…           1      0          0      0</span></a>
<a class="sourceLine" id="cb123-12" title="12"><span class="co">#&gt; 5 Rode… Abrocom… Abroc… Abro… bolivi…           1      0          0      0</span></a>
<a class="sourceLine" id="cb123-13" title="13"><span class="co">#&gt; 6 Rode… Abrocom… Abroc… Abro… budini            1      0          0      0</span></a>
<a class="sourceLine" id="cb123-14" title="14"><span class="co">#&gt; # … with 15 more variables: life_habit_method &lt;chr&gt;, life_habit_source &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb123-15" title="15"><span class="co">#&gt; #   mass_g &lt;dbl&gt;, mass_method &lt;chr&gt;, mass_source &lt;chr&gt;, mass_comparison &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb123-16" title="16"><span class="co">#&gt; #   mass_comparison_source &lt;chr&gt;, island_endemicity &lt;chr&gt;, iucn_status &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb123-17" title="17"><span class="co">#&gt; #   added_iucn_status &lt;chr&gt;, diet_plant &lt;dbl&gt;, diet_vertebrate &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb123-18" title="18"><span class="co">#&gt; #   diet_invertebrate &lt;dbl&gt;, diet_method &lt;chr&gt;, diet_source &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb123-19" title="19"></a>
<a class="sourceLine" id="cb123-20" title="20"><span class="co"># unnesting preserves groups</span></a>
<a class="sourceLine" id="cb123-21" title="21"><span class="kw">groups</span>(<span class="kw">unnest</span>(nested_data, <span class="dt">cols =</span> <span class="st">&quot;data&quot;</span>))</a>
<a class="sourceLine" id="cb123-22" title="22"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb123-23" title="23"><span class="co">#&gt; order</span></a></code></pre></div>
<p>The <code>unnest_longer</code> and <code>unnest_wider</code> variants of <code>unnest</code> are maturing functions, that is, not in their final form. They allow interesting variations on unnesting — these are shown here but advised against.
Unnest the data first, and then convert it to the form needed.</p>
</div>
<div id="working-with-list-columns" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Working with list columns</h3>
<p>The class of a list column is <code>list</code>, and working with list columns (and lists, and list-like objects such as vectors) makes iteration necessary, since this is one of the only ways to operate on lists.</p>
<p>Two examples are shown below when getting the class and number of rows of the nested tibbles in the list column.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1"><span class="co"># how many rows in each nested tibble?</span></a>
<a class="sourceLine" id="cb124-2" title="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(nested_data<span class="op">$</span>data[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])) {</a>
<a class="sourceLine" id="cb124-3" title="3">  <span class="kw">print</span>(<span class="kw">nrow</span>(nested_data<span class="op">$</span>data[[i]]))</a>
<a class="sourceLine" id="cb124-4" title="4">}</a>
<a class="sourceLine" id="cb124-5" title="5"><span class="co">#&gt; [1] 2306</span></a>
<a class="sourceLine" id="cb124-6" title="6"><span class="co">#&gt; [1] 1162</span></a>
<a class="sourceLine" id="cb124-7" title="7"><span class="co">#&gt; [1] 313</span></a>
<a class="sourceLine" id="cb124-8" title="8"><span class="co">#&gt; [1] 34</span></a>
<a class="sourceLine" id="cb124-9" title="9"><span class="co">#&gt; [1] 183</span></a>
<a class="sourceLine" id="cb124-10" title="10"><span class="co">#&gt; [1] 392</span></a>
<a class="sourceLine" id="cb124-11" title="11"><span class="co">#&gt; [1] 460</span></a>
<a class="sourceLine" id="cb124-12" title="12"><span class="co">#&gt; [1] 57</span></a>
<a class="sourceLine" id="cb124-13" title="13"><span class="co">#&gt; [1] 20</span></a>
<a class="sourceLine" id="cb124-14" title="14"><span class="co">#&gt; [1] 465</span></a>
<a class="sourceLine" id="cb124-15" title="15"></a>
<a class="sourceLine" id="cb124-16" title="16"><span class="co"># what is the class of each element?</span></a>
<a class="sourceLine" id="cb124-17" title="17"><span class="kw">lapply</span>(<span class="dt">X =</span> nested_data<span class="op">$</span>data[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">FUN =</span> class)</a>
<a class="sourceLine" id="cb124-18" title="18"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb124-19" title="19"><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></a>
<a class="sourceLine" id="cb124-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb124-21" title="21"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb124-22" title="22"><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></a>
<a class="sourceLine" id="cb124-23" title="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb124-24" title="24"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb124-25" title="25"><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></a></code></pre></div>
</div>
<div id="functionals" class="section level3 unnumbered">
<h3>Functionals</h3>
<p>The second example uses <code>lapply</code>, and this is a <em>functional</em>. <em>Functionals</em> are functions that take another function as one of their arguments. Base <code>R</code> functionals include the <code>*apply</code> family of functions: <code>apply</code>, <code>lapply</code>, <code>vapply</code> and so on.</p>
</div>
</div>
<div id="iteration-with-map" class="section level2">
<h2><span class="header-section-number">4.2</span> Iteration with <code>map</code></h2>
<p>The <code>tidyverse</code> replaces traditional loop-based iteration with <em>functionals</em> from the <code>purrr</code> package.</p>
<div id="why-use-purrr" class="section level4 unnumbered">
<h4>Why use <code>purrr</code></h4>
<p>A good reason to use <code>purrr</code> functionals instead of base <code>R</code> functionals is their consistent and clear naming, which always indicates how they should be used. This is explained in the examples below. How <code>map</code> is different from <code>for</code> and <code>lapply</code> are best explained in the <strong><a href="https://adv-r.hadley.nz/functionals.html">Advanced R Book</a></strong>.</p>
</div>
<div id="basic-use-of-map" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Basic use of <code>map</code></h3>
<p><code>map</code> works very similarly to <code>lapply</code>, where <code>.x</code> is object on whose elements to apply the function <code>.f</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1"><span class="co"># get the number of rows in data</span></a>
<a class="sourceLine" id="cb125-2" title="2"><span class="kw">map</span>(<span class="dt">.x =</span> nested_data<span class="op">$</span>data, <span class="dt">.f =</span> nrow) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-3" title="3"><span class="st">  </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb125-4" title="4"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb125-5" title="5"><span class="co">#&gt; [1] 2306</span></a>
<a class="sourceLine" id="cb125-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb125-7" title="7"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb125-8" title="8"><span class="co">#&gt; [1] 1162</span></a>
<a class="sourceLine" id="cb125-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb125-10" title="10"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb125-11" title="11"><span class="co">#&gt; [1] 313</span></a>
<a class="sourceLine" id="cb125-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb125-13" title="13"><span class="co">#&gt; [[4]]</span></a>
<a class="sourceLine" id="cb125-14" title="14"><span class="co">#&gt; [1] 34</span></a>
<a class="sourceLine" id="cb125-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb125-16" title="16"><span class="co">#&gt; [[5]]</span></a>
<a class="sourceLine" id="cb125-17" title="17"><span class="co">#&gt; [1] 183</span></a>
<a class="sourceLine" id="cb125-18" title="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb125-19" title="19"><span class="co">#&gt; [[6]]</span></a>
<a class="sourceLine" id="cb125-20" title="20"><span class="co">#&gt; [1] 392</span></a></code></pre></div>
<p><code>map</code> works on any list-like object, which includes vectors, and always returns a list. <code>map</code> takes two arguments, the object on which to operate, and the function to apply to each element.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1"><span class="co"># get the square root of each integer 1 - 10</span></a>
<a class="sourceLine" id="cb126-2" title="2">some_numbers =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb126-3" title="3"><span class="kw">map</span>(some_numbers, sqrt)</a>
<a class="sourceLine" id="cb126-4" title="4"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb126-5" title="5"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb126-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb126-7" title="7"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb126-8" title="8"><span class="co">#&gt; [1] 1.41</span></a>
<a class="sourceLine" id="cb126-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb126-10" title="10"><span class="co">#&gt; [[3]]</span></a>
<a class="sourceLine" id="cb126-11" title="11"><span class="co">#&gt; [1] 1.73</span></a></code></pre></div>
</div>
<div id="map-variants-returning-vectors" class="section level3">
<h3><span class="header-section-number">4.2.2</span> <code>map</code> variants returning vectors</h3>
<p>Though <code>map</code> always returns a list, it has variants named <code>map_*</code> where the suffix indicates the return type.
<code>map_chr</code>, <code>map_dbl</code>, <code>map_int</code>, and <code>map_lgl</code> return character, double (numeric), integer, and logical vectors.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1"><span class="co"># use map_dbl to get the mean mass in each order</span></a>
<a class="sourceLine" id="cb127-2" title="2"><span class="kw">map_dbl</span>(nested_data<span class="op">$</span>data, <span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb127-3" title="3">  <span class="kw">mean</span>(df<span class="op">$</span>mass_g)</a>
<a class="sourceLine" id="cb127-4" title="4">})</a>
<a class="sourceLine" id="cb127-5" title="5"><span class="co">#&gt;  [1] 4.86e+02 4.91e+01 4.79e+04 7.86e+05 4.02e+04 1.85e+06 6.68e+03 3.06e+02</span></a>
<a class="sourceLine" id="cb127-6" title="6"><span class="co">#&gt;  [9] 1.61e+02 4.06e+01 7.48e+02 1.45e+03 2.36e+05 3.37e+01 1.74e+02 9.58e+05</span></a>
<a class="sourceLine" id="cb127-7" title="7"><span class="co">#&gt; [17] 9.03e+02 4.70e+06 1.13e+03 2.84e+03 2.23e+01 1.12e+06 1.83e+02 5.94e+05</span></a>
<a class="sourceLine" id="cb127-8" title="8"><span class="co">#&gt; [25] 1.22e+04 9.44e+03 1.65e+06 4.45e+01 5.24e+04</span></a>
<a class="sourceLine" id="cb127-9" title="9"></a>
<a class="sourceLine" id="cb127-10" title="10"><span class="co"># map_chr will convert the output to a character</span></a>
<a class="sourceLine" id="cb127-11" title="11"><span class="co"># here we get the most common IUCN status of each order</span></a>
<a class="sourceLine" id="cb127-12" title="12"><span class="kw">map_chr</span>(nested_data<span class="op">$</span>data, <span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb127-13" title="13">  </a>
<a class="sourceLine" id="cb127-14" title="14">  <span class="kw">count</span>(df, iucn_status) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb127-15" title="15"><span class="st">    </span><span class="kw">arrange</span>(<span class="op">-</span>n) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb127-16" title="16"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">common_status =</span> <span class="kw">first</span>(iucn_status)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb127-17" title="17"><span class="st">    </span><span class="kw">pull</span>(common_status)</a>
<a class="sourceLine" id="cb127-18" title="18">})</a>
<a class="sourceLine" id="cb127-19" title="19"><span class="co">#&gt;  [1] &quot;LC&quot; &quot;LC&quot; &quot;LC&quot; &quot;EP&quot; &quot;LC&quot; &quot;LC&quot; &quot;LC&quot; &quot;LC&quot; &quot;LC&quot; &quot;LC&quot; &quot;LC&quot; &quot;LC&quot; &quot;EP&quot; &quot;VU&quot; &quot;LC&quot;</span></a>
<a class="sourceLine" id="cb127-20" title="20"><span class="co">#&gt; [16] &quot;EP&quot; &quot;LC&quot; &quot;EP&quot; &quot;LC&quot; &quot;LC&quot; &quot;NT&quot; &quot;VU&quot; &quot;LC&quot; &quot;EP&quot; &quot;VU&quot; &quot;CR&quot; &quot;EP&quot; &quot;LC&quot; &quot;LC&quot;</span></a>
<a class="sourceLine" id="cb127-21" title="21"></a>
<a class="sourceLine" id="cb127-22" title="22"><span class="co"># map_lgl returns TRUE/FALSE values</span></a>
<a class="sourceLine" id="cb127-23" title="23">some_numbers =<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="ot">NA</span>, <span class="ot">NaN</span>, <span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb127-24" title="24"><span class="kw">map_lgl</span>(some_numbers, is.na)</a>
<a class="sourceLine" id="cb127-25" title="25"><span class="co">#&gt; [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE</span></a></code></pre></div>
</div>
<div id="map-variants-returning-data-frames" class="section level3">
<h3><span class="header-section-number">4.2.3</span> <code>map</code> variants returning data frames</h3>
<p><code>map_df</code> returns data frames, and by default binds dataframes by rows, while <code>map_dfr</code> does this explicitly, and <code>map_dfc</code> does returns a dataframe bound by column.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="co"># get the first two rows of each dataframe</span></a>
<a class="sourceLine" id="cb128-2" title="2"><span class="kw">map_df</span>(nested_data<span class="op">$</span>data[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], head, <span class="dt">n =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb128-3" title="3"><span class="co">#&gt; # A tibble: 6 x 23</span></a>
<a class="sourceLine" id="cb128-4" title="4"><span class="co">#&gt;   binomial family genus species terrestrial marine freshwater aerial</span></a>
<a class="sourceLine" id="cb128-5" title="5"><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb128-6" title="6"><span class="co">#&gt; 1 Abditom… Murid… Abdi… latide…           1      0          0      0</span></a>
<a class="sourceLine" id="cb128-7" title="7"><span class="co">#&gt; 2 Abeomel… Murid… Abeo… sevia             1      0          0      0</span></a>
<a class="sourceLine" id="cb128-8" title="8"><span class="co">#&gt; 3 Acerodo… Ptero… Acer… celebe…           0      0          0      1</span></a>
<a class="sourceLine" id="cb128-9" title="9"><span class="co">#&gt; 4 Acerodo… Ptero… Acer… humilis           0      0          0      1</span></a>
<a class="sourceLine" id="cb128-10" title="10"><span class="co">#&gt; 5 Acinony… Felid… Acin… jubatus           1      0          0      0</span></a>
<a class="sourceLine" id="cb128-11" title="11"><span class="co">#&gt; 6 Ailurop… Ursid… Ailu… melano…           1      0          0      0</span></a>
<a class="sourceLine" id="cb128-12" title="12"><span class="co">#&gt; # … with 15 more variables: life_habit_method &lt;chr&gt;, life_habit_source &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb128-13" title="13"><span class="co">#&gt; #   mass_g &lt;dbl&gt;, mass_method &lt;chr&gt;, mass_source &lt;chr&gt;, mass_comparison &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb128-14" title="14"><span class="co">#&gt; #   mass_comparison_source &lt;chr&gt;, island_endemicity &lt;chr&gt;, iucn_status &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb128-15" title="15"><span class="co">#&gt; #   added_iucn_status &lt;chr&gt;, diet_plant &lt;dbl&gt;, diet_vertebrate &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb128-16" title="16"><span class="co">#&gt; #   diet_invertebrate &lt;dbl&gt;, diet_method &lt;chr&gt;, diet_source &lt;chr&gt;</span></a></code></pre></div>
<p><code>map</code> accepts arguments to the function being mapped, such as in the example above, where <code>head()</code> accepts the argument <code>n = 2</code>.</p>
<p><code>map_dfr</code> behaves the same as <code>map_df</code>.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1"><span class="co"># the same as above but with a pipe</span></a>
<a class="sourceLine" id="cb129-2" title="2">nested_data<span class="op">$</span>data[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb129-3" title="3"><span class="st">  </span><span class="kw">map_dfr</span>(head, <span class="dt">n =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb129-4" title="4"><span class="co">#&gt; # A tibble: 10 x 23</span></a>
<a class="sourceLine" id="cb129-5" title="5"><span class="co">#&gt;   binomial family genus species terrestrial marine freshwater aerial</span></a>
<a class="sourceLine" id="cb129-6" title="6"><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb129-7" title="7"><span class="co">#&gt; 1 Abditom… Murid… Abdi… latide…           1      0          0      0</span></a>
<a class="sourceLine" id="cb129-8" title="8"><span class="co">#&gt; 2 Abeomel… Murid… Abeo… sevia             1      0          0      0</span></a>
<a class="sourceLine" id="cb129-9" title="9"><span class="co">#&gt; 3 Acerodo… Ptero… Acer… celebe…           0      0          0      1</span></a>
<a class="sourceLine" id="cb129-10" title="10"><span class="co">#&gt; 4 Acerodo… Ptero… Acer… humilis           0      0          0      1</span></a>
<a class="sourceLine" id="cb129-11" title="11"><span class="co">#&gt; 5 Acinony… Felid… Acin… jubatus           1      0          0      0</span></a>
<a class="sourceLine" id="cb129-12" title="12"><span class="co">#&gt; 6 Ailurop… Ursid… Ailu… melano…           1      0          0      0</span></a>
<a class="sourceLine" id="cb129-13" title="13"><span class="co">#&gt; # … with 4 more rows, and 15 more variables: life_habit_method &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb129-14" title="14"><span class="co">#&gt; #   life_habit_source &lt;chr&gt;, mass_g &lt;dbl&gt;, mass_method &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb129-15" title="15"><span class="co">#&gt; #   mass_source &lt;chr&gt;, mass_comparison &lt;chr&gt;, mass_comparison_source &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb129-16" title="16"><span class="co">#&gt; #   island_endemicity &lt;chr&gt;, iucn_status &lt;chr&gt;, added_iucn_status &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb129-17" title="17"><span class="co">#&gt; #   diet_plant &lt;dbl&gt;, diet_vertebrate &lt;dbl&gt;, diet_invertebrate &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb129-18" title="18"><span class="co">#&gt; #   diet_method &lt;chr&gt;, diet_source &lt;chr&gt;</span></a></code></pre></div>
<p><code>map_dfc</code> binds the resulting 3 data frames of two rows each by column, and automatically repairs the column names, adding a suffix to each duplicate.</p>
</div>
<div id="working-with-list-columns-using-map" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Working with list columns using <code>map</code></h3>
<p>The various <code>map</code> versions integrate well with list columns to make synthetic/summary data. In the example, the <code>dplyr::mutate</code> function is used to add three columns to the nested tibble: the number of rows, the mean mileage, and the name of the first car.</p>
<p>In each of these cases, the vectors added are generated using <code>purrr</code> functions.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1"><span class="co"># get the number of rows per dataframe, the mean mileage, and the first car</span></a>
<a class="sourceLine" id="cb130-2" title="2">nested_data =<span class="st"> </span>nested_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb130-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb130-4" title="4">    <span class="co"># use the int return to get the number of rows</span></a>
<a class="sourceLine" id="cb130-5" title="5">    <span class="dt">n_rows =</span> <span class="kw">map_int</span>(data, nrow),</a>
<a class="sourceLine" id="cb130-6" title="6">    </a>
<a class="sourceLine" id="cb130-7" title="7">    <span class="co"># double return for mean mileage</span></a>
<a class="sourceLine" id="cb130-8" title="8">    <span class="dt">mean_mass =</span> <span class="kw">map_dbl</span>(data, <span class="cf">function</span>(df) {<span class="kw">mean</span>(df<span class="op">$</span>mass_g)}),</a>
<a class="sourceLine" id="cb130-9" title="9">    </a>
<a class="sourceLine" id="cb130-10" title="10">    <span class="co"># character return to get the heaviest member</span></a>
<a class="sourceLine" id="cb130-11" title="11">    <span class="dt">first_animal =</span> <span class="kw">map_chr</span>(data, <span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb130-12" title="12">      <span class="kw">arrange</span>(df, <span class="op">-</span>mass_g) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-13" title="13"><span class="st">        </span>.<span class="op">$</span>binomial <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-14" title="14"><span class="st">        </span><span class="kw">first</span>()}</a>
<a class="sourceLine" id="cb130-15" title="15">    )</a>
<a class="sourceLine" id="cb130-16" title="16">  )</a>
<a class="sourceLine" id="cb130-17" title="17"></a>
<a class="sourceLine" id="cb130-18" title="18"><span class="co"># examine the output</span></a>
<a class="sourceLine" id="cb130-19" title="19">nested_data</a>
<a class="sourceLine" id="cb130-20" title="20"><span class="co">#&gt; # A tibble: 29 x 5</span></a>
<a class="sourceLine" id="cb130-21" title="21"><span class="co">#&gt; # Groups:   order [29]</span></a>
<a class="sourceLine" id="cb130-22" title="22"><span class="co">#&gt;   order           data                  n_rows mean_mass first_animal          </span></a>
<a class="sourceLine" id="cb130-23" title="23"><span class="co">#&gt;   &lt;chr&gt;           &lt;list&gt;                 &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;                 </span></a>
<a class="sourceLine" id="cb130-24" title="24"><span class="co">#&gt; 1 Rodentia        &lt;tibble [2,306 × 23]&gt;   2306     486.  Neochoerus_aesopi     </span></a>
<a class="sourceLine" id="cb130-25" title="25"><span class="co">#&gt; 2 Chiroptera      &lt;tibble [1,162 × 23]&gt;   1162      49.1 Acerodon_jubatus      </span></a>
<a class="sourceLine" id="cb130-26" title="26"><span class="co">#&gt; 3 Carnivora       &lt;tibble [313 × 23]&gt;      313   47905.  Mirounga_leonina      </span></a>
<a class="sourceLine" id="cb130-27" title="27"><span class="co">#&gt; 4 Pilosa          &lt;tibble [34 × 23]&gt;        34  785958.  Megatherium_americanum</span></a>
<a class="sourceLine" id="cb130-28" title="28"><span class="co">#&gt; 5 Diprotodontia   &lt;tibble [183 × 23]&gt;      183   40202.  Diprotodon_optatum    </span></a>
<a class="sourceLine" id="cb130-29" title="29"><span class="co">#&gt; 6 Cetartiodactyla &lt;tibble [392 × 23]&gt;      392 1854811.  Balaenoptera_musculus </span></a>
<a class="sourceLine" id="cb130-30" title="30"><span class="co">#&gt; # … with 23 more rows</span></a></code></pre></div>
</div>
<div id="selective-mapping-using-map-variants" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Selective mapping using <code>map</code> variants</h3>
<p><code>map_at</code> and <code>map_if</code> work like other <code>*_at</code> and <code>*_if</code> functions. Here, <code>map_if</code> is used to run a linear model only on those tibbles which have sufficient data. The predicate is specified by <code>.p</code>.</p>
<p>In this example, the nested tibble is given a new column using <code>dplyr::mutate</code>, where the data to be added is a mixed list.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1"><span class="co"># split data by order number and run an lm only if there are more than 100 rows</span></a>
<a class="sourceLine" id="cb131-2" title="2">nested_data =<span class="st"> </span><span class="kw">nest</span>(data, <span class="dt">data =</span> <span class="op">-</span>order)</a>
<a class="sourceLine" id="cb131-3" title="3"></a>
<a class="sourceLine" id="cb131-4" title="4">nested_data =<span class="st"> </span><span class="kw">mutate</span>(nested_data,</a>
<a class="sourceLine" id="cb131-5" title="5">              <span class="dt">model =</span> <span class="kw">map_if</span>(<span class="dt">.x =</span> data,</a>
<a class="sourceLine" id="cb131-6" title="6">                             </a>
<a class="sourceLine" id="cb131-7" title="7">                             <span class="co"># this is the predicate</span></a>
<a class="sourceLine" id="cb131-8" title="8">                             <span class="co"># which elements should be operated on?</span></a>
<a class="sourceLine" id="cb131-9" title="9">                             <span class="dt">.p =</span> <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb131-10" title="10">                               <span class="kw">nrow</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb131-11" title="11">                             },</a>
<a class="sourceLine" id="cb131-12" title="12">                             </a>
<a class="sourceLine" id="cb131-13" title="13">                             <span class="co"># this is the function to use</span></a>
<a class="sourceLine" id="cb131-14" title="14">                             <span class="co"># if the predicate is satisfied</span></a>
<a class="sourceLine" id="cb131-15" title="15">                             <span class="dt">.f =</span> <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb131-16" title="16">                               <span class="kw">lm</span>(mass_g <span class="op">~</span><span class="st"> </span>diet_plant, <span class="dt">data =</span> x)</a>
<a class="sourceLine" id="cb131-17" title="17">                             }))</a>
<a class="sourceLine" id="cb131-18" title="18"><span class="co"># check the data structure</span></a>
<a class="sourceLine" id="cb131-19" title="19">nested_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a>
<a class="sourceLine" id="cb131-20" title="20"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb131-21" title="21"><span class="co">#&gt;   order           data                  model             </span></a>
<a class="sourceLine" id="cb131-22" title="22"><span class="co">#&gt;   &lt;chr&gt;           &lt;list&gt;                &lt;list&gt;            </span></a>
<a class="sourceLine" id="cb131-23" title="23"><span class="co">#&gt; 1 Rodentia        &lt;tibble [2,306 × 23]&gt; &lt;lm&gt;              </span></a>
<a class="sourceLine" id="cb131-24" title="24"><span class="co">#&gt; 2 Chiroptera      &lt;tibble [1,162 × 23]&gt; &lt;lm&gt;              </span></a>
<a class="sourceLine" id="cb131-25" title="25"><span class="co">#&gt; 3 Carnivora       &lt;tibble [313 × 23]&gt;   &lt;lm&gt;              </span></a>
<a class="sourceLine" id="cb131-26" title="26"><span class="co">#&gt; 4 Pilosa          &lt;tibble [34 × 23]&gt;    &lt;tibble [34 × 23]&gt;</span></a>
<a class="sourceLine" id="cb131-27" title="27"><span class="co">#&gt; 5 Diprotodontia   &lt;tibble [183 × 23]&gt;   &lt;lm&gt;              </span></a>
<a class="sourceLine" id="cb131-28" title="28"><span class="co">#&gt; 6 Cetartiodactyla &lt;tibble [392 × 23]&gt;   &lt;lm&gt;</span></a></code></pre></div>
<p>Some elements of the column <code>model</code> are tibbles, which have not been operated on because they have fewer than 100 rows (species). The remaining elements are <code>lm</code> objects.</p>
</div>
</div>
<div id="more-map-variants" class="section level2">
<h2><span class="header-section-number">4.3</span> More <code>map</code> variants</h2>
<p><code>map</code> also has variants along the axis of how many elements are operated upon. <code>map2</code> operates on two vectors or list-like elements, and returns a single list as output, while <code>pmap</code> operates on a list of list-like elements.
The output has as many elements as the input lists, which must be of the same length.</p>
<div id="mapping-over-two-inputs-with-map2" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Mapping over two inputs with map2</h3>
<p><code>map2</code> has the same variants as <code>map</code>, allowing for different return types.
Here <code>map2_int</code> returns an integer vector.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1"><span class="co"># consider 2 vectors and replicate the simple vector addition using map2</span></a>
<a class="sourceLine" id="cb132-2" title="2"><span class="kw">map2_int</span>(<span class="dt">.x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, </a>
<a class="sourceLine" id="cb132-3" title="3">         <span class="dt">.y =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb132-4" title="4">         <span class="dt">.f =</span> sum)</a>
<a class="sourceLine" id="cb132-5" title="5"><span class="co">#&gt; [1]  7  9 11 13 15</span></a></code></pre></div>
<p><code>map2</code> doesn’t have <code>_at</code> and <code>_if</code> variants.</p>
<p>One use case for <code>map2</code> is to deal with both a list element and its index, as shown in the example. This may be necessary when the list index is removed in a <code>split</code> or <code>nest</code>. This can also be done with <code>imap</code>, where the index is referred to as <code>.y</code>.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1"><span class="co"># make a named list for this example</span></a>
<a class="sourceLine" id="cb133-2" title="2">this_list =<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="st">&quot;first letter&quot;</span>,</a>
<a class="sourceLine" id="cb133-3" title="3">                 <span class="dt">b =</span> <span class="st">&quot;second letter&quot;</span>)</a>
<a class="sourceLine" id="cb133-4" title="4"></a>
<a class="sourceLine" id="cb133-5" title="5"><span class="co"># a not particularly useful example</span></a>
<a class="sourceLine" id="cb133-6" title="6"><span class="kw">map2</span>(this_list, <span class="kw">names</span>(this_list),</a>
<a class="sourceLine" id="cb133-7" title="7">     <span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb133-8" title="8">       glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;{x} : {y}&#39;</span>)</a>
<a class="sourceLine" id="cb133-9" title="9">     })</a>
<a class="sourceLine" id="cb133-10" title="10"><span class="co">#&gt; $a</span></a>
<a class="sourceLine" id="cb133-11" title="11"><span class="co">#&gt; first letter : a</span></a>
<a class="sourceLine" id="cb133-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb133-13" title="13"><span class="co">#&gt; $b</span></a>
<a class="sourceLine" id="cb133-14" title="14"><span class="co">#&gt; second letter : b</span></a>
<a class="sourceLine" id="cb133-15" title="15"></a>
<a class="sourceLine" id="cb133-16" title="16"><span class="co"># imap can also do this</span></a>
<a class="sourceLine" id="cb133-17" title="17"><span class="kw">imap</span>(this_list,</a>
<a class="sourceLine" id="cb133-18" title="18">     <span class="cf">function</span>(x, .y){</a>
<a class="sourceLine" id="cb133-19" title="19">       glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;{x} : {.y}&#39;</span>)</a>
<a class="sourceLine" id="cb133-20" title="20">     })</a>
<a class="sourceLine" id="cb133-21" title="21"><span class="co">#&gt; $a</span></a>
<a class="sourceLine" id="cb133-22" title="22"><span class="co">#&gt; first letter : a</span></a>
<a class="sourceLine" id="cb133-23" title="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb133-24" title="24"><span class="co">#&gt; $b</span></a>
<a class="sourceLine" id="cb133-25" title="25"><span class="co">#&gt; second letter : b</span></a></code></pre></div>
</div>
<div id="mapping-over-multiple-inputs-with-pmap" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Mapping over multiple inputs with pmap</h3>
<p><code>pmap</code> instead operates on a list of multiple list-like objects, and also comes with the same return type variants as <code>map</code>. The example shows both aspects of <code>pmap</code> using <code>pmap_chr</code>.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="co"># operate on three different lists</span></a>
<a class="sourceLine" id="cb134-2" title="2">list_<span class="dv">01</span> =<span class="st"> </span><span class="kw">as.list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb134-3" title="3">list_<span class="dv">02</span> =<span class="st"> </span><span class="kw">as.list</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</a>
<a class="sourceLine" id="cb134-4" title="4">list_<span class="dv">03</span> =<span class="st"> </span><span class="kw">as.list</span>(<span class="kw">rainbow</span>(<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb134-5" title="5"></a>
<a class="sourceLine" id="cb134-6" title="6"><span class="co"># print a few statements</span></a>
<a class="sourceLine" id="cb134-7" title="7"><span class="kw">pmap_chr</span>(<span class="kw">list</span>(list_<span class="dv">01</span>, list_<span class="dv">02</span>, list_<span class="dv">03</span>),</a>
<a class="sourceLine" id="cb134-8" title="8">         <span class="cf">function</span>(l1, l2, l3){</a>
<a class="sourceLine" id="cb134-9" title="9">           glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;number {l1}, letter {l2}, colour {l3}&#39;</span>)</a>
<a class="sourceLine" id="cb134-10" title="10">         })</a>
<a class="sourceLine" id="cb134-11" title="11"><span class="co">#&gt; [1] &quot;number 1, letter a, colour #FF0000FF&quot;</span></a>
<a class="sourceLine" id="cb134-12" title="12"><span class="co">#&gt; [2] &quot;number 2, letter b, colour #00FF00FF&quot;</span></a>
<a class="sourceLine" id="cb134-13" title="13"><span class="co">#&gt; [3] &quot;number 3, letter c, colour #0000FFFF&quot;</span></a></code></pre></div>
</div>
</div>
<div id="combining-map-variants-and-tidyverse-functions" class="section level2">
<h2><span class="header-section-number">4.4</span> Combining map variants and tidyverse functions</h2>
<p>The example below shows a relatively complex data manipulation pipeline.
Such pipelines must either be thought through carefully in advance, or checked for required output on small subsets of data, so as not to consume excessive system resources.</p>
<p>In the pipeline:</p>
<ol style="list-style-type: decimal">
<li>The tibble becomes a nested dataframe by order (using <code>tidyr::nest</code>),</li>
<li>If there are enough data points (&gt; 100), a linear model of mass ~ plant diet is fit (using <code>purrr::map_if</code>, and <code>stats::lm</code>),</li>
<li>The model coefficients are extracted if the model was fit (using <code>purrr::map</code> &amp; <code>dplyr::case_when</code>),</li>
<li>The model coefficients are converted to data for plotting (using <code>purrr::map</code>, <code>tibble::tibble</code>, &amp; <code>tidyr::pivot_wider</code>),</li>
<li>The raw data is plotted along with the model fit, taking the title from the nested data frame (using <code>purrr::pmap</code> &amp; <code>ggplot2::ggplot</code>).</li>
</ol>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1">nested_data &lt;-</a>
<a class="sourceLine" id="cb135-2" title="2"><span class="st">  </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-3" title="3"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">nest</span>(<span class="dt">data =</span> <span class="op">-</span>order) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(data,</a>
<a class="sourceLine" id="cb135-5" title="5">         <span class="dt">model =</span> <span class="kw">map_if</span>(<span class="dt">.x =</span> data,</a>
<a class="sourceLine" id="cb135-6" title="6">                        </a>
<a class="sourceLine" id="cb135-7" title="7">                        <span class="co"># this is the predicate</span></a>
<a class="sourceLine" id="cb135-8" title="8">                        <span class="co"># which elements should be operated on?</span></a>
<a class="sourceLine" id="cb135-9" title="9">                        <span class="dt">.p =</span> <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb135-10" title="10">                          <span class="kw">nrow</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb135-11" title="11">                        },</a>
<a class="sourceLine" id="cb135-12" title="12">                        </a>
<a class="sourceLine" id="cb135-13" title="13">                        <span class="co"># this is the function to use</span></a>
<a class="sourceLine" id="cb135-14" title="14">                        <span class="co"># if the predicate is satisfied</span></a>
<a class="sourceLine" id="cb135-15" title="15">                        <span class="dt">.f =</span> <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb135-16" title="16">                          <span class="kw">lm</span>(mass_g <span class="op">~</span><span class="st"> </span>diet_plant, <span class="dt">data =</span> x)</a>
<a class="sourceLine" id="cb135-17" title="17">                        })) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-18" title="18"><span class="st">  </span></a>
<a class="sourceLine" id="cb135-19" title="19"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">m_coef =</span> <span class="kw">map</span>(model,</a>
<a class="sourceLine" id="cb135-20" title="20">                      </a>
<a class="sourceLine" id="cb135-21" title="21">                      <span class="co"># use case when to get model coefficients</span></a>
<a class="sourceLine" id="cb135-22" title="22">                      <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb135-23" title="23">                        dplyr<span class="op">::</span><span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb135-24" title="24">                          <span class="st">&quot;lm&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">class</span>(x) <span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb135-25" title="25">                            <span class="kw">list</span>(<span class="kw">coef</span>(x))</a>
<a class="sourceLine" id="cb135-26" title="26">                          },</a>
<a class="sourceLine" id="cb135-27" title="27">                          <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>{</a>
<a class="sourceLine" id="cb135-28" title="28">                            <span class="kw">list</span>(<span class="kw">c</span>(<span class="ot">NA</span>,<span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb135-29" title="29">                          }</a>
<a class="sourceLine" id="cb135-30" title="30">                        )}), </a>
<a class="sourceLine" id="cb135-31" title="31">         </a>
<a class="sourceLine" id="cb135-32" title="32">         <span class="co"># work on the two element double vector of coefficients</span></a>
<a class="sourceLine" id="cb135-33" title="33">         <span class="dt">m_coef =</span> <span class="kw">map</span>(m_coef, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb135-34" title="34">           <span class="kw">tibble</span>(<span class="dt">coef =</span> <span class="kw">unlist</span>(x),</a>
<a class="sourceLine" id="cb135-35" title="35">                  <span class="dt">param =</span> <span class="kw">c</span>(<span class="st">&quot;intercept&quot;</span>, <span class="st">&quot;diet_plant&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-36" title="36"><span class="st">             </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;param&quot;</span>,</a>
<a class="sourceLine" id="cb135-37" title="37">                         <span class="dt">values_from =</span> <span class="st">&quot;coef&quot;</span>)</a>
<a class="sourceLine" id="cb135-38" title="38">         }),</a>
<a class="sourceLine" id="cb135-39" title="39">         </a>
<a class="sourceLine" id="cb135-40" title="40">         <span class="co"># work on the raw data and the coefficients</span></a>
<a class="sourceLine" id="cb135-41" title="41">         <span class="dt">plot =</span> <span class="kw">pmap</span>(<span class="kw">list</span>(order, data, m_coef), <span class="cf">function</span>(ord, x, y){</a>
<a class="sourceLine" id="cb135-42" title="42">           </a>
<a class="sourceLine" id="cb135-43" title="43">           <span class="co"># pay no attention to the ggplot for now</span></a>
<a class="sourceLine" id="cb135-44" title="44">           ggplot2<span class="op">::</span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb135-45" title="45"><span class="st">             </span><span class="kw">geom_point</span>(<span class="dt">data =</span> x,</a>
<a class="sourceLine" id="cb135-46" title="46">                        <span class="kw">aes</span>(diet_plant, mass_g),</a>
<a class="sourceLine" id="cb135-47" title="47">                        <span class="dt">size =</span> <span class="fl">0.1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb135-48" title="48"><span class="st">             </span><span class="kw">scale_y_log10</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb135-49" title="49"><span class="st">             </span><span class="kw">labs</span>(<span class="dt">title =</span> glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;order: {ord}&#39;</span>))</a>
<a class="sourceLine" id="cb135-50" title="50">         })</a>
<a class="sourceLine" id="cb135-51" title="51">  )</a></code></pre></div>
</div>
<div id="a-return-to-map-variants" class="section level2">
<h2><span class="header-section-number">4.5</span> A return to map variants</h2>
<p>Lists are often nested, that is, a list element may itself be a list. It is possible to map a function over elements as a specific depth.</p>
<p>In the example, phylacine is split by order, and then by IUCN status, creating a two-level list, with the second layer operated on.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1"><span class="co"># use map to make a 2 level list</span></a>
<a class="sourceLine" id="cb136-2" title="2">this_list =<span class="st"> </span><span class="kw">split</span>(data, data<span class="op">$</span>order) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-3" title="3"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(df){ <span class="kw">split</span>(df, df<span class="op">$</span>iucn_status) })</a>
<a class="sourceLine" id="cb136-4" title="4"></a>
<a class="sourceLine" id="cb136-5" title="5"><span class="co"># map over the second level to count the number of </span></a>
<a class="sourceLine" id="cb136-6" title="6"><span class="co"># species in each order in each IUCN class</span></a>
<a class="sourceLine" id="cb136-7" title="7"><span class="co"># display only the first element</span></a>
<a class="sourceLine" id="cb136-8" title="8"><span class="kw">map_depth</span>(this_list[<span class="dv">1</span>], <span class="dv">2</span>, nrow)</a>
<a class="sourceLine" id="cb136-9" title="9"><span class="co">#&gt; $Afrosoricida</span></a>
<a class="sourceLine" id="cb136-10" title="10"><span class="co">#&gt; $Afrosoricida$CR</span></a>
<a class="sourceLine" id="cb136-11" title="11"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb136-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb136-13" title="13"><span class="co">#&gt; $Afrosoricida$DD</span></a>
<a class="sourceLine" id="cb136-14" title="14"><span class="co">#&gt; [1] 4</span></a>
<a class="sourceLine" id="cb136-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb136-16" title="16"><span class="co">#&gt; $Afrosoricida$EN</span></a>
<a class="sourceLine" id="cb136-17" title="17"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb136-18" title="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb136-19" title="19"><span class="co">#&gt; $Afrosoricida$EP</span></a>
<a class="sourceLine" id="cb136-20" title="20"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb136-21" title="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb136-22" title="22"><span class="co">#&gt; $Afrosoricida$LC</span></a>
<a class="sourceLine" id="cb136-23" title="23"><span class="co">#&gt; [1] 32</span></a>
<a class="sourceLine" id="cb136-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb136-25" title="25"><span class="co">#&gt; $Afrosoricida$NT</span></a>
<a class="sourceLine" id="cb136-26" title="26"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb136-27" title="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb136-28" title="28"><span class="co">#&gt; $Afrosoricida$VU</span></a>
<a class="sourceLine" id="cb136-29" title="29"><span class="co">#&gt; [1] 8</span></a></code></pre></div>
<div id="iteration-without-a-return" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Iteration without a return</h3>
<p><code>map</code> and its variants have a return type, which is either a list or a vector.
However, it is often necessary to iterate a function over a list-like object for that function’s side effects, such as printing a message to screen, plotting a series of figures, or saving to file.</p>
<p><code>walk</code> is the function for this task. It has only the variants <code>walk2</code>, <code>iwalk</code>, and <code>pwalk</code>, whose logic is similar to <code>map2</code>, <code>imap</code>, and <code>pmap</code>. In the example, the function applied to each list element is intended to print a message.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1">this_list =<span class="st"> </span><span class="kw">split</span>(data, data<span class="op">$</span>order)</a>
<a class="sourceLine" id="cb137-2" title="2"></a>
<a class="sourceLine" id="cb137-3" title="3"><span class="kw">iwalk</span>(this_list,</a>
<a class="sourceLine" id="cb137-4" title="4">      <span class="cf">function</span>(df, .y){</a>
<a class="sourceLine" id="cb137-5" title="5">        <span class="kw">print</span>(glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;{nrow(df)} species in order {.y}&#39;</span>))</a>
<a class="sourceLine" id="cb137-6" title="6">      })</a>
<a class="sourceLine" id="cb137-7" title="7"><span class="co">#&gt; 57 species in order Afrosoricida</span></a>
<a class="sourceLine" id="cb137-8" title="8"><span class="co">#&gt; 313 species in order Carnivora</span></a>
<a class="sourceLine" id="cb137-9" title="9"><span class="co">#&gt; 392 species in order Cetartiodactyla</span></a>
<a class="sourceLine" id="cb137-10" title="10"><span class="co">#&gt; 1162 species in order Chiroptera</span></a>
<a class="sourceLine" id="cb137-11" title="11"><span class="co">#&gt; 39 species in order Cingulata</span></a>
<a class="sourceLine" id="cb137-12" title="12"><span class="co">#&gt; 74 species in order Dasyuromorphia</span></a>
<a class="sourceLine" id="cb137-13" title="13"><span class="co">#&gt; 2 species in order Dermoptera</span></a>
<a class="sourceLine" id="cb137-14" title="14"><span class="co">#&gt; 97 species in order Didelphimorphia</span></a>
<a class="sourceLine" id="cb137-15" title="15"><span class="co">#&gt; 183 species in order Diprotodontia</span></a>
<a class="sourceLine" id="cb137-16" title="16"><span class="co">#&gt; 465 species in order Eulipotyphla</span></a>
<a class="sourceLine" id="cb137-17" title="17"><span class="co">#&gt; 5 species in order Hyracoidea</span></a>
<a class="sourceLine" id="cb137-18" title="18"><span class="co">#&gt; 94 species in order Lagomorpha</span></a>
<a class="sourceLine" id="cb137-19" title="19"><span class="co">#&gt; 3 species in order Litopterna</span></a>
<a class="sourceLine" id="cb137-20" title="20"><span class="co">#&gt; 19 species in order Macroscelidea</span></a>
<a class="sourceLine" id="cb137-21" title="21"><span class="co">#&gt; 1 species in order Microbiotheria</span></a>
<a class="sourceLine" id="cb137-22" title="22"><span class="co">#&gt; 7 species in order Monotremata</span></a>
<a class="sourceLine" id="cb137-23" title="23"><span class="co">#&gt; 2 species in order Notoryctemorphia</span></a>
<a class="sourceLine" id="cb137-24" title="24"><span class="co">#&gt; 3 species in order Notoungulata</span></a>
<a class="sourceLine" id="cb137-25" title="25"><span class="co">#&gt; 7 species in order Paucituberculata</span></a>
<a class="sourceLine" id="cb137-26" title="26"><span class="co">#&gt; 24 species in order Peramelemorphia</span></a>
<a class="sourceLine" id="cb137-27" title="27"><span class="co">#&gt; 29 species in order Perissodactyla</span></a>
<a class="sourceLine" id="cb137-28" title="28"><span class="co">#&gt; 9 species in order Pholidota</span></a>
<a class="sourceLine" id="cb137-29" title="29"><span class="co">#&gt; 34 species in order Pilosa</span></a>
<a class="sourceLine" id="cb137-30" title="30"><span class="co">#&gt; 460 species in order Primates</span></a>
<a class="sourceLine" id="cb137-31" title="31"><span class="co">#&gt; 18 species in order Proboscidea</span></a>
<a class="sourceLine" id="cb137-32" title="32"><span class="co">#&gt; 2306 species in order Rodentia</span></a>
<a class="sourceLine" id="cb137-33" title="33"><span class="co">#&gt; 20 species in order Scandentia</span></a>
<a class="sourceLine" id="cb137-34" title="34"><span class="co">#&gt; 5 species in order Sirenia</span></a>
<a class="sourceLine" id="cb137-35" title="35"><span class="co">#&gt; 1 species in order Tubulidentata</span></a></code></pre></div>
</div>
<div id="modify-rather-than-map" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Modify rather than map</h3>
<p>When the return type is expected to be the same as the input type, that is, a list returning a list, or a character vector returning the same, <code>modify</code> can help with keeping strictly to those expectations.</p>
<p>In the example, simply adding 2 to each vector element produces an error, because the output is a <code>numeric</code>, or <code>double</code>. <code>modify</code> helps ensure some type safety in this way.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1">vec =<span class="st"> </span><span class="kw">as.integer</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb138-2" title="2"></a>
<a class="sourceLine" id="cb138-3" title="3"><span class="kw">tryCatch</span>(</a>
<a class="sourceLine" id="cb138-4" title="4">  <span class="dt">expr =</span> {</a>
<a class="sourceLine" id="cb138-5" title="5">    </a>
<a class="sourceLine" id="cb138-6" title="6">    <span class="co"># this is what we want you to look at</span></a>
<a class="sourceLine" id="cb138-7" title="7">    </a>
<a class="sourceLine" id="cb138-8" title="8">    <span class="kw">modify</span>(vec, <span class="cf">function</span>(x) { (x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) })</a>
<a class="sourceLine" id="cb138-9" title="9">    </a>
<a class="sourceLine" id="cb138-10" title="10">  },</a>
<a class="sourceLine" id="cb138-11" title="11">  </a>
<a class="sourceLine" id="cb138-12" title="12">  <span class="co"># do not pay attention to this</span></a>
<a class="sourceLine" id="cb138-13" title="13">  <span class="dt">error =</span> <span class="cf">function</span>(e){</a>
<a class="sourceLine" id="cb138-14" title="14">    <span class="kw">print</span>(<span class="kw">toString</span>(e))</a>
<a class="sourceLine" id="cb138-15" title="15">  }</a>
<a class="sourceLine" id="cb138-16" title="16">)</a>
<a class="sourceLine" id="cb138-17" title="17"><span class="co">#&gt; [1] &quot;Error: Can&#39;t coerce element 1 from a double to a integer\n&quot;</span></a></code></pre></div>
<p>Converting the output to an integer, which was the original input type, serves as a solution.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" title="1"><span class="kw">modify</span>(vec, <span class="cf">function</span>(x) { <span class="kw">as.integer</span>(x <span class="op">+</span><span class="st"> </span><span class="dv">2</span>) })</a>
<a class="sourceLine" id="cb139-2" title="2"><span class="co">#&gt;  [1]  3  4  5  6  7  8  9 10 11 12</span></a></code></pre></div>
<div id="a-note-on-invoke" class="section level4 unnumbered">
<h4>A note on <code>invoke</code></h4>
<p><code>invoke</code> used to be a wrapper around <code>do.call</code>, and can still be found with its family of functions in <code>purrr</code>. It is however retired in favour of functionality already present in <code>map</code> and <code>rlang::exec</code>, the latter of which will be covered in another session.</p>
</div>
</div>
</div>
<div id="other-functions-for-working-with-lists" class="section level2">
<h2><span class="header-section-number">4.6</span> Other functions for working with lists</h2>
<p><code>purrr</code> has a number of functions to work with lists, especially lists that are not nested list-columns in a tibble.</p>
<div id="filtering-lists" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Filtering lists</h3>
<p>Lists can be filtered on any predicate using <code>keep</code>, while the special case <code>compact</code> is applied when the empty elements of a list are to be filtered out. <code>discard</code> is the opposite of <code>keep</code>, and keeps only elements not satisfying a condition. Again, the predicate is specified by <code>.p</code>.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="co"># a list containing numbers</span></a>
<a class="sourceLine" id="cb140-2" title="2">this_list =<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">-1</span>, <span class="dt">c =</span> <span class="dv">2</span>, <span class="dt">d =</span> <span class="ot">NULL</span>, <span class="dt">e =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb140-3" title="3"></a>
<a class="sourceLine" id="cb140-4" title="4"><span class="co"># remove the empty element</span></a>
<a class="sourceLine" id="cb140-5" title="5"><span class="co"># this must be done before using keep on the list</span></a>
<a class="sourceLine" id="cb140-6" title="6">this_list =<span class="st"> </span><span class="kw">compact</span>(this_list)</a></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" title="1"><span class="co"># use discard to remove the NA</span></a>
<a class="sourceLine" id="cb141-2" title="2">this_list =<span class="st"> </span><span class="kw">discard</span>(this_list, <span class="dt">.p =</span>is.na)</a>
<a class="sourceLine" id="cb141-3" title="3"></a>
<a class="sourceLine" id="cb141-4" title="4"><span class="co"># keep list elements which are positive</span></a>
<a class="sourceLine" id="cb141-5" title="5"><span class="kw">keep</span>(this_list, <span class="dt">.p =</span> <span class="cf">function</span>(x){ x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> })</a>
<a class="sourceLine" id="cb141-6" title="6"><span class="co">#&gt; $a</span></a>
<a class="sourceLine" id="cb141-7" title="7"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb141-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb141-9" title="9"><span class="co">#&gt; $c</span></a>
<a class="sourceLine" id="cb141-10" title="10"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p><code>head_while</code> is bit of an odd case, which returns all elements of a list-like object in sequence until the first one fails to satisfy a predicate, specified by <code>.p</code>.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-2" title="2"><span class="st">  </span><span class="kw">head_while</span>(<span class="dt">.p =</span> <span class="cf">function</span>(x) x <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb142-3" title="3"><span class="co">#&gt; [1] 1 2 3 4</span></a></code></pre></div>
</div>
<div id="summarising-lists" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Summarising lists</h3>
<p>The <code>purrr</code> functions <code>every</code>, <code>some</code>, <code>has_element</code>, <code>detect</code>, <code>detect_index</code>, and <code>vec_depth</code> help determine whether a list passes a certain logical test or not. These are seldom used and are not discussed here.</p>
</div>
<div id="reduction-and-accumulation" class="section level3">
<h3><span class="header-section-number">4.6.3</span> Reduction and accumulation</h3>
<p><code>reduce</code> helps combine elements along a list using a specific function. Consider the example below where list elements are concatenated into a single vector.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1">this_list =<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">c =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb143-2" title="2"></a>
<a class="sourceLine" id="cb143-3" title="3"><span class="kw">reduce</span>(this_list, c)</a>
<a class="sourceLine" id="cb143-4" title="4"><span class="co">#&gt;  [1]  1  2  3  3  4  5  6  7  8  9 10</span></a></code></pre></div>
<p>This can also be applied to data frames. Consider some random samples of <code>mtcars</code>, each with only 5 cars removed. The objective is to find the cars present in all 10 samples.</p>
<p>The way <code>reduce</code> works in the example below is to take the first element and find its intersection with the second, and to take the result and find its intersection with the third and so on.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1"><span class="co"># sample mtcars</span></a>
<a class="sourceLine" id="cb144-2" title="2">mtcars =<span class="st"> </span><span class="kw">as_tibble</span>(mtcars, <span class="dt">rownames =</span> <span class="st">&quot;car&quot;</span>)</a>
<a class="sourceLine" id="cb144-3" title="3"></a>
<a class="sourceLine" id="cb144-4" title="4">sampled_data =<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb144-5" title="5">  <span class="kw">sample_n</span>(mtcars, <span class="kw">nrow</span>(mtcars)<span class="op">-</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb144-6" title="6">  })</a>
<a class="sourceLine" id="cb144-7" title="7"></a>
<a class="sourceLine" id="cb144-8" title="8"><span class="co"># get cars which appear in all samples</span></a>
<a class="sourceLine" id="cb144-9" title="9">sampled_data =<span class="st"> </span><span class="kw">reduce</span>(sampled_data, </a>
<a class="sourceLine" id="cb144-10" title="10">                      dplyr<span class="op">::</span>inner_join)</a></code></pre></div>
<p><code>accumulate</code> works very similarly, except it retains the intermediate products. The first element is retained as is. <code>accumulate2</code> and <code>reduce2</code> work on two lists, following the same logic as <code>map2</code> etc.
Both functions can be used in much more complex ways than demonstrated here.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1"><span class="co"># make a list</span></a>
<a class="sourceLine" id="cb145-2" title="2">this_list =<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">c =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">d =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">12</span>))</a>
<a class="sourceLine" id="cb145-3" title="3"></a>
<a class="sourceLine" id="cb145-4" title="4"><span class="co"># a multiple accumulate can help</span></a>
<a class="sourceLine" id="cb145-5" title="5"><span class="kw">accumulate</span>(this_list, union, <span class="dt">.dir =</span> <span class="st">&quot;forward&quot;</span>)</a>
<a class="sourceLine" id="cb145-6" title="6"><span class="co">#&gt; $a</span></a>
<a class="sourceLine" id="cb145-7" title="7"><span class="co">#&gt; [1] 1 2 3</span></a>
<a class="sourceLine" id="cb145-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb145-9" title="9"><span class="co">#&gt; $b</span></a>
<a class="sourceLine" id="cb145-10" title="10"><span class="co">#&gt; [1] 1 2 3 4 5 6</span></a>
<a class="sourceLine" id="cb145-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb145-12" title="12"><span class="co">#&gt; $c</span></a>
<a class="sourceLine" id="cb145-13" title="13"><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></a>
<a class="sourceLine" id="cb145-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb145-15" title="15"><span class="co">#&gt; $d</span></a>
<a class="sourceLine" id="cb145-16" title="16"><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 12</span></a></code></pre></div>
</div>
<div id="miscellaneous-operation" class="section level3">
<h3><span class="header-section-number">4.6.4</span> Miscellaneous operation</h3>
<p><code>purrr</code> offers a few more functions to work with lists (or list like objects). <code>prepend</code> works very similarly to <code>append</code>, except it adds to the head of a list. <code>splice</code> adds multiple objects together in a list. <code>splice</code> will break the existing list structure of input lists.</p>
<p><code>flatten</code> has a similar behaviour, and converts a list of vectors or list of lists to a single list-like object. <code>flatten_*</code> options allow the output type to be specified.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1">this_list =<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="kw">rep</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb146-2" title="2">                 <span class="dt">b =</span> <span class="kw">rep</span>(<span class="st">&quot;b&quot;</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb146-3" title="3"></a>
<a class="sourceLine" id="cb146-4" title="4">this_list</a>
<a class="sourceLine" id="cb146-5" title="5"><span class="co">#&gt; $a</span></a>
<a class="sourceLine" id="cb146-6" title="6"><span class="co">#&gt; [1] &quot;a&quot; &quot;a&quot; &quot;a&quot;</span></a>
<a class="sourceLine" id="cb146-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb146-8" title="8"><span class="co">#&gt; $b</span></a>
<a class="sourceLine" id="cb146-9" title="9"><span class="co">#&gt; [1] &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot;</span></a>
<a class="sourceLine" id="cb146-10" title="10"></a>
<a class="sourceLine" id="cb146-11" title="11"><span class="co"># use flatten chr to get a character vector</span></a>
<a class="sourceLine" id="cb146-12" title="12"><span class="kw">flatten_chr</span>(this_list)</a>
<a class="sourceLine" id="cb146-13" title="13"><span class="co">#&gt; [1] &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot;</span></a></code></pre></div>
<p><code>transpose</code> shifts the index order in multi-level lists. This is seen in the example, where the <code>iucn_status</code> goes from being the index of the second level to the index of the first.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" title="1">this_list =<span class="st"> </span><span class="kw">split</span>(data, data<span class="op">$</span>order) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(df) {<span class="kw">split</span>(df, df<span class="op">$</span>iucn_status)})</a></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="co"># from a list of lists where species are divided by order and then</span></a>
<a class="sourceLine" id="cb148-2" title="2"><span class="co"># iucn_status, this is now a list of lists where species are </span></a>
<a class="sourceLine" id="cb148-3" title="3"><span class="co"># divided by status and then order</span></a>
<a class="sourceLine" id="cb148-4" title="4"><span class="kw">transpose</span>(this_list[<span class="dv">1</span>])</a></code></pre></div>
</div>
</div>
<div id="lists-of-ggplots-with-patchwork" class="section level2">
<h2><span class="header-section-number">4.7</span> Lists of <code>ggplots</code> with <code>patchwork</code></h2>
<p>The <a href="https://patchwork.data-imaginist.com/">patchwork</a> library helps compose <code>ggplots</code>, which will be properly introduced in the next session. <code>patchwork</code> usually works on lists of <code>ggplots</code>, which can come from a standalone list, or from a list column in a nested dataframe.
The example below shows the latter, with the <code>data</code> data frame from earlier.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" title="1"><span class="co"># use patchwork on list</span></a>
<a class="sourceLine" id="cb149-2" title="2">patchwork<span class="op">::</span><span class="kw">wrap_plots</span>(nested_data<span class="op">$</span>plot[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</a></code></pre></div>
<p><img src="TRES-Tidy-Tutorial_files/figure-html/unnamed-chunk-104-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-manipulation-with-dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot2-and-the-grammar-of-graphics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/pratikunterwegs/tres-tidy-tutorial/edit/master/04_working_with_lists.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["TRES-Tidy-Tutorial.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
